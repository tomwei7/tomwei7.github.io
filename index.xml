<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>å›´åŸ</title><link>https://tomwei7.com/</link><description>Recent content on å›´åŸ</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Thu, 17 Feb 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://tomwei7.com/index.xml" rel="self" type="application/rss+xml"/><item><title>Ceph BlueStore å®ç° - Allocator</title><link>https://tomwei7.com/2022/02/17/ceph-bluestore-allocator.html</link><pubDate>Thu, 17 Feb 2022 00:00:00 +0000</pubDate><guid>https://tomwei7.com/2022/02/17/ceph-bluestore-allocator.html</guid><description>&lt;img src="https://tomwei7.com/2022/02/17/ceph-bluestore-allocator/ceph.png" alt="Featured image of post Ceph BlueStore å®ç° - Allocator" />&lt;h3 id="èƒŒæ™¯">èƒŒæ™¯&lt;/h3>
&lt;p>BlueStore æ˜¯ ceph çš„æ–°ä¸€ä»£é«˜æ€§èƒ½ OSD å­˜å‚¨å¼•æ“ç”¨äºå–ä»£ä»¥å‰çš„ FileStoreã€‚BlueStore ä¸åƒ FileStore é‚£æ ·éœ€è¦ä¾èµ–æ–‡ä»¶ç³»ç»Ÿè€Œä¸”é€‰æ‹©ç»•è¿‡æ–‡ä»¶ç³»ç»Ÿç›´æ¥æ“ä½œè£¸çš„å—è®¾å¤‡ï¼Œå¯ä»¥å¯¹åº•å±‚å­˜å‚¨è®¾å¤‡æ‹¥æœ‰æ›´åŠ ç²¾ç»†çš„æ§åˆ¶åŒæ—¶å»æ‰äº†éœ€è¦æŠŠå¯¹ RADOS å±‚çš„æ“ä½œè½¬æ¢ä¸º POSIX è¯­ä¹‰çš„æ–‡ä»¶æ“ä½œçš„è¿‡ç¨‹ä¹Ÿå¤§å¤§æé«˜äº†æ€§èƒ½ã€‚BlueStore åœ¨è®¾è®¡æ—¶å……åˆ†è€ƒè™‘äº†æœªæ¥ SSD çš„æ™®åŠï¼Œè€Œä¸åœ¨æ‹˜æ³¥äº HDDã€‚åŸºäºè¿™æ ·çš„è€ƒè™‘ BlueStore åœ¨è®¾è®¡æ—¶å¯ä»¥ä¸€éƒ¨åˆ†æ‘’å¼ƒå·²æœ‰æ–‡ä»¶ç³»ç»Ÿä¸ºäº†é€‚é… HDD è€Œåšçš„å¦¥åï¼ˆHDDéšæœºè¯»å†™é€Ÿåº¦è¿œä½äºé¡ºåºè¯»å†™ï¼Œéšæœºè¯»å†™IOPSçº¦120ç­‰ï¼‰ï¼Œå¯ä»¥é‡å¤åˆ©ç”¨æœªæ¥ SSD çš„ä¼˜åŠ¿ã€‚&lt;/p>
&lt;p>BlueStore é€‰æ‹©ç»•è¿‡äº†æ–‡ä»¶ç³»ç»Ÿé€‰æ‹©ç›´æ¥æ“ä½œè£¸è®¾å¤‡ï¼Œé‚£ä¹ˆ BlueStore å°±å¿…é¡»è¦è‡ªå·±å®ç°è‡ªå·±çš„ Allocator æ¥åšç©ºé—´çš„åˆ†é…ã€‚ç”±äº BlueStore çš„è®¾è®¡ç›®æ ‡æ˜¯é€‚é… SSD è€ƒè™‘åˆ°ä¸ä¼ ç»Ÿç£ç›˜ç›¸æ¯”ï¼ŒSSD æ™®é€šæ™®é€šé‡‡ç”¨ 4K æˆ–è€…æ›´å¤§çš„å—å¤§å°ï¼Œå› æ­¤ SSD é‡‡ç”¨ä½å›¾è¿›è¡Œç©ºé—´ç®¡ç†å¯ä»¥å–çš„æ¯”è¾ƒé«˜çš„ç©ºé—´æ”¶ç›Šï¼Œå‡è®¾ SSD å—å¤§å°ä¸º 4Kï¼Œå¦‚æœç£ç›˜å®¹é‡ä¸º 1T é‚£ä¹ˆä½¿ç”¨ä½å›¾ç®¡ç†ç£ç›˜ç©ºé—´ï¼Œé‚£ä¹ˆéœ€è¦çš„å†…å­˜æ˜¯ 32MBï¼Œå®Œå…¨å¯ä»¥å®ç°å¸¸é©»å†…å­˜ï¼Œæ‰€ä»¥ BlueStore çš„ Allocator é€‰æ‹©å›å½’ä¼ ç»Ÿï¼Œä½¿ç”¨ä½å›¾çš„æ–¹å¼ç®¡ç†ç£ç›˜ç©ºé—´ã€‚&lt;/p>
&lt;blockquote>
&lt;blockquote>
&lt;p>ğŸ’¡ ä½†æ˜¯ç›®å‰ HDD ç›¸è¾ƒäº SSD ä»ç„¶æœ‰å¾ˆå¤§çš„ä»·æ ¼ä¼˜åŠ¿ï¼Œç›®å‰æœ€å¤§ HDD ç¡¬ç›˜å¯ä»¥åˆ° 20T ä»¥å SMR çš„ç¡¬ç›˜å¯èƒ½æ›´å¤§ï¼Œå¦‚æœä½¿ç”¨ 45drives çš„ 60 ç›˜ä½çš„å­˜å‚¨å‹æœåŠ¡å™¨ï¼Œç„¶åä½¿ç”¨ BlueStore å¦‚æœä½¿ç”¨ 4K çš„å—å¤§å°å°†éœ€è¦æ¶ˆè€— 37.5G å†…å­˜å¦‚æœ 512 å—å¤§å°éœ€è¦æ¶ˆè€— 296G å†…å­˜&lt;/p>
&lt;/blockquote>
&lt;/blockquote>
&lt;h3 id="bluestore-allocator-æ¥å£å®šä¹‰">BlueStore Allocator æ¥å£å®šä¹‰&lt;/h3>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-cpp" data-lang="cpp">&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Allocator&lt;/span> {
&lt;span style="color:#66d9ef">public&lt;/span>&lt;span style="color:#f92672">:&lt;/span>
&lt;span style="color:#75715e">/*
&lt;/span>&lt;span style="color:#75715e"> * Allocate required number of blocks in n number of extents.
&lt;/span>&lt;span style="color:#75715e"> * Min and Max number of extents are limited by:
&lt;/span>&lt;span style="color:#75715e"> * a. alloc unit
&lt;/span>&lt;span style="color:#75715e"> * b. max_alloc_size.
&lt;/span>&lt;span style="color:#75715e"> * as no extent can be lesser than block_size and greater than max_alloc size.
&lt;/span>&lt;span style="color:#75715e"> * Apart from that extents can vary between these lower and higher limits according
&lt;/span>&lt;span style="color:#75715e"> * to free block search algorithm and availability of contiguous space.
&lt;/span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">int64_t&lt;/span> allocate(&lt;span style="color:#66d9ef">uint64_t&lt;/span> want_size, &lt;span style="color:#66d9ef">uint64_t&lt;/span> block_size,
&lt;span style="color:#66d9ef">uint64_t&lt;/span> max_alloc_size, &lt;span style="color:#66d9ef">int64_t&lt;/span> hint,
PExtentVector &lt;span style="color:#f92672">*&lt;/span>extents) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
&lt;span style="color:#75715e">/* Bulk release. Implementations may override this method to handle the whole
&lt;/span>&lt;span style="color:#75715e"> * set at once. This could save e.g. unnecessary mutex dance. */&lt;/span>
&lt;span style="color:#66d9ef">virtual&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">release&lt;/span>(&lt;span style="color:#66d9ef">const&lt;/span> interval_set&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#66d9ef">uint64_t&lt;/span>&lt;span style="color:#f92672">&amp;gt;&amp;amp;&lt;/span> release_set) &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
};
&lt;/code>&lt;/pre>&lt;/div>&lt;p>BlueStore çš„ Allocator æ¥å£å®šä¹‰ååˆ†çš„ç®€æ´ï¼Œå»é™¤è¾…åŠ©ç›¸å…³æ¥å£å®šä¹‰åï¼Œåªå‰©ä¸‹ &lt;code>allocate&lt;/code> ä¸ &lt;code>release&lt;/code>&lt;/p>
&lt;ul>
&lt;li>allocate ç”¨äºä» Allocator åˆ†é…ç©ºé—´ï¼Œç”±äºç©ºé—´ç¢ç‰‡é—®é¢˜ allocate å¯èƒ½ä¼šè¿”å›å¤šä¸ª extent, æ²¡æœ‰ extent åŒ…å« offset ä¸ length&lt;/li>
&lt;li>release ç”¨äºæ˜¯å¦å·²åˆ†é…çš„ç©ºé—´ï¼Œreleaseçš„å‚æ•°çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ª interval_set å®é™…çš„æ•°æ®ä¸ºNå¯¹ offset,length åŠ interval_set = &amp;laquo;offset,length&amp;gt;,&amp;lt;offset,length&amp;gt;&amp;hellip;&amp;gt;&lt;/li>
&lt;/ul>
&lt;h3 id="bluestore-ä½å›¾-allocator">BlueStore ä½å›¾ Allocator&lt;/h3>
&lt;p>åœ¨æ¢ç©¶ BlueStore å¦‚æœä½¿ç”¨ä½å›¾å®ç° Allocator ä¹‹å‰ï¼Œé¦–å…ˆè®©æˆ‘ä»¬çœ‹ä¸‹ä½å›¾ç®¡ç†ç£ç›˜ç©ºé—´çš„åŸºæœ¬åŸç†ã€‚å› ä¸ºå¯¹ç£ç›˜çš„è¯»å†™æ“ä½œéƒ½æ˜¯æœ‰ç€æœ€å°çš„æ“ä½œå•ä½ç§°ä¹‹ä¸º Block Sizeï¼Œåœ¨ HDD æ—¶ä»£ä¸€èˆ¬æ˜¯ç£ç›˜æ‰‡åŒºå¤§å°ä¸º 512Bï¼ŒåæœŸçš„ HDD å’Œç°ä»£çš„ SDD å¤§å¤šä½¿ç”¨ 4K ä½œä¸ºæœ€ Block Sizeï¼Œä½†æ˜¯å¤§å¤šä¹Ÿå…¼å®¹ 512B ä½†æ˜¯ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ä¹Ÿå°±æ˜¯ä¹‹å‰å¤§å®¶å¸¸è¯´çš„ 4K å¯¹é½ã€‚ä»¥ç°åœ¨ 4K Block ä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬ç”¨ 1bit 0/1 ä»£è¡¨ä¸€ä¸ª Block æ˜¯å¦è¢«åˆ†é…ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç£ç›˜å¤§å°çš„ 32,768 åˆ†ä¹‹ä¸€çš„å†…å­˜è¡¨ç¤ºå½“å‰ç£ç›˜ Block çš„åˆ†é…çŠ¶æ€ï¼Œå¯¹äºä¸€ä¸ª 1T çš„ç£ç›˜å°±éœ€è¦ 32MB å†…å­˜ã€‚å¦‚å›¾æ‰€ç¤ºï¼š&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 424;
flex-basis: 1019px"
>
&lt;a href="https://tomwei7.com/2022/02/17/ceph-bluestore-allocator/bitmap.png" data-size="871x205">
&lt;img src="https://tomwei7.com/2022/02/17/ceph-bluestore-allocator/bitmap.png"
width="871"
height="205"
srcset="https://tomwei7.com/2022/02/17/ceph-bluestore-allocator/bitmap_hu6ab196b43187e58f92d8423d8cef0263_10803_480x0_resize_box_2.png 480w, https://tomwei7.com/2022/02/17/ceph-bluestore-allocator/bitmap_hu6ab196b43187e58f92d8423d8cef0263_10803_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="bitmap.png">
&lt;/a>
&lt;figcaption>bitmap.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>ä½†æ˜¯è¿™ç§åˆ†é…æ–¹å¼æœ‰ç§ä¸€ä¸ªæ˜æ˜¾çš„å¼Šç«¯ï¼Œå°±æ˜¯å½“åˆ†é…ç©ºé—´æ˜¯éœ€éå†æ•´ä¸ªä½å›¾çš„å†…å­˜æ‰¾åˆ°ç©ºé—²çš„ä½ç½®ï¼Œæ—¶é—´å¤æ‚çš„æ˜¯ $O(n)$ æœ€å·®çš„æƒ…å†µä¸‹éœ€è¦éå† 32MB å†…å­˜çš„æ¯ä¸€ä¸ª Bit è¿™ç§æ–¹å¼æ˜¾ç„¶æ•ˆç‡ä¸é«˜ï¼Œæ‰€ä»¥ BlueStore çš„ä½å›¾ Allocator ä½¿ç”¨äº†ä¸‰å±‚ä½å›¾&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 478;
flex-basis: 1147px"
>
&lt;a href="https://tomwei7.com/2022/02/17/ceph-bluestore-allocator/level-bitmap.png" data-size="1693x354">
&lt;img src="https://tomwei7.com/2022/02/17/ceph-bluestore-allocator/level-bitmap.png"
width="1693"
height="354"
srcset="https://tomwei7.com/2022/02/17/ceph-bluestore-allocator/level-bitmap_hue0d324e8f01eae514fd46fc76d8be876_55691_480x0_resize_box_2.png 480w, https://tomwei7.com/2022/02/17/ceph-bluestore-allocator/level-bitmap_hue0d324e8f01eae514fd46fc76d8be876_55691_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="level-bitmap.png">
&lt;/a>
&lt;figcaption>level-bitmap.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;ul>
&lt;li>L0 æ¯ä¸ª bit ä»£è¡¨ä¸€ä¸ª Blockï¼Œæ¯ 64byte (x86-64 cache line å¤§å°) ä½œä¸ºä¸€ä¸ª L0 slotset&lt;/li>
&lt;li>L1 æ¯ä¸ª bit ä»£è¡¨ L0 ä¸­çš„ä¸€ä¸ª slotset æ˜¯å¦å®Œå…¨åˆ†é…ï¼Œæ¯ 64byte ä½œä¸ºä¸€ä¸ª L1 slotset&lt;/li>
&lt;li>L2 æ¯ä¸ª bit ä»£è¡¨ L1 ä¸­çš„ä¸€ä¸ª slotset æ˜¯å¦å®Œå…¨åˆ†é…&lt;/li>
&lt;/ul>
&lt;p>è¿™ç§ä¸‰å±‚ä½å›¾çš„åˆ†é…æ–¹å¼ï¼Œå¤§å¤§é™ä½äº†åˆ†é…ä¸€ä¸ª Block æœ€å¤§åªéœ€è¦æ‰«æå†…å­˜æ•°æ®ï¼Œä»¥ 1T çš„ç©ºé—´ä¸ºä¾‹ï¼Œä½å›¾å¤§å°ä¸º 32MB é‚£ä¹ˆ L2 çš„å¤§å°ä¸º 16byte é‚£ä¹ˆæœ€å¤šåªè¦æ‰«æ 16+8+8 = 32byte å°±èƒ½æ‰¾åˆ°ä¸€ä¸ªç©ºé—²çš„ Blockï¼Œè€Œä¸”æ¯ä¸ª slotset éƒ½èƒ½å®Œæ•´çš„æ”¾å…¥ CPU Cache Line æ•ˆç‡æé«˜ã€‚&lt;/p></description></item><item><title>QEMU ç½‘ç»œé…ç½®</title><link>https://tomwei7.com/2021/10/09/qemu-network-config.html</link><pubDate>Sat, 09 Oct 2021 00:00:00 +0000</pubDate><guid>https://tomwei7.com/2021/10/09/qemu-network-config.html</guid><description>&lt;img src="https://tomwei7.com/2021/10/09/qemu-network-config/Qemu-Network-01.drawio.png" alt="Featured image of post QEMU ç½‘ç»œé…ç½®" />&lt;p>QEMU æ˜¯ä¸€æ¬¾å¼€æºçš„é€šç”¨æ¨¡æ‹Ÿå™¨è¢«ç”¨äºå„å¼å„æ ·çš„è™šæ‹ŸåŒ–åœºæ™¯ã€‚QEMU ä¸åŒäºæˆ‘ä»¬å¸¸ç”¨çš„ &lt;a class="link" href="https://www.virtualbox.org/" target="_blank" rel="noopener"
>VirtualBox&lt;/a> æˆ–è€… &lt;a class="link" href="https://www.vmware.com/" target="_blank" rel="noopener"
>VMware&lt;/a> ä¹‹ç±»çš„è½¯ä»¶ï¼ŒQEMU å¹¶æ²¡æœ‰æä¾›å›¾å½¢åŒ–çš„é…ç½®å·¥å…·ï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œä½¿ç”¨ã€‚å…¶ä¸­æœ€å¤æ‚çš„è¦å±ç½‘ç»œçš„é…ç½®ï¼Œè¦ç†è§£ QEMU çš„ç½‘ç»œé…ç½®å®ç°è¦äº†è§£å®ƒç½‘ç»œçš„ç»„æˆï¼ŒQEMU çš„ç½‘ç»œç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆ:&lt;/p>
&lt;ul>
&lt;li>æä¾›ç»™è™šæ‹Ÿæœºçš„è™šæ‹Ÿç½‘å¡ï¼ˆvirtual network deviceï¼‰æ¯”å¦‚ç»å…¸çš„ e1000,rtl8139 ä»¥åŠ virtio-net-pci ç­‰ï¼Œæ˜¯è™šæ‹Ÿæœºå†…éƒ¨çœ‹åˆ°çš„è®¾å¤‡&lt;/li>
&lt;li>ä¸è™šæ‹Ÿç½‘å¡äº¤äº’çš„åç«¯ï¼ˆnetwork backendï¼‰è™šæ‹Ÿæœºå¾€è™šæ‹Ÿç½‘å¡å†™å…¥çš„æ•°æ®éƒ½ä¼šç”± network backend æµå‡ºåˆ°çœŸå®çš„ç½‘ç»œç¯å¢ƒä¸­&lt;/li>
&lt;/ul>
&lt;p>ç½‘ç»œé…ç½®å‚æ•°:&lt;/p>
&lt;p>QEMU ç½‘ç»œé…ç½®éœ€è¦ç»„åˆä½¿ç”¨ &lt;code>-netdev TYPE,id=NAME,...&lt;/code> ä¸ &lt;code>-device device TYPE,netdev=NAME&lt;/code> å‘½ä»¤ï¼Œ&lt;code>-device&lt;/code> ç”¨äºé…ç½®è™šæ‹Ÿç½‘å¡ï¼Œ&lt;code>-netdev&lt;/code> ç”¨äºé…ç½®ç½‘ç»œåç«¯ï¼Œ&lt;code>netdev&lt;/code> ä¸­çš„ &lt;code>id&lt;/code> ä¸ &lt;code>device&lt;/code> ä¸­çš„ &lt;code>netdev&lt;/code> å‚æ•°é…åˆç”¨äºç»„æˆä¸€ç»„ç½‘ç»œé…ç½®ï¼Œä¸€å°è™šæ‹Ÿæœºå¯ä»¥é…ç½®å¤šä¸ªç½‘ç»œ&lt;/p>
&lt;p>æ¯”å¦‚æœ€ç®€å•çš„ä½¿ç”¨ User Networking çš„é…ç½®&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">-netdev user,id&lt;span style="color:#f92672">=&lt;/span>mynic0 -device e1000,netdev&lt;span style="color:#f92672">=&lt;/span>mynic0,mac&lt;span style="color:#f92672">=&lt;/span>52:54:98:76:54:32
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœä¸å…³å¿ƒç½‘å¡çš„è¯¦ç»†é…ç½®ä¹Ÿå¯ä»¥ä½¿ç”¨ &lt;code>-nic&lt;/code> ç®€åŒ–å‘½ä»¤&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">-nic user,model&lt;span style="color:#f92672">=&lt;/span>e1000,mac&lt;span style="color:#f92672">=&lt;/span>52:54:98:76:54:32
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>-nic&lt;/code> å‚æ•°ä¸­ model å¯¹åº” device ä¸­çš„ typeï¼Œä½¿ç”¨ nic å¯ä»¥é¿å…åˆ†åˆ«é…ç½® netdev ä¸ device ä½†æ˜¯ç›¸å¯¹çš„åªæä¾›äº†éå¸¸å°‘çš„å¯é€‰å‚æ•°&lt;/p>
&lt;blockquote>
&lt;p>QEMU ä¸ä¼šä¸ºç½‘å¡ç”Ÿæˆéšæœºçš„ mac åœ°å€ï¼Œå¦‚æœä¸æŒ‡å®š mac åœ°å€åˆ™å¯åŠ¨çš„è™šæ‹Ÿæœºéƒ½æœ‰ç›¸åŒçš„ mac å¦‚æœéœ€è¦å¯åŠ¨å¤šä¸ªè™šæ‹Ÿæœºåœ¨é™¤ User Networking çš„ç½‘ç»œæ¯”å¦‚ tap çš„æ¡¥æ¥ç½‘ç»œä¸­éƒ½ä¼šå­˜åœ¨ mac åœ°å€å†²çªé—®é¢˜ã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="network-backend">Network Backend&lt;/h3>
&lt;hr>
&lt;p>å¸¸ç”¨çš„ Network Backend ä¸»è¦æœ‰ä¸¤ç§ user networking(slirp) å’Œ &lt;a class="link" href="https://en.wikipedia.org/wiki/Network_tap#:~:text=A%20network%20tap%20is%20a,two%20points%20in%20the%20network." target="_blank" rel="noopener"
>tap&lt;/a> ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å¦‚æœä½ åªæ˜¯å¸Œæœ›ä½ çš„è™šæ‹Ÿæœºèƒ½å¤Ÿè®¿é—®ç½‘ç»œé‚£ä¹ˆ user networking(slirp) å°±å¤Ÿç”¨äº†ï¼Œuser networking(slirp) ä¹Ÿæ˜¯ QEMU çš„é»˜è®¤é¡¹ã€‚ä½†æ˜¯å¦‚æœå¸Œæœ›ç»„å»ºæ¯”è¾ƒå¤æ‚çš„ç½‘ç»œæ‹“æ‰‘æˆ–è€…å¸Œæœ›è™šæ‹Ÿæœºå®¿ä¸»æœºä¹‹é—´èƒ½å¤Ÿè‡ªç”±çš„ç›¸äº’è®¿é—®è¿™ä¸ªæ—¶å€™ &lt;a class="link" href="https://en.wikipedia.org/wiki/Network_tap#:~:text=A%20network%20tap%20is%20a,two%20points%20in%20the%20network." target="_blank" rel="noopener"
>tap&lt;/a> å°±å¾ˆé€‚åˆã€‚&lt;/p>
&lt;h3 id="user-networking-slirp">User Networking (SLIRP)&lt;/h3>
&lt;p>è¿™æ˜¯ QEMU çš„é»˜è®¤ Network Backendï¼Œä½¿ç”¨æ—¶ä¸éœ€è¦ç®¡ç†å‘˜ï¼ˆrootï¼‰æƒé™ï¼Œä½†æ˜¯å­˜åœ¨è¿™ä»¥ä¸‹é™åˆ¶&lt;/p>
&lt;ul>
&lt;li>ç”±äºé¢å¤–å¼€é”€æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥æ€§èƒ½æ¯”è¾ƒå·®&lt;/li>
&lt;li>ä¸ç‰¹æ®Šé…ç½®æ— æ³•ä¼ è¾“ ICMP æµé‡æ¯”å¦‚ä¸èƒ½ä½¿ç”¨ ping ç­‰&lt;/li>
&lt;li>è™šæ‹Ÿæœºé»˜è®¤æ²¡åŠæ³•ç›´æ¥ä»å®¿ä¸»æœºæˆ–è€…å¤–éƒ¨ç½‘ç»œè®¿é—®&lt;/li>
&lt;/ul>
&lt;p>User Networking ä½¿ç”¨ SLIRP å®ç°ï¼ŒSLIRP å®ç°äº†å®Œæ•´çš„ TCP/IP æ ˆå¹¶ä»¥æ­¤å®ç°äº†è™šæ‹Ÿçš„ NAT è½¬å‘ï¼Œä¾›è™šæ‹Ÿæœºè®¿é—®ç½‘ç»œ&lt;/p>
&lt;p>å½“ä¸å¸¦ä»»ä½•ç½‘ç»œå‚æ•°å¯åŠ¨è™šæ‹Ÿæœºæ—¶ï¼Œé»˜è®¤çš„ç½‘ç»œæ‹“æ‰‘å¦‚ä¸Šå›¾&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 104;
flex-basis: 251px"
>
&lt;a href="https://tomwei7.com/2021/10/09/qemu-network-config/Qemu-Network-01.drawio.png" data-size="910x870">
&lt;img src="https://tomwei7.com/2021/10/09/qemu-network-config/Qemu-Network-01.drawio.png"
width="910"
height="870"
srcset="https://tomwei7.com/2021/10/09/qemu-network-config/Qemu-Network-01.drawio_hu5f1ffb008674850e04787285e79164d9_77119_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/10/09/qemu-network-config/Qemu-Network-01.drawio_hu5f1ffb008674850e04787285e79164d9_77119_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Qemu-Network-01.drawio.png">
&lt;/a>
&lt;figcaption>Qemu-Network-01.drawio.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>User Networking å¯ä»¥æ·»åŠ å‚æ•°å…¶ä»–å‚æ•°å®ç°ç±»ä¼¼ç«¯å£è½¬å‘ï¼Œé€šè¿‡ SMB å…±äº«ä¸»æœºæ–‡ä»¶å¤¹ç­‰&lt;/p>
&lt;ul>
&lt;li>ç«¯å£è½¬å‘ &lt;code>-netdev user,id=n0,hostfwd=hostip:hostport-guestip:guestport&lt;/code>&lt;/li>
&lt;li>SMBç›®å½•å…±äº« &lt;code>-netdev user,id=n0,smb=dir,smbserver=addr&lt;/code>&lt;/li>
&lt;/ul>
&lt;h3 id="tap-network">TAP Network&lt;/h3>
&lt;p>&lt;a class="link" href="https://zh.wikipedia.org/wiki/TUN%E4%B8%8ETAP" target="_blank" rel="noopener"
>TUN/TAPè®¾å¤‡&lt;/a>æ˜¯ä¸€ç§ Linux ä¸Šçš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œé€šè¿‡æ­¤è®¾å¤‡ï¼Œç¨‹åºå¯ä»¥æ–¹ä¾¿çš„æ¨¡æ‹Ÿç½‘ç»œè¡Œä¸ºï¼Œå…¶ä¸­ TAP æ¨¡æ‹Ÿçš„æ˜¯ä¸ªäºŒå±‚è®¾å¤‡å¯ä»¥é€šè¿‡ TAP è®¾å¤‡æ”¶å‘ MAC å±‚æ•°æ®åŒ…ï¼Œå³æ•°æ®é“¾è·¯å±‚ï¼Œæ‹¥æœ‰ MAC å±‚åŠŸèƒ½ï¼Œå¯ä»¥ä¸ç‰©ç†ç½‘ç»œåš Bridgeã€‚TUN åˆ™æ˜¯ä¸ªä¸‰å±‚è®¾å¤‡å¯ä»¥ç”¨äºæ”¶å‘ IP å±‚æ•°æ®åŒ…ï¼Œè¿™é‡Œä¸åšè¿‡å¤šè®¨è®ºã€‚TAP Network å°±æ˜¯ä½¿ç”¨å®¿ä¸»æœº TAP è®¾å¤‡ä½œä¸º Network Backend çš„ä¸€ç§ç½‘ç»œæ¨¡å¼ï¼Œä¸€èˆ¬ä¼šå’Œ Bridge é…åˆä½¿ç”¨æä¾›äº†å¾ˆå¥½çš„ç½‘ç»œæ€§èƒ½ï¼Œè€Œä¸”æ‹¥æœ‰æå¤§çš„çµæ´»æ€§ï¼Œå¯ä»¥å®ç°å„ç§å„æ ·çš„ç½‘ç»œæ‹“æ‰‘ã€‚ä¸è¿‡è¿™ç§ç½‘ç»œä¸€èˆ¬éœ€è¦rootæƒé™æ‰èƒ½ä½¿ç”¨ã€‚&lt;/p>
&lt;p>TAP Network ä¸€èˆ¬éœ€è¦é…ç½® Bridge ä½¿ç”¨ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»ä¸¤ç§ç½‘ç»œæ¨¡å¼ï¼ŒNAT å’Œ æ¡¥æ¥ç‰©ç†ç½‘ç»œã€‚&lt;/p>
&lt;p>é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ª bridge å¯ä»¥ä½¿ç”¨ IP å‘½ä»¤æ·»åŠ ä¸€ä¸ª bridge&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">ip link add name br0 type bridge
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½¿ç”¨ TAP Network é…åˆ Bridge å®ç°çš„ NAT ç½‘ç»œæ‹“æ‰‘å¦‚ä¸‹ï¼Œè¿™ç§ç½‘ç»œæ¨¡å¼æ˜¯æˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢çš„æ–¹å¼ï¼Œåœ¨è¯¥ç½‘ç»œä¸­ï¼Œè™šæ‹Ÿæœºæ‹¥æœ‰è‡ªå·±çš„ IP å®¿ä¸»æœºå¯ä»¥ç›´æ¥è®¿é—®è™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºä¹Ÿèƒ½å¤Ÿç›´æ¥è®¿é—®å®¿ä¸»æœºã€‚è™šæ‹Ÿæœºè®¿é—®å¤–ç½‘æ—¶å®¿ä¸»æœºå……å½“ç½‘å…³ï¼Œå®ç° NAT åŠŸèƒ½ã€‚ç‰©ç†ç½‘ç»œä¸­å…¶ä»–ä¸»æœºæ— æ³•ç›´æ¥è®¿é—®è¯¥è™šæ‹Ÿæœºï¼Œä¸è¿‡å¯ä»¥åœ¨å®¿ä¸»æœºä¸Šä½¿ç”¨ iptables é…ç½®ç«¯å£è½¬å‘å®ç°æš´éœ²è™šæ‹Ÿæœºåˆ°ç‰©ç†ç½‘ç»œã€‚&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 73;
flex-basis: 176px"
>
&lt;a href="https://tomwei7.com/2021/10/09/qemu-network-config/Qemu-Network-02.drawio.png" data-size="830x1130">
&lt;img src="https://tomwei7.com/2021/10/09/qemu-network-config/Qemu-Network-02.drawio.png"
width="830"
height="1130"
srcset="https://tomwei7.com/2021/10/09/qemu-network-config/Qemu-Network-02.drawio_hucb6fb8820e0a603c23dcfb063c92e7b8_95280_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/10/09/qemu-network-config/Qemu-Network-02.drawio_hucb6fb8820e0a603c23dcfb063c92e7b8_95280_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Qemu-Network-02.drawio.png">
&lt;/a>
&lt;figcaption>Qemu-Network-02.drawio.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>åœ¨è¿™ä¹‹å‰éœ€è¦åšäº›å‡†å¤‡å·¥ä½œï¼Œé¦–å…ˆæˆ‘ä»¬ä¸ºä¹‹å‰åˆ›å»ºçš„ bridge é…ç½® IP åœ°å€ï¼Œå¹¶å¯åŠ¨ bridgeã€‚ç„¶åéœ€è¦é…ç½® Linux ip forwarding ä»¥åŠ NAT åŠŸèƒ½&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">ip addr add 192.168.100.1/24 brd + dev br0
ip link set br0 up
&lt;span style="color:#75715e"># å¼€å¯ ip_forward&lt;/span>
sysctl -w net.ipv4.ip_forward&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;span style="color:#75715e"># å…è®¸å¯¹ä» br0 æµå…¥çš„æ•°æ®åŒ…è¿›è¡Œ FORWARD&lt;/span>
iptables -t filter -A FORWARD -i br0 -j ACCEPT
iptables -t filter -A FORWARD -o br0 -j ACCEPT
&lt;span style="color:#75715e"># ä¹Ÿå¯ä»¥ç›´æ¥å°† filter FORWARD ç­–ç•¥ç›´æ¥è®¾ç½®ä¸º ACCEPT&lt;/span>
&lt;span style="color:#75715e"># iptables -t filter -P FORWARD ACCEPT&lt;/span>
&lt;span style="color:#75715e"># å¼€å¯ NAT&lt;/span>
iptables -t nat -A POSTROUTING -o enp4s0 -j MASQUERADE
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ br0 å®ç° NAT ç½‘ç»œäº†ï¼Œè¿™é‡Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªç®€å•çš„ archlinux çš„ live cd ä½œä¸ºæµ‹è¯•&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#75715e"># å¯åŠ¨è™šæ‹Ÿæœº&lt;/span>
qemu-system-x86_64 -enable-kvm -m &lt;span style="color:#ae81ff">2048&lt;/span> -boot order&lt;span style="color:#f92672">=&lt;/span>d -cdrom archlinux-2021.10.01-x86_64.iso -nic bridge,br&lt;span style="color:#f92672">=&lt;/span>br0,model&lt;span style="color:#f92672">=&lt;/span>virtio-net-pci,mac&lt;span style="color:#f92672">=&lt;/span>02:76:7d:d7:1e:3f
&lt;span style="color:#75715e"># è¿›å…¥è™šæ‹Ÿæœºåé…ç½®ç½‘å¡&lt;/span>
ip addr add 192.168.100.2/24 brd + dev ens3
ip route add default via 192.168.100.1 dev ens3
&lt;span style="color:#75715e"># æŒ‰éœ€ä¿®æ”¹ /etc/resolv.conf é…ç½® DNS æœåŠ¡å™¨&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æµ‹é€Ÿç½‘ç«™æµ‹è¯•ä¸‹ç½‘ç»œè”é€šæ€§&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 397;
flex-basis: 952px"
>
&lt;a href="https://tomwei7.com/2021/10/09/qemu-network-config/Untitled.png" data-size="1326x334">
&lt;img src="https://tomwei7.com/2021/10/09/qemu-network-config/Untitled.png"
width="1326"
height="334"
srcset="https://tomwei7.com/2021/10/09/qemu-network-config/Untitled_hu11622806cd58ac5180d205c28c435094_140081_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/10/09/qemu-network-config/Untitled_hu11622806cd58ac5180d205c28c435094_140081_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Untitled">
&lt;/a>
&lt;figcaption>Untitled&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>ä½¿ç”¨ TAP é…åˆ Bridge ä¹Ÿå¯ä»¥å®ç°æ¡¥æ¥ç‰©ç†ï¼Œç½‘ç»œçš„æ‹“æ‰‘å¦‚ä¸‹ï¼Œè¿™ä¸ªç½‘ç»œæ¨¡å¼ä¸‹ï¼Œè™šæ‹Ÿæœºä½œä¸ºå’Œå®¿ä¸»æœºå¯¹ç­‰çš„å…³ç³»æ¥å…¥ç‰©ç†ç½‘ç»œã€‚è™šæ‹Ÿæœºï¼Œå®¿ä¸»æœºä¸ç½‘ç»œä¸­çš„å…¶ä»–ä¸»æœºå‡å¯ç›¸äº’è®¿é—®ã€‚&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 82;
flex-basis: 197px"
>
&lt;a href="https://tomwei7.com/2021/10/09/qemu-network-config/Qemu-Network-03.drawio.png" data-size="830x1010">
&lt;img src="https://tomwei7.com/2021/10/09/qemu-network-config/Qemu-Network-03.drawio.png"
width="830"
height="1010"
srcset="https://tomwei7.com/2021/10/09/qemu-network-config/Qemu-Network-03.drawio_hu663cf0c4a9f5f83d1744a3c26097f879_89942_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/10/09/qemu-network-config/Qemu-Network-03.drawio_hu663cf0c4a9f5f83d1744a3c26097f879_89942_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Qemu-Network-03.drawio.png">
&lt;/a>
&lt;figcaption>Qemu-Network-03.drawio.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>è¿™ä¸ªæ¨¡å¼ä¸ä¸Šé¢çš„ NAT æ¨¡å¼æ¯”è¾ƒç±»ä¼¼ï¼Œä¸è¿‡ä¸éœ€è¦å¯¹å®¿ä¸»æœºè¿›è¡Œç‰¹åˆ«çš„é…ç½®ï¼Œåªéœ€è¦å°†ç‰©ç†æœºç½‘å¡åŠ å…¥ br0 ä¸­å³å¯ï¼Œè¿™ä¸ªæ—¶å€™ br0 ç›¸å½“äºä¸€ä¸ªäº¤æ¢æœºï¼Œå®¿ä¸»æœºå’Œè™šæ‹Ÿæœºéƒ½è¿åœ¨è¿™ä¸ªäº¤æ¢æœºä¸Šã€‚ä½¿ç”¨ &lt;code>ip link set eth0 master bridge_name&lt;/code> å¯ä»¥å°†ç‰©ç†ç½‘å¡åŠ å…¥ bridge ä¸­ã€‚&lt;/p>
&lt;h3 id="virtual-network-device">Virtual Network Device&lt;/h3>
&lt;hr>
&lt;p>è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œå¯¹äºçš„å°±æ˜¯è™šæ‹Ÿæœºå†…å®é™…çœ‹åˆ°çš„ç½‘å¡è®¾å¤‡ï¼Œä¸€èˆ¬æ ¹æ®è™šæ‹Ÿæœºæ“ä½œç³»ç»Ÿçš„ç±»å‹é€‰æ‹©æˆ–è€…ä½ å¸Œæœ›æ¨¡æ‹Ÿçš„è®¾å¤‡é€‰æ‹©ã€‚å¦‚æœä½ å¸Œæœ›æ¨¡æ‹Ÿä¸€ä¸ªåµŒå…¥å¼è®¾å¤‡å¸¦æœ‰ä¸€ä¸ªæ¿è½½ç½‘å¡ï¼Œé‚£ä¹ˆä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ªæ¿è½½ç½‘å¡ç½‘å¡çš„è®¾å¤‡ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>-device help&lt;/code> åˆ—å‡ºæ‰€æœ‰æ”¯æŒçš„è®¾å¤‡ç±»å‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">Network devices:
name &lt;span style="color:#e6db74">&amp;#34;e1000&amp;#34;&lt;/span>, bus PCI, alias &lt;span style="color:#e6db74">&amp;#34;e1000-82540em&amp;#34;&lt;/span>, desc &lt;span style="color:#e6db74">&amp;#34;Intel Gigabit Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;e1000-82544gc&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel Gigabit Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;e1000-82545em&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel Gigabit Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;e1000e&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel 82574L GbE Controller&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;i82550&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel i82550 Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;i82551&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel i82551 Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;i82557a&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel i82557A Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;i82557b&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel i82557B Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;i82557c&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel i82557C Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;i82558a&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel i82558A Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;i82558b&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel i82558B Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;i82559a&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel i82559A Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;i82559b&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel i82559B Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;i82559c&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel i82559C Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;i82559er&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel i82559ER Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;i82562&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel i82562 Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;i82801&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Intel i82801 Ethernet&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;ne2k_isa&amp;#34;&lt;/span>, bus ISA
name &lt;span style="color:#e6db74">&amp;#34;ne2k_pci&amp;#34;&lt;/span>, bus PCI
name &lt;span style="color:#e6db74">&amp;#34;pcnet&amp;#34;&lt;/span>, bus PCI
name &lt;span style="color:#e6db74">&amp;#34;rocker&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;Rocker Switch&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;rtl8139&amp;#34;&lt;/span>, bus PCI
name &lt;span style="color:#e6db74">&amp;#34;tulip&amp;#34;&lt;/span>, bus PCI
name &lt;span style="color:#e6db74">&amp;#34;usb-net&amp;#34;&lt;/span>, bus usb-bus
name &lt;span style="color:#e6db74">&amp;#34;virtio-net-device&amp;#34;&lt;/span>, bus virtio-bus
name &lt;span style="color:#e6db74">&amp;#34;virtio-net-pci&amp;#34;&lt;/span>, bus PCI, alias &lt;span style="color:#e6db74">&amp;#34;virtio-net&amp;#34;&lt;/span>
name &lt;span style="color:#e6db74">&amp;#34;virtio-net-pci-non-transitional&amp;#34;&lt;/span>, bus PCI
name &lt;span style="color:#e6db74">&amp;#34;virtio-net-pci-transitional&amp;#34;&lt;/span>, bus PCI
name &lt;span style="color:#e6db74">&amp;#34;vmxnet3&amp;#34;&lt;/span>, bus PCI, desc &lt;span style="color:#e6db74">&amp;#34;VMWare Paravirtualized Ethernet v3&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¹äº Linux è™šæ‹Ÿæœºæ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŠè™šæ‹ŸåŒ–çš„è®¾å¤‡ &lt;code>virtio&lt;/code> æ¥è·å¾—æœ€å¥½çš„æ€§èƒ½ã€‚&lt;/p></description></item><item><title>Intel Optane (å‚²è…¾) å·¥ä½œåŸç†</title><link>https://tomwei7.com/2021/01/27/how-intel-optane-work.html</link><pubDate>Wed, 27 Jan 2021 00:00:00 +0000</pubDate><guid>https://tomwei7.com/2021/01/27/how-intel-optane-work.html</guid><description>&lt;img src="https://tomwei7.com/2021/01/27/how-intel-optane-work/0.png" alt="Featured image of post Intel Optane (å‚²è…¾) å·¥ä½œåŸç†" />&lt;p>æœ€è¿‘ï¼ˆ2021å¹´ä¸€æœˆä»½ï¼‰å› ç‰¹å°”å®£å¸ƒåœäº§æ¶ˆè´¹çº§å‚²è…¾äº§å“ã€‚åœ¨è€ç©å®¶çœ¼é‡Œå‚²è…¾ä¸€ç›´æ˜¯æœ€å¼º SSD çš„å­˜åœ¨ï¼Œå‚²è…¾çš„ 4K æ€§èƒ½å¯ä»¥è¯´æ˜¯ä¸€éª‘ç»å°˜ï¼Œä½†æ˜¯å‚²è…¾çš„ä»·æ ¼åœ¨ SSD ä¸­ä¹Ÿæ˜¯ä¸€éª‘ç»å°˜ã€‚æ‰€ä»¥å› ç‰¹å°”ç æ‰æ¶ˆè´¹çº§å‚²è…¾äº§å“ä¹Ÿå¹¶ä¸æ„å¤–ã€‚ç›®å‰ç½‘ä¸Šå…³äºå‚²è…¾çš„è®¨è®ºï¼Œä¹Ÿå¤§å¤šé›†ä¸­äº 4K æ€§èƒ½å¦‚ä½•å¦‚ä½•å¼ºï¼Œ3D XPoint å¯¿å‘½é•¿ï¼Œæ²¡æœ‰å†™æ”¾å¤§é—®é¢˜ç­‰ç­‰ä¸»è¦è¿˜æ˜¯å’Œç°æœ‰ NAND flash çš„ SSD ç›¸æ¯”è¾ƒï¼Œå¤§å¤šåª’ä½“ä¹Ÿåªæ˜¯æŠ›å‡ºäº†ä¸€å¤§å †ä¸“ç”¨åè¯ï¼Œä½†æ˜¯ä»æ¥æ²¡æœ‰è§£é‡Šè¿‡å‚²è…¾çš„ 3D XPoint æ˜¯å…·ä½“å¦‚ä½•å·¥ä½œçš„ã€‚æˆ‘åœ¨ç½‘ä¸Šå‘ç°äº†ä¸€ç‰‡æ–‡ç« è¾ƒä¸ºå®Œæ•´çš„è§£é‡Šäº†å‚²è…¾ä»¥åŠ 3D XPoint çš„å·¥ä½œåŸç†ã€‚&lt;/p>
&lt;p>&lt;a class="link" href="https://pcper.com/2017/06/how-3d-xpoint-phase-change-memory-works/" target="_blank" rel="noopener"
>How 3D XPoint Phase-Change Memory Works - PC Perspective&lt;/a>&lt;/p>
&lt;p>æˆ‘æ–‡ä¸­çš„å†…å®¹ä¹ŸåŸºæœ¬æ¥è‡ªäºè¿™ç¯‡æ–‡ç« ï¼Œä¸ºäº†é¿å…ç”Ÿç¡¬çš„ç¿»è¯‘ï¼Œæˆ‘è¿™é‡Œä¼šæºæ‚å¾ˆå¤šè‡ªå·±çš„è¯­è¨€è§£é‡Šï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹åŸæ–‡ã€‚&lt;/p>
&lt;p>Optane çš„å·¥ä½œåŸç†ä¸ NAND Flash æœ‰å¾ˆå¤§åŒºåˆ«ï¼ŒNAND Flash æ˜¯åŸºäº &lt;a class="link" href="https://en.wikipedia.org/wiki/Floating-gate_MOSFET" target="_blank" rel="noopener"
>Floating-gate MOSFET&lt;/a> è€Œ Optane è™½ç„¶å› ç‰¹å°”æ²¡æœ‰å®˜æ–¹èµ„æ–™è¯´æ˜ä½†æ˜¯æ ¹æ®å›½å¤–æœºæ„ç”¨&lt;a class="link" href="https://en.wikipedia.org/wiki/Mass_spectrometry" target="_blank" rel="noopener"
>è´¨è°±æ³•&lt;/a> æµ‹è¯•çš„ç»“æœè¡¨æ˜ Optane æ˜¯ä¸€ç§åŸºäº &lt;a class="link" href="https://en.wikipedia.org/wiki/Phase-change_memory" target="_blank" rel="noopener"
>PCM&lt;/a> (ç›¸å˜åŒ–å­˜å‚¨å™¨) åŸç†çš„å­˜å‚¨å™¨ï¼ŒPCM ç®€å•æ¥è¯´å°±æ˜¯æŸç§ç‰©è´¨ç›®å‰ä¸»è¦æ˜¯ä¸€ç§æˆ–å¤šç§ç¡«æ—åŒ–ç‰©çš„ç»ç’ƒï¼Œç»ç”±åŠ çƒ­å¯ä»¥æ”¹å˜å®ƒçš„çŠ¶æ€ï¼Œæˆä¸ºæ™¶ä½“æˆ–è€…éæ™¶ä½“ï¼Œè¿™äº›ä¸åŒçš„çŠ¶æ€å…·æœ‰ç›¸åº”çš„ç”µé˜»å€¼ã€‚&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 127;
flex-basis: 307px"
>
&lt;a href="https://tomwei7.com/2021/01/27/how-intel-optane-work/0.png" data-size="846x661">
&lt;img src="https://tomwei7.com/2021/01/27/how-intel-optane-work/0.png"
width="846"
height="661"
srcset="https://tomwei7.com/2021/01/27/how-intel-optane-work/0_hu6e124814faea8838e5a1c28a0f96c030_298795_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/01/27/how-intel-optane-work/0_hu6e124814faea8838e5a1c28a0f96c030_298795_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Untitled.png">
&lt;/a>
&lt;figcaption>Untitled.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>è¿™æ˜¯ä¸€å¼ å› ç‰¹å°” 3D XPoint memory çš„å®£ä¼ å›¾ï¼Œæ³¨æ„å…¶ä¸­å­˜å‚¨ Memory Cell å’Œ Selector ç»“æ„ï¼Œåé¢ä¼šæåˆ°&lt;/p>
&lt;p>è™½ç„¶å› ç‰¹å°”å¹¶æ²¡æœ‰æ‰¿è®¤å‚²è…¾æ˜¯åŸºäº PCM æŠ€æœ¯å¼€å‘çš„ï¼Œä½†æ˜¯è‹±ç‰¹å°”å’Œç¾å…‰åˆä½œç ”å‘åŸºäº PCM çš„å­˜å‚¨å™¨å·²ç»æœ‰å¾ˆå¤šå¹´äº†ï¼Œè€Œä¸”å‚²è…¾çš„ç§ç§ç‰¹æ€§ä¹ŸæŒ‡å‘äº†å®ƒæ˜¯åŸºäº PCM å¼€å‘çš„äº‹å®ã€‚&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 182;
flex-basis: 438px"
>
&lt;a href="https://tomwei7.com/2021/01/27/how-intel-optane-work/1.png" data-size="1423x778">
&lt;img src="https://tomwei7.com/2021/01/27/how-intel-optane-work/1.png"
width="1423"
height="778"
srcset="https://tomwei7.com/2021/01/27/how-intel-optane-work/1_hua5c32e4d0fc81479db18dd309554fc9b_155324_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/01/27/how-intel-optane-work/1_hua5c32e4d0fc81479db18dd309554fc9b_155324_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Untitled%201.png">
&lt;/a>
&lt;figcaption>Untitled%201.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>è¿™æ˜¯ä¸€å¼ è£¸ç‰‡(die)çº§åˆ«çš„ DRAM/PCM/NAND Flash å¯¹æ¯”å›¾ï¼ˆèµ„æ–™æ¥æºäºè¿™ç¯‡è®ºæ–‡&lt;a class="link" href="https://pcper.com/wp-content/uploads/2017/06/f1db-pcm-db-algo-cidr11.pdf" target="_blank" rel="noopener"
>link&lt;/a>ï¼‰&lt;/p>
&lt;p>è¿™ç¯‡è®ºæ–‡æ¥è‡ªäº 2011 å¹´ç°å¯èƒ½ç¨å¾®æœ‰ç‚¹è¿‡æ—¶ï¼Œä½†æ˜¯å®ƒç»™äº†æˆ‘ä»¬è£¸ç‰‡çº§åˆ«çš„é‡åŒ–çš„æ€§èƒ½å¯¹æ¯”ï¼Œå¯èƒ½çœ‹åˆ° XPoint ç›¸è¾ƒäº NAND Flash æœ‰è¿‘ 1000 å€é€Ÿåº¦å’Œ 1000 å€çš„è€ç”¨æ€§ã€‚å½“ç„¶è£¸ç‰‡çš„æ€§èƒ½å¹¶ä¸èƒ½ç›´æ¥åæ˜ åˆ°å®é™…çš„ SSD ä¸Šï¼Œå› ä¸ºæœ‰æ§åˆ¶å™¨çš„å¼€é”€ä»¥åŠå…¶ä»–çš„ç§ç§å› ç´ ã€‚æ¯”å¦‚è‹±ç‰¹å°”ç¬¬ä¸€ä»£ä½¿ç”¨å‚²è…¾æŠ€æœ¯çš„ SSD DC P4800X å®é™…æ€§èƒ½å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 125;
flex-basis: 301px"
>
&lt;a href="https://tomwei7.com/2021/01/27/how-intel-optane-work/2.png" data-size="1205x960">
&lt;img src="https://tomwei7.com/2021/01/27/how-intel-optane-work/2.png"
width="1205"
height="960"
srcset="https://tomwei7.com/2021/01/27/how-intel-optane-work/2_hu205ff512b2d4737dc640ba5d79e4342e_311843_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/01/27/how-intel-optane-work/2_hu205ff512b2d4737dc640ba5d79e4342e_311843_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Untitled%202.png">
&lt;/a>
&lt;figcaption>Untitled%202.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>P4800X çš„å»¶è¿Ÿå¤§çº¦åœ¨ 10us å·¦å³ï¼Œæ˜¯ NVMe SSD çš„åå€&lt;/p>
&lt;p>å¯¹æ¯”è£¸ç‰‡çš„æ€§èƒ½ï¼Œæœ‰äº›äººå¯èƒ½è§‰å¾—å®é™…æ€§èƒ½è¡¨ç°ä¸å¤Ÿå¥½ï¼Œä½†æ˜¯è¿™æ¯•ç«Ÿæ˜¯ç¬¬ä¸€ä»£äº§å“ã€‚æˆ‘ä»¬ç°åœ¨å¸¸ç”¨çš„é—ªå­˜ä¹Ÿæ˜¯ç»å†äº†å¥½å‡ åå¹´çš„å‘å±•çš„ã€‚&lt;/p>
&lt;p>ä¸‹é¢è§£é‡Šè¯¦ç»†çš„æŠ€æœ¯ç»†èŠ‚&lt;/p>
&lt;h3 id="ç›¸å˜åŒ–å­˜å‚¨å™¨pcm-æ˜¯å¦‚ä½•å·¥ä½œçš„">ç›¸å˜åŒ–å­˜å‚¨å™¨(PCM) æ˜¯å¦‚ä½•å·¥ä½œçš„&lt;/h3>
&lt;p>æƒ³è¦äº†è§£ XPoint ç»“æ„æ˜¯å¦‚ä½•è¯»å–å’Œå†™å…¥æ•°æ®çš„ï¼Œé¦–å…ˆè¦äº†è§£ç›¸å˜åŒ–ç‰©è´¨æ˜¯å¦‚ä½•å·¥ä½œçš„ä»¥åŠä»€ä¹ˆè¿™äº›ç‰©è´¨ä¸ºä»€ä¹ˆå…·æœ‰è¿™äº›ç‰¹æ€§&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 165;
flex-basis: 398px"
>
&lt;a href="https://tomwei7.com/2021/01/27/how-intel-optane-work/3.png" data-size="594x358">
&lt;img src="https://tomwei7.com/2021/01/27/how-intel-optane-work/3.png"
width="594"
height="358"
srcset="https://tomwei7.com/2021/01/27/how-intel-optane-work/3_hu65c3a4b41f08d092883748009ac55c60_47581_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/01/27/how-intel-optane-work/3_hu65c3a4b41f08d092883748009ac55c60_47581_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Untitled%203.png">
&lt;/a>
&lt;figcaption>Untitled%203.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>é»„è‰²çš„æ˜¯ç±»é‡‘å±/è“è‰²æ¡†ä¸­çš„æ˜¯æ°§æ—å…ƒç´ &lt;/p>
&lt;p>ç›¸å˜ææ–™ä¸€èˆ¬æ˜¯ç±»é‡‘å±çš„åˆé‡‘ï¼Œç±»é‡‘å±çš„å¤–è§‚å¤šåŠç±»ä¼¼é‡‘å±ï¼Œä½†åªæ˜¯å¼±çš„ç”µå¯¼ä½“ã€‚å¤§éƒ¨åˆ†ç±»é‡‘å±çš„ç‰©ç†ç‰¹æ€§åŠåŒ–å­¦ç‰¹æ€§éƒ½ä»‹äºé‡‘å±å’Œéé‡‘å±ä¹‹é—´ã€‚åœ¨å®¤æ¸©ä¸‹å¤„äºç»ç¼˜ä½“çŠ¶æ€ç»è¿‡åŠ çƒ­æˆ–æºæ‚å°±å˜ä¸ºå¯¼ä½“ã€‚æ•°å¹´æ¥äººç±»å·²ç»å¯¹å¤§é‡çš„ç±»é‡‘å±è¿›è¡Œè¿‡å®éªŒã€‚ç¡¼ï¼ˆBï¼‰ä¸»è¦ç”¨äºæºæ‚ï¼Œé’‹ï¼ˆPï¼‰ ä¼—æ‰€å‘¨çŸ¥å› ä¸ºæœ‰æ”¾å°„æ€§è€Œä¸”ä¸ç¨³å®šæ‰€ä»¥å¾ˆå°‘è§åˆ°:). ç¡…ï¼ˆSiï¼‰ æ˜¯å¾ˆå¥½çš„ç”¨äºåˆ¶ä½œæ™¶ä½“ç®¡å’Œå…¶ä»–åŠå¯¼ä½“å…ƒä»¶çš„ææ–™ä½†æ˜¯ä¸æ˜¯å¾ˆå¥½çš„ç›¸å˜ææ–™ã€‚å‰©ä¸‹é”—ï¼ˆGeï¼‰ï¼Œç ·ï¼ˆAsï¼‰ï¼Œé”‘ï¼ˆSbï¼‰å’Œç¢²ï¼ˆTeï¼‰ã€‚å®ƒä»¬çš„åˆé‡‘ä¼šç”Ÿäº§&lt;a class="link" href="https://en.wikipedia.org/wiki/Chalcogenide" target="_blank" rel="noopener"
>ç¡«æ—åŒ–ç‰©&lt;/a>ï¼Œåœ¨æœ¬æ–‡ä¸­æŒ‡çš„æ˜¯ä¸€ç§å«æœ‰ç¢²ï¼ˆTeï¼‰è´Ÿç¦»å­çš„åŒ–åˆç‰©ï¼ˆç¢²ï¼ˆTeï¼‰æ˜¯æ°§æ—å…ƒç´ ä¸­å”¯ä¸€ç¨³å®šçš„ç±»é‡‘å±ï¼‰ã€‚å½“æŠŠè¿™äº›å…ƒç´ è¿›è¡Œé€‚å½“çš„æ··åˆå°±èƒ½æˆ–å¾—ä¸€äº›ç‹¬ç‰¹çš„å±æ€§:&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 123;
flex-basis: 296px"
>
&lt;a href="https://tomwei7.com/2021/01/27/how-intel-optane-work/4.png" data-size="451x365">
&lt;img src="https://tomwei7.com/2021/01/27/how-intel-optane-work/4.png"
width="451"
height="365"
srcset="https://tomwei7.com/2021/01/27/how-intel-optane-work/4_hu3b0f4cf1d1c6b85992a51ef271f37656_26330_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/01/27/how-intel-optane-work/4_hu3b0f4cf1d1c6b85992a51ef271f37656_26330_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Untitled%204.png">
&lt;/a>
&lt;figcaption>Untitled%204.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>å°¤å…¶æ˜¯ï¼Œç±»é‡‘å±åˆé‡‘æ‹¥æœ‰å¤šç§ç¨³å®šçŠ¶æ€æ¯ä¸€ç§ç¨³å®šçŠ¶æ€éƒ½æœ‰ä¸åŒçš„ç”µé˜»å€¼ã€‚é€šè¿‡åŠ çƒ­å’Œå†·å´å¯ä»¥å®ç°ä»ä¸åŒçŠ¶æ€ä¹‹é—´çš„è½¬å˜ã€‚éæ™¶æ€å±æ€§ç±»ä¼¼äºç»ç’ƒè€Œç»“æ™¶æ€ç±»ä¼¼äºé‡‘å±ã€‚&lt;/p>
&lt;h3 id="ç›¸å˜åŒ–å­˜å‚¨å™¨pcm-çš„è¯»å†™">ç›¸å˜åŒ–å­˜å‚¨å™¨(PCM) çš„è¯»å†™&lt;/h3>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 249;
flex-basis: 597px"
>
&lt;a href="https://tomwei7.com/2021/01/27/how-intel-optane-work/5.png" data-size="994x399">
&lt;img src="https://tomwei7.com/2021/01/27/how-intel-optane-work/5.png"
width="994"
height="399"
srcset="https://tomwei7.com/2021/01/27/how-intel-optane-work/5_hu4bcf66b940e090e9ba5d0d2a19b2f7b9_91773_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/01/27/how-intel-optane-work/5_hu4bcf66b940e090e9ba5d0d2a19b2f7b9_91773_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Untitled%205.png">
&lt;/a>
&lt;figcaption>Untitled%205.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>å½“å‘ç›¸å˜ææ–™ä¸Šæ–½åŠ ç”µå‹æ—¶ï¼Œå¦‚æœææ–™å¤„äºéæ™¶ä½“ï¼ˆAmorphousï¼‰çš„çŠ¶æ€ï¼Œåœ¨ç”µå‹æ²¡æœ‰åˆ°è¾¾ä¸€ä¸ªé˜ˆå€¼å‰ï¼Œä¼šå¤„äºæˆªæ­¢çŠ¶æ€ä¸ä¼šæœ‰ç”µæµé€šè¿‡ï¼Œåªæœ‰å½“ç”µå‹è¶…è¿‡ä¸€ä¸ªé˜ˆå€¼æ‰ä¼šè¿è¡Œç”µæµé€šè¿‡ï¼Œä¸€æ—¦ç”µæµå¯¼é€šï¼Œéšç€ç”µå‹çš„å¢åŠ ç”µæµä¹Ÿä¼šé€æ­¥å¢åŠ ã€‚ç”±äºææ–™ç°åœ¨å¤„äºå¯¼ç”µçŠ¶æ€å®é™…ç›¸å½“äºä¸€ä¸ªç”µé˜»ï¼Œå› æ­¤ä¼šå‘çƒ­å¯¼è‡´æ¸©åº¦ä¸Šå‡ã€‚å½“ä¸€ç›´ä¿æŒåœ¨ set(1) çš„ç”µå‹æ—¶ï¼Œææ–™æœ€ç»ˆä¼šè¾¾åˆ°çº¦ 350æ‘„æ°åº¦çš„æ¸©åº¦ï¼Œè™½ç„¶è¿™ä¸ªæ¸©åº¦ä¸è¶³ä»¥å¯¼è‡´èåŒ–ï¼Œä½†æ˜¯å¦‚æœå°†æ¸©åº¦ç»´æŒçº¦ 100ns åˆ™å¯ä»¥ä½¿åˆ†å­é‡æ–°æ’åˆ—æˆæ™¶ä½“ï¼ˆcrystallineï¼‰ç»“æ„ã€‚ç”±äºæ™¶ä½“ï¼ˆcrystallineï¼‰ç»“æ„ä¹Ÿæ˜¯ç¨³å®šçŠ¶æ€æ‰€ä»¥ä¸€æ—¦å½¢æˆå³ä½¿å»é™¤ç”µå‹åæ¸©åº¦ä¸‹é™åä¹Ÿä¼šå¾—åˆ°ä¿ç•™ã€‚å¤„äºæ™¶ä½“ï¼ˆcrystallineï¼‰çŠ¶æ€çš„ç›¸å˜ææ–™æ€§è´¨ç±»ä¼¼äºæ™®é€šç”µé˜»ä¸å­˜åœ¨éæ™¶ä½“ï¼ˆAmorphousï¼‰çŠ¶æ€çš„ç”µå‹é˜ˆå€¼ï¼Œå½“æ–½åŠ  0.5V å·¦å³ç”µå‹æ—¶å°±æœ‰çº¦ 0.5mA çš„ç”µæµé€šè¿‡ã€‚&lt;/p>
&lt;p>å½“è¦é‡ç½® reset(0) åˆ°éæ™¶ä½“ï¼ˆAmorphousï¼‰çŠ¶æ€æ—¶ï¼Œåªéœ€è¦æ–½åŠ ä¸€ä¸ªæ›´å¤§çš„ç”µå‹ï¼ŒæŠŠæ¸©åº¦æé«˜åˆ°çº¦ 600æ‘„æ°åº¦å°†ææ–™åŠ çƒ­åˆ°ç†”èçŠ¶æ€ã€‚è¿™ä¼šèåŒ–æ™¶ä½“ï¼ˆcrystallineï¼‰ç»“æ„ã€‚ç„¶åç«‹åˆ»ç§»é™¤ç”µå‹è®©æ¸©åº¦è¿…é€Ÿä¸‹é™ï¼Œç”±äºç©¿è¿‡æ™¶ä½“ï¼ˆcrystallineï¼‰çŠ¶æ€çš„æ¸©åº¦åŒºé—´é€Ÿåº¦è¿‡å¿«æ‰€ä»¥æ— æ³•å½¢æˆä»»ä½•æ™¶ä½“ï¼ˆcrystallineï¼‰ç»“æ„ï¼Œé‡æ–°å†»ç»“åˆ°éæ™¶ä½“ï¼ˆAmorphousï¼‰çŠ¶æ€ï¼Œé‡ç½®å®Œæˆã€‚è¿™æ—¶å€™å¦‚ä½•æ–½åŠ  0.5V å·¦å³çš„ç”µå‹åˆ™ä¸ä¼šæœ‰ä»»ä½•ç”µæµç»è¿‡ã€‚å…¶å®æˆ‘ä»¬ä¸éœ€è¦å¾ˆé«˜çš„ç”µå‹å»è¯»å–çŠ¶æ€ï¼Œå¤§çº¦åœ¨ 0.1V å·¦å³å°±èƒ½å¾ˆæ˜æ˜¾çš„åŒºåˆ†å‡ºçŠ¶æ€ã€‚&lt;/p>
&lt;p>å¯ä»¥æ³¨æ„åˆ° PCM ä¸éœ€è¦åƒ NAND Flash ä¸€æ ·åœ¨è¿›è¡Œå†™å…¥ä¹‹å‰éœ€è¦è¿›è¡Œ erase æ“ä½œã€‚å¯ä»¥ç›´æ¥é€šè¿‡æ–½åŠ ä¸åŒçš„ç”µå‹è¿›è¡Œ set(1) å’Œ reset(0) æ“ä½œï¼Œå®Œå…¨ä¸éœ€è¦é¡¾åŠä¹‹å‰çš„çŠ¶æ€ã€‚NAND Flash åœ¨å†™å…¥å‰ä¸€èˆ¬éœ€è¦è¿›è¡Œ KB çº§åˆ«çš„ page çš„ erase æ“ä½œæœ‰æ—¶å€™ç”šè‡³æ˜¯ MB çº§åˆ«çš„ block çš„ erase æ“ä½œï¼ŒPCM å¯ä»¥å°±åœ°ï¼ˆin-placeï¼‰å†™å…¥ä»¥åŠå• bit çš„è¦†ç›–ã€‚&lt;/p>
&lt;h3 id="ç›¸å˜ææ–™æˆåˆ†">ç›¸å˜ææ–™æˆåˆ†&lt;/h3>
&lt;p>è‹±ç‰¹å°”å’Œç¾å…‰ä¸æ„¿æ„å…¬å¸ƒè‡ªå·±å®¶ XPoint çš„è¯¦ç»†æŠ€æœ¯ï¼Œå¸Œæœ›ä½ ç›¸ä¿¡ç»„æˆ XPoint çš„ä¸œè¥¿æ˜¯æŸç§éå¸¸ç¥ç§˜çš„ä¸œè¥¿ï¼Œä½†æ˜¯å…¶å®ä¸æ˜¯ã€‚å¸¸è§çš„ç›¸å˜åŒ–åˆé‡‘æ˜¯é”—ï¼Œé”‘å’Œç¢²çš„æ··åˆç‰©åŒ–å­¦è®¡é‡æ¯”ä¸º2:2:5 Ge2Sb2Te5ï¼Œç®€ç§°ä¸ºâ€œ GSTâ€ã€‚è·Ÿå¤§å¤šæ˜¯åˆé‡‘ä¸€æ ·ï¼Œé…æ–¹å®é™…å¯èƒ½æœ‰å¾ˆå¤šç»†å¾®çš„å˜åŒ–ï¼Œè¿™æ˜¯å„ä¸ªå‚å•†çš„å•†ä¸šæœºå¯†ã€‚&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 253;
flex-basis: 609px"
>
&lt;a href="https://tomwei7.com/2021/01/27/how-intel-optane-work/6.png" data-size="1059x417">
&lt;img src="https://tomwei7.com/2021/01/27/how-intel-optane-work/6.png"
width="1059"
height="417"
srcset="https://tomwei7.com/2021/01/27/how-intel-optane-work/6_hu93ec5664249e6901431e77ba42550ec2_146843_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/01/27/how-intel-optane-work/6_hu93ec5664249e6901431e77ba42550ec2_146843_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Untitled%206.png">
&lt;/a>
&lt;figcaption>Untitled%206.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>PCM çš„å¼€å‘äººå‘˜ä¼šé€šè¿‡å¯¹æ··åˆç‰©æ¯”ä¾‹çš„å¾®è°ƒæ¥æä¾›ææ–™çš„æ€§èƒ½ï¼Œæ¯”å¦‚ä»ä¸Šé¢çš„å›¾å¯ä»¥çœ‹åˆ°ç¨å¾®æé«˜é”‘ï¼ˆSbï¼‰çš„æµ“åº¦å¦‚ä½•æœ‰åŠ©äºé™ä½å¤ä½ç”µé˜»ï¼ˆé™ä½æ‰€éœ€çš„ç”µå‹ï¼‰ä»¥åŠå‡å°‘è®¾ç½®æ“ä½œæ‰€éœ€çš„æ—¶é—´ã€‚&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 280;
flex-basis: 673px"
>
&lt;a href="https://tomwei7.com/2021/01/27/how-intel-optane-work/7.png" data-size="1168x416">
&lt;img src="https://tomwei7.com/2021/01/27/how-intel-optane-work/7.png"
width="1168"
height="416"
srcset="https://tomwei7.com/2021/01/27/how-intel-optane-work/7_hua8fbad5389e6e4a314d0285590ac7e4b_314922_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/01/27/how-intel-optane-work/7_hua8fbad5389e6e4a314d0285590ac7e4b_314922_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Untitled%207.png">
&lt;/a>
&lt;figcaption>Untitled%207.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>ä¹Ÿè®¸ä½ ä¼šä»¥ä¸ºç›¸å˜ææ–™æ˜¯æŸç§æœ€è¿‘æ‰å‡ºç°çš„é«˜ç§‘æŠ€ææ–™ï¼Œå…¶å®æˆ‘ä»¬æ—©æ—©å°±ç”¨è¿‡äº†ã€‚å¯ä»¥åˆ»å½•çš„å…‰ç›˜å°±åˆ XPoint çš„ææ–™éå¸¸æ¥è¿‘ï¼Œå…‰ç›˜ä½¿ç”¨é“¶å’Œé“Ÿä»£æ›¿äº†GSTä¸­çš„é”—æ”¹å˜æ¥åˆé‡‘çš„æ€§èƒ½ã€‚ç©ºçš„å…‰ç›˜æ˜¯æ™¶ä½“çŠ¶ä½“ï¼Œé€šè¿‡å¯¹å†™å…¥æ¿€å…‰è¿›è¡Œè„‰å†²åŠ çƒ­ï¼Œè¿™äº›æ–‘ç‚¹è¿…é€Ÿå†·å´è€Œæ²¡æœ‰æœºä¼šé‡ç»“æ™¶ï¼Œå½¢æˆäº†è¾ƒæš—çš„åŒºåŸŸï¼Œç»“æ™¶çŠ¶æ€å’Œéæ™¶ä½“çŠ¶æ€çš„åå°„ç‡ä¸åŒï¼Œé€šè¿‡åå°„ç‡çš„ä¸åŒæ¥è¯»å–ä¿¡æ¯ã€‚æ“¦é™¤å…‰ç›˜çš„æ—¶å€™ä½¿ç”¨è¾ƒä½åŠŸç‡çš„æ¿€å…‰ï¼Œè®©å…‰ç›˜åœ¨åˆé€‚çš„æ¸©åº¦ä¸‹é‡æ–°å½¢æˆç»“æ™¶ã€‚&lt;/p>
&lt;h3 id="selectors">Selectors&lt;/h3>
&lt;p>æˆ‘ä»¬æ‹¥æœ‰äº†å¯ç”¨çš„åˆ¶ä½œç›¸å˜åŒ–å­˜å‚¨å™¨çš„ææ–™ä¹‹åï¼Œå°±éœ€è¦å°†å®ƒåšçš„å°½å¯èƒ½çš„å°å¹¶ä¸”å°½å¯èƒ½çš„ç´§å‡‘çš„æ’åˆ—èµ·æ¥ã€‚å­˜å‚¨å™¨å¯»å€çš„æ–¹å¼ä¸€èˆ¬æ˜¯é€šè¿‡ Bit/Word lines å³è¡Œ(rows)åˆ—(columns)çš„æ–¹å¼ï¼Œç®€å•æ¥è¯´æ§åˆ¶ç”µè·¯é€šè¿‡é€‰æ‹©æŒ‡å®šçš„è¡Œåˆ—æ¥é€‰æ‹©å­˜å‚¨å•å…ƒï¼Œé€šè¿‡æµ‹é‡ç”µæµæˆ–ç”µå‹çš„æ–¹å¼å–å›å­˜å‚¨çš„æ•°æ®ã€‚å¯¹äº NAND Flash è€Œè¨€ï¼Œæ¯ä¸ªå­˜å‚¨å•å…ƒå®é™…ä¸Šæ˜¯ç”µè·¯çš„ä¸€éƒ¨åˆ†ã€‚å¹¶ä¸”å½“å‰å•å…ƒçš„ç”µè·é‡æ§åˆ¶äº†æ™¶ä½“ç®¡çš„å¯¼ç”µç‡ã€‚&lt;/p>
&lt;p>å½“åˆ‡æ¢åˆ°çº¯ç”µé˜»ç±»å‹çš„å­˜å‚¨å™¨æ—¶ï¼Œä¸ºäº†è·å–å°½å¯èƒ½é«˜çš„å­˜å‚¨å¯†åº¦ã€‚ä¸€èˆ¬å°†è¡Œåˆ—çº¿ç›´æ¥äº¤é”™ï¼Œç„¶åå­˜å‚¨å•å…ƒè¿æ¥è¡Œåˆ—çº¿çš„äº¤å‰ç‚¹ã€‚è¿™ç§æ–¹å¼å°±å«åš crossbar ï¼ŒXPoint ç”¨çš„å°±æ˜¯è¿™ä¸€ç§æŠ€æœ¯ï¼Œå¯ä»¥ä»æœ€å¼€å§‹çš„å› ç‰¹å°”çš„å®£ä¼ å›¾ç‰‡ä¸Šçœ‹å‡ºæ¥ï¼š&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 240;
flex-basis: 576px"
>
&lt;a href="https://tomwei7.com/2021/01/27/how-intel-optane-work/8.png" data-size="1119x466">
&lt;img src="https://tomwei7.com/2021/01/27/how-intel-optane-work/8.png"
width="1119"
height="466"
srcset="https://tomwei7.com/2021/01/27/how-intel-optane-work/8_hufcc5cd64f32b03794142fc08cac13f50_133048_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/01/27/how-intel-optane-work/8_hufcc5cd64f32b03794142fc08cac13f50_133048_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Untitled%208.png">
&lt;/a>
&lt;figcaption>Untitled%208.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>è¿™ç§è¿æ¥æ–¹å¼æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼Œå°±æ˜¯å¹¶è”ç”µé˜»çš„é—®é¢˜ã€‚å½“å‘æŒ‡å®šçš„å­˜å‚¨å•å…ƒçš„ Bit/Word Line æ–½åŠ ç”µå‹æ—¶ï¼Œæ¯”å¦‚ä¸Šé¢çš„å³å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬åªå¸Œæœ›å‘ Rj æ–½åŠ ä¸€ä¸ªç”µå‹ï¼Œå¸Œæœ›ç”µæµåªæµè¿‡ Rjï¼Œä½†æ˜¯å®é™…å¯èƒ½å­˜åœ¨å¤šä¸ªå¹³è¡Œçš„è·¯å¾„ï¼Œæ¯”å¦‚è“çº¿æ‰€ç¤ºçš„è·¯å¾„ã€‚è¿™ç§å¹³è¡Œçš„è·¯å¾„ä¸€èˆ¬ä¼šæœ‰æ¯”è¾ƒé«˜çš„ç”µé˜»å€¼ï¼Œå› ä¸ºå¿…é¡»é€šè¿‡å¤šä¸ªä¸²è”çš„å­˜å‚¨å•å…ƒï¼Œä½†æ˜¯å½“è¿™ç§å¹³è¡Œè·¯å¾„æ•°é‡è¿‡å¤šæ—¶ä¼šå¯¼è‡´æµ‹é‡é”™è¯¯ï¼Œè€Œæ— æ³•è¯»å–æ•°æ®ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦é€šè¿‡ Selectorï¼ŒSelector é€šè¿‡ä»…ä»…å¼€å¯æˆ‘ä»¬å¸Œæœ›ç”µæµé€šè¿‡çš„è·¯å¾„çš„æ–¹å¼æ¥é¿å…å¹¶è”ç”µé˜»å¯¼è‡´çš„é—®é¢˜ã€‚ä¸€èˆ¬æ˜¯æ™¶ä½“ç®¡ï¼ŒäºŒæç®¡æˆ–è€…å…¶ä»–å¼€å…³å…ƒä»¶ã€‚&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 164;
flex-basis: 393px"
>
&lt;a href="https://tomwei7.com/2021/01/27/how-intel-optane-work/9.png" data-size="812x495">
&lt;img src="https://tomwei7.com/2021/01/27/how-intel-optane-work/9.png"
width="812"
height="495"
srcset="https://tomwei7.com/2021/01/27/how-intel-optane-work/9_huc534af96ee624e667afd59e893af7f84_64079_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/01/27/how-intel-optane-work/9_huc534af96ee624e667afd59e893af7f84_64079_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Untitled%209.png">
&lt;/a>
&lt;figcaption>Untitled%209.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>å¯èƒ½ç”¨äºç›¸å˜åŒ–å­˜å‚¨å™¨çš„ Selector æœ‰è¿™äº›ç±»å‹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ Cell Size&lt;/p>
&lt;p>å¤§å¤šæ•°æ™¶ä½“ç®¡çš„æ–¹æ³•çš„å¤§å°éƒ½è¿‡å¤§äº†ï¼ŒæŠµæ¶ˆäº† crossbar è¿™ç§æ–¹å¼å¸¦æ¥çš„å•ä½å¯†åº¦æå‡ï¼Œç”±äºéœ€è¦åšåˆ°æ¯” NAND Flash æ›´é«˜çš„å¯†åº¦ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªå­˜å‚¨å•å…ƒä¸€ä¸ªæ™¶ä½“ç®¡çš„æ–¹æ¡ˆæ˜¯ä¸å¯è¡Œçš„ã€‚äºŒæç®¡ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒæ›´åŠ çš„å°å·§ï¼Œä½†æ˜¯ä»ç„¶æ˜¯ä¸€ä¸ªè¿‡äºå¤æ‚çš„æ–¹æ¡ˆã€‚è¿˜æœ‰ä¸€ç§ç®€å•çš„æ–¹å¼å¯ä»¥å®Œå…¨é¿å…ä½¿ç”¨æ™¶ä½“ç®¡æˆ–è€…äºŒæç®¡ç”šè‡³ç›´æ¥å¤ç”¨ç”¨æ¥å­˜å‚¨æ•°æ®çš„ç›¸å˜ææ–™ï¼Œåªç”¨æˆ‘ä»¬èƒ½èƒ½æ‰¾è¿™ç§ææ–™ã€‚æ¯”å¦‚ä¸€ç§å…ƒä»¶å¯ä»¥ä»…ä»…åœ¨æ–½åŠ äº†è¶³å¤Ÿçš„ç”µå‹æ—¶æ‰é™ä½ç”µé˜»å€¼ï¼Œè¿™æ ·æ„å‘³ç€åªæœ‰è¢«é€‰ç‚¹çš„å­˜å‚¨å•å…ƒæ‰æœ‰ç”µæµæµè¿‡ï¼Œè€Œå…¶ä»–å¹¶è”è·¯å¾„å› ä¸ºå­˜åœ¨å¤šä¸ªå•å…ƒä¸²è”çš„æƒ…å†µï¼Œç”µå‹æ²¡æœ‰è¾¾åˆ°é˜ˆå€¼æ‰€ä»¥æ²¡æœ‰ç”µæµæµè¿‡ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ€§è´¨å’Œå¤„äºéæ™¶ä½“çŠ¶æ€å½“ç›¸å˜ææ–™æœ¬èº«çš„æ€§è´¨å¾ˆç›¸ä¼¼ï¼Œä¸è¿‡è¿˜éœ€è¦æ·»åŠ ä¸åŒçš„ææ–™æ‰èƒ½è®©å®ƒä½œä¸ºå¯é çš„å¼€å…³ä½¿ç”¨ã€‚ç®€å•æ¥è¯´å¸Œæœ› Selector å…ƒä»¶èƒ½å¤Ÿæ‹¥æœ‰ä¸€è‡´å±æ€§ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å®ƒåƒç›¸å˜ææ–™ä¸€æ ·å‘ç”ŸçŠ¶æ€æ°¸ä¹…å½“è½¬å˜éæ™¶ä½“â†’æ™¶ä½“ã€‚ä¸€èˆ¬é€šè¿‡ææ–™ä¸€èˆ¬é€šè¿‡å‘ææ–™ä¸­æ·»åŠ é˜²æ­¢ç»“æ™¶å½“å…¶ä»–å…ƒç´ ï¼ˆä¾‹å¦‚ç ·ï¼‰æ¥å®ç°ã€‚è¿™æ ·æˆ‘ä»¬å°±æˆ–å¾—äº†ä¸€ç§ä»…åœ¨ç”µå‹è¶…è¿‡é˜ˆå€¼æ—¶æ‰ä¼šå¯¼ç”µå½“ææ–™ã€‚&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 143;
flex-basis: 344px"
>
&lt;a href="https://tomwei7.com/2021/01/27/how-intel-optane-work/10.png" data-size="539x376">
&lt;img src="https://tomwei7.com/2021/01/27/how-intel-optane-work/10.png"
width="539"
height="376"
srcset="https://tomwei7.com/2021/01/27/how-intel-optane-work/10_hu8aeb8fb2cb39aa1f334d19238a9824fd_37885_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/01/27/how-intel-optane-work/10_hu8aeb8fb2cb39aa1f334d19238a9824fd_37885_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Untitled%2010.png">
&lt;/a>
&lt;figcaption>Untitled%2010.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>An Ovonic Threshold Switch (OTS). æ¯æ¬¡å½“ç”µå‹ç§»é™¤æ¸©åº¦ä¸‹é™æ—¶ï¼Œä¼šé‡æ–°å›åˆ°éæ™¶ä½“çŠ¶æ€ï¼Œæ°¸è¿œä¸ä¼šå‡ºç°æ™¶ä½“çŠ¶æ€ï¼Œæ‰€ä»¥ä¸å¯ä»¥ç”¨ä½œå­˜å‚¨å™¨ä½†æ˜¯å¯ä»¥ä½œä¸ºå¼€å…³ä½¿ç”¨ã€‚&lt;/p>
&lt;p>åœ¨ crossbar å¸ƒå±€ä¸­ä¸æ²¡æœ‰ PCM å­˜å‚¨å•å…ƒä¸²è”æ”¾ç½®ä¸€ä¸ª OTSï¼Œåˆ™åªæœ‰åœ¨æ–½åŠ è¶³å¤Ÿç”µå‹ä½¿ OTS å¯¼é€šåï¼Œæˆ‘ä»¬æ‰èƒ½è®¿é—® PCM å­˜å‚¨å•å…ƒã€‚ç”±äºå¹³è¡Œçš„çº¿è·¯ä¸€èˆ¬ç”±å¤šä¸ªä¸²è”çš„ OTS/PCM å¯¹ç»„æˆï¼Œå› æ­¤åªæœ‰æ‰€é€‰å•å…ƒçš„ OTS æ‰èƒ½çœ‹åˆ°è¶³å¤Ÿçš„ç”µå‹æ‰èƒ½æ¥é€šï¼Œå¹³è¡Œçº¿è·¯ä¸­çš„ OTS å…¨éƒ¨ä¿æŒå…³é—­çŠ¶æ€ä¸å¯¼ç”µï¼Œä»è€Œå¯ä»¥ä»¥æœ€å°çš„å¹²æ‰°è¯»å–å­˜å‚¨å•å…ƒçš„æ•°æ®ã€‚ç†Ÿæ‚‰ NAND Flash çš„äººå¯èƒ½ä¼šçŸ¥é“ NAND Flash å­˜åœ¨ä¸€ç§è¢«ç§°ä¹‹ä¸ºè¯»å–å¹²æ‰°çš„ç°è±¡ï¼Œå› ä¸ºè¯»å–æ“ä½œå¯èƒ½ä¼šç•¥å¾®æ”¹å˜ç›¸é‚»å•å…ƒæ ¼çš„å­˜å‚¨ç”µè·ã€‚PCM ç”±äºè¯»å–æ—¶äº§ç”Ÿçš„çƒ­é‡è¿œä½äºè½¬åŒ–ä¸ºç»“æ™¶ä½“æ‰€éœ€çš„çƒ­é‡ï¼Œæ„å‘³ç€è¯»å–æ—¶ä¸ä¼šå¹²æ‰°ä»»ä½•çš„å­˜å‚¨å•å…ƒã€‚&lt;/p>
&lt;h3 id="scalability-æ‰©å±•æ€§">Scalability æ‰©å±•æ€§&lt;/h3>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 143;
flex-basis: 345px"
>
&lt;a href="https://tomwei7.com/2021/01/27/how-intel-optane-work/11.png" data-size="587x408">
&lt;img src="https://tomwei7.com/2021/01/27/how-intel-optane-work/11.png"
width="587"
height="408"
srcset="https://tomwei7.com/2021/01/27/how-intel-optane-work/11_hu06fdd35d49c5b44ebc38dbd7732ba8cb_18871_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/01/27/how-intel-optane-work/11_hu06fdd35d49c5b44ebc38dbd7732ba8cb_18871_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Untitled%2011.png">
&lt;/a>
&lt;figcaption>Untitled%2011.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>ç”±äºåˆ¶ä½œå·¥è‰ºçš„æå‡ NAND Flash é¢ä¸´ç€å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚è€ä¹…åº¦çš„ä¸‹é™ç­‰ã€‚ä½†æ˜¯å¯¹äº PCM å­˜å‚¨æ¥è¯´ç¡®å®ç›¸åçš„ï¼Œå› ä¸º GST ææ–™å…·æœ‰ç”µé˜»æ€§ï¼Œè€Œä¸”å¿…é¡»åŠ çƒ­ä¸å‘¨å›´ç¯å¢ƒä¿æŒçƒ­ç»ç¼˜ï¼Œæ‰€ä»¥ PCM çš„å°ºå¯¸è¶Šå°è¶Šå¥½ã€‚äº‹å®ä¸Šï¼Œè¿™äº›å¹´æ¥é˜»ç¢PCMæŠ€æœ¯å‘å±•çš„ä¸»è¦å› ç´ ä¹‹ä¸€æ˜¯æ‰€éœ€çš„ç¼–ç¨‹ç”µæµè¿‡é«˜è€Œæ— æ³•åœ¨é«˜å¯†åº¦è®¾å¤‡ä¸­ä½¿ç”¨ã€‚è¾ƒå°çš„å•å…ƒå°†åœ¨è¾ƒå°çš„é¢ç§¯ä¸Šè½¬åŒ–ä¸ºè¾ƒä½çš„ç”µé˜»ï¼Œè¿™æ„å‘³ç€åŠ çƒ­è¾ƒå°ç©ºé—´æ‰€éœ€çš„åŠŸç‡è¾ƒå°‘ï¼Œå› æ­¤å¯¹ç»™å®šå•å…ƒè¿›è¡Œç¼–ç¨‹éœ€è¦çš„ç”µå‹å’Œç”µæµè¾ƒä½ã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼Œç›®å‰çš„åˆ¶ç¨‹è¿˜æœ‰å¾ˆå¤§çš„è¿›æ­¥çš„ç©ºé—´ã€‚ä¸è¿‡è¦åœ¨æ ‡å‡†ç¡…æ™¶ç‰‡ä¸Šè·å¾—å®Œç¾åˆ†å‰²çš„GSTå±‚çš„å·¥è‰ºæå…¶å¤æ‚ã€‚å› ç‰¹å°”å’Œç¾å…‰ç›®å‰å·²ç»å®ç°äº† 20nm çš„å·¥è‰ºã€‚&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 140;
flex-basis: 337px"
>
&lt;a href="https://tomwei7.com/2021/01/27/how-intel-optane-work/12.png" data-size="894x635">
&lt;img src="https://tomwei7.com/2021/01/27/how-intel-optane-work/12.png"
width="894"
height="635"
srcset="https://tomwei7.com/2021/01/27/how-intel-optane-work/12_hue02bbe8d6b06b175984c7f679c92765f_649495_480x0_resize_box_2.png 480w, https://tomwei7.com/2021/01/27/how-intel-optane-work/12_hue02bbe8d6b06b175984c7f679c92765f_649495_1024x0_resize_box_2.png 1024w"
loading="lazy"
alt="Untitled%2012.png">
&lt;/a>
&lt;figcaption>Untitled%2012.png&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>æ ¹æ®&lt;a class="link" href="http://www.techinsights.com/about-techinsights/overview/blog/intel-3D-xpoint-memory-die-removed-from-intel-optane-pcm/" target="_blank" rel="noopener"
>TechInsights&lt;/a>æ•°æ®ï¼ŒXPoint å°† 20nmèŠ‚ç‚¹ç”¨äºå­—çº¿å’Œä½çº¿ï¼Œå•å…ƒå°ºå¯¸ä¸º 0.00176 um2ã€‚ä¸Šå›¾çš„ç»†çº¿æ˜¯ä¸¤å±‚å †å çš„PCMå•å…ƒã€‚&lt;/p>
&lt;p>XPoint å½“å‰ä»…ä½¿ç”¨äº†ä¸¤å±‚ï¼Œä¸ä½äº XPoint é˜µåˆ—ä¸‹æ–¹çš„æ§åˆ¶ç”µè·¯ç›¸æ¯”ï¼Œè¿™äº›å±‚æ˜¾å¾—éå¸¸çš„è–„ã€‚è¿™å°±ç•™å‡ºäº†è¶³å¤Ÿçš„ç©ºé—´æ¥æ‰©å±•æ›´å¤šçš„å±‚ï¼Œä»è€Œæ‰©å±•æé«˜å•ç‰‡çš„å®¹é‡ã€‚å½“ç„¶ï¼Œè¿™ç§å †å ä¹Ÿæœ‰å±€é™æ€§ï¼Œå› ä¸ºå®ƒä»¬å¼•å…¥é¢å¤–çš„å¹³è¡Œè·¯å¾„ï¼Œè¿™äº›å¹³è¡Œè·¯å¾„å¯èƒ½ä¼šå¹²æ‰°è¯»å–ã€‚è™½ç„¶ OTS Selector é¿å…äº†è¿™ç§æƒ…å†µï¼Œä½†æ˜¯å®ƒä»¬ä¹Ÿå¹¶ä¸æ˜¯å®Œç¾çš„å¼€å…³ï¼Œå½“å¹³è¡Œè·¯å¾„çš„æ•°é‡è¶³å¤Ÿå¤šæ—¶ï¼Œä»»ä½•ä¼šäº§ç”Ÿå¹²æ‰°ã€‚è¿™æ„å‘³ç€å¦‚æœä¸ç ”ç©¶å‡ºå…¶ä»–æ–¹å¼çš„è¯ï¼Œå †å çš„å±‚æ•°å³å•ç‰‡å®¹é‡å°†å—åˆ°æå¤§çš„é™åˆ¶ã€‚&lt;/p>
&lt;h3 id="æ€»ç»“">æ€»ç»“&lt;/h3>
&lt;p>ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº†ä»€ä¹ˆæ˜¯ç›¸å˜åŒ–ææ–™ï¼Œç›¸å˜åŒ–å­˜å‚¨å™¨ï¼ˆPCMï¼‰çš„è¯»å–è¿‡ç¨‹ï¼Œä»¥åŠ Selector å¯èƒ½çš„ å®ç°æ–¹å¼ï¼ŒåŸºæœ¬ä¸Šäº†è§£æ¸…æ¥šäº† XPoint çš„å·¥ä½œåŸç†ã€‚ä¸è¿‡ç›®å‰å› ç‰¹å°”å¹¶æ²¡æœ‰å…¬å¼€å…¬å¸ƒè¿‡å‚²è…¾ç›¸å…³çš„æŠ€æœ¯ç»†èŠ‚ï¼Œè¿™äº›èµ„æ–™ä¹Ÿæ˜¯ç ”ç©¶æœºæ„å¯¹å¸‚é¢ä¸Šçš„å‚²è…¾äº§å“é€†å‘ä¹‹åç»™å‡ºçš„ç»“è®ºã€‚ä¸è¿‡æ€»çš„æ¥è¯´ PCM å­˜å‚¨å™¨ç›¸è¾ƒäº NAND Flash æœ‰ç€æ›´å¤šçš„ä¼˜ç‚¹ï¼ŒPCM å¯èƒ½æ˜¯æœªæ¥æœ€æœ‰å¯èƒ½ä»£æ›¿ NAND Flash çš„æŠ€æœ¯äº†ã€‚å¸Œæœ›å‡ å¹´å PCM èƒ½æœ‰æŠ€æœ¯ä¸Šçš„çªç ´ï¼Œèƒ½åƒç°åœ¨ NAND Flash ä¸€æ ·çš„ç™½èœä»·ã€‚&lt;/p></description></item><item><title>Jetson Nano USB Boot é…ç½®</title><link>https://tomwei7.com/2021/01/25/jetson-nano-usb-boot.html</link><pubDate>Mon, 25 Jan 2021 00:00:00 +0000</pubDate><guid>https://tomwei7.com/2021/01/25/jetson-nano-usb-boot.html</guid><description>&lt;img src="https://tomwei7.com/2021/01/25/jetson-nano-usb-boot/jetson-nano.jpg" alt="Featured image of post Jetson Nano USB Boot é…ç½®" />&lt;p>Jetson Nano æ˜¯ NVIDIA æ¨å‡ºçš„ Aot åµŒå…¥å¼å¹³å°ï¼Œæ‹¥æœ‰ 4 æ ¸å¿ƒä¸»é¢‘ 1.43GHZ çš„ Cortex-A57 CPU å’Œ128ç»„472GFLOPS ï¼ˆFP16ï¼‰çš„Maxwellæ¶æ„ GPU ä»¥åŠ 4GB LPDDR4 å†…å­˜ã€‚ é…ç½®ååˆ†å¼ºå¤§ï¼Œå¯æ˜¯å’Œæ ‘è“æ´¾ä¸€æ ·é»˜è®¤ä½¿ç”¨ SD å¡ä½œä¸ºå­˜å‚¨ï¼ŒSD å¡åˆ°æ€§èƒ½ç›´æ¥å½±å“äº†æ—¥å¸¸åˆ°ä½¿ç”¨ä½“éªŒã€‚è€Œå¤§å®¹é‡é«˜é€Ÿçš„ SD å¡ä»·æ ¼å®åœ¨æ„Ÿäººã€‚è€ƒè™‘åˆ° Jetson Nano æ‹¥æœ‰å››ä¸ª USB3.0 5G é€Ÿç‡çš„æ¥å£ï¼Œä½¿ç”¨ USB å¤–æ¥ SSD ä¹Ÿè®¸æ˜¯æ›´å¥½çš„è§£å†³æ–¹æ³•ã€‚&lt;/p>
&lt;p>è¿™é‡Œé¦–å…ˆä»‹ç»ä¸‹ Jetson Nano çš„å¯åŠ¨è¿‡ç¨‹ï¼ŒJetson Nano ä½¿ç”¨ä¸¤é˜¶æ®µå¯åŠ¨çš„æ–¹å¼ï¼Œé¦–å…ˆ Bootloader ä¼šä» sdcard åŠ è½½ä¸€ä¸ªæ¯”è¾ƒå°çš„ initrd (initial ramdisk)ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå¾ˆå°çš„ç³»ç»Ÿï¼Œé€šè¿‡è¿™ä¸ªå°ç³»ç»Ÿå†å»åŠ è½½ Linux Kernalã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">+------------------+ +--------+ +--------------+
| | | | | |
|bootloader&lt;span style="color:#f92672">(&lt;/span>u-boot&lt;span style="color:#f92672">)&lt;/span>+-------&amp;gt;+ initrd +------&amp;gt;+ Linux kernel |
| | | | | |
+------------------+ +--------+ +--------------+
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Jetson Nano å®˜æ–¹æ–‡æ¡£å¹¶æ²¡æœ‰æåˆ°å¯ä»¥é€šè¿‡ USB å¯åŠ¨ï¼Œé»˜è®¤çš„ initrd ç³»ç»Ÿä¹Ÿä¸åŒ…å« USB é©±åŠ¨ï¼Œæ‰€ä»¥initrd æ²¡åŠæ³•åŠ è½½ USB è¿›è¡Œå¯åŠ¨ï¼ŒGithub ä¸Šæœ‰ä¸ªé¡¹ç›®å«åš &lt;a class="link" href="https://github.com/JetsonHacksNano/rootOnUSB" target="_blank" rel="noopener"
>https://github.com/JetsonHacksNano/rootOnUSB&lt;/a> ï¼Œé€šè¿‡é‡æ–°ç¼–è¯‘ initrd æ·»åŠ  USB é©±åŠ¨çš„æ–¹å¼ï¼Œè®© initrd å¯ä»¥ä» USB è®¾å¤‡å¯åŠ¨ Linuxã€‚&lt;/p>
&lt;p>ä½†æ˜¯ç»è¿‡å°è¯•å‘ç°è¿™ç§æ–¹å¼å·²ç»æ²¡æœ‰åŠæ³•ä» USB å¯åŠ¨ Jetson Nano ä¼šè®©ç³»ç»Ÿé™·å…¥æ— é™é‡å¯çš„å¾ªç¯ã€‚è€ƒè™‘åˆ°è¿™ä¸ªé¡¹ç›®æœ€åæ›´æ–°è¿˜æ˜¯17æœˆä»¥å‰ï¼Œè€Œç°åœ¨ Jetson Nano ç³»ç»Ÿç‰ˆæœ¬å·²ç»æ›´æ–°å¤šæ¬¡ï¼Œå¯èƒ½å·²ç»æ— æ³•å…¼å®¹äº†ã€‚&lt;/p>
&lt;p>æ— å¥ˆåªèƒ½æ¥ä¸Šäº†ä¸²å£å¯ä»¥è°ƒè¯•å¯åŠ¨è¿‡ç¨‹ï¼Œæ— æ„ä¸­å‘ç°ç°åœ¨ç‰ˆæœ¬çš„ U-Bootï¼ˆJetson Nano çš„ Bootloaderï¼‰åœ¨å°è¯•æ£€æµ‹ USB è®¾å¤‡ï¼Œå°è¯•ç¿»é˜… NVIDIA ç›¸å…³æ–‡æ¡£ä¹Ÿè¯´æ˜äº†è¿™ä¸€ç‚¹ &lt;a class="link" href="https://docs.nvidia.com/jetson/l4t/index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/uboot_guide.html#wwpID0E06E0HA" target="_blank" rel="noopener"
>https://docs.nvidia.com/jetson/l4t/index.html#page/Tegra Linux Driver Package Development Guide/uboot_guide.html#wwpID0E06E0HA&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>Boot Sequence and Sysboot Configuration Files
U-Boot functionality includes a default booting scan sequence. It scans bootable devices in the following order:&lt;/p>
&lt;ul>
&lt;li>External SD card&lt;/li>
&lt;li>Internal eMMC&lt;/li>
&lt;li>USB device or NVMe device (Jetson TX2 series only)&lt;/li>
&lt;li>NFS network via DHCP/PXE&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>æ‰€ä»¥å…¶å®å®˜æ–¹çš„ Bootloader å·²ç»æ—©å°±æ”¯æŒäº† USB å¯åŠ¨äº†ï¼Œä½†æ˜¯ç”±äºé»˜è®¤çš„é•œåƒæ˜¯ä¸º SD å¡å‡†å¤‡çš„ï¼Œå¹¶ä¸èƒ½ç›´æ¥ç”¨äº USB è®¾å¤‡ã€‚è¿™é‡Œéœ€è¦è¿›è¡Œä¸€ç‚¹ç‚¹ä¿®æ”¹ã€‚&lt;/p>
&lt;p>é¦–å…ˆç›´æ¥å°†ä¸‹è½½çš„ Jetson Nano çš„ SD é•œåƒå†™å…¥ SSD ä¸­è¿™é‡Œçš„è¿‡ç¨‹å’Œå†™å…¥ SD å¡ä¸€æ ·ï¼Œç”±äº SD é•œåƒçš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ ext4 æ ¼å¼ï¼Œè¿™é‡Œéœ€è¦ä¸€å° Linux ç³»ç»Ÿçš„æœºå™¨æ¥æŒ‚è½½ ext4 çš„æ–‡ä»¶ç³»ç»Ÿå¹¶ä¿®æ”¹å¯åŠ¨å‚æ•°ã€‚&lt;/p>
&lt;p>å°†å†™å¥½çš„ SSD ç›˜ä½¿ç”¨ &lt;code>parted&lt;/code> æ‰“å¼€ï¼Œå¯ä»¥çœ‹åˆ°æœ‰è¿™äº›åˆ†åŒº&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&amp;gt;&amp;gt; sudo parted /dev/sda
GNU Parted 3.2
Using /dev/sda
Welcome to GNU Parted! Type &lt;span style="color:#e6db74">&amp;#39;help&amp;#39;&lt;/span> to view a list of commands.
&lt;span style="color:#f92672">(&lt;/span>parted&lt;span style="color:#f92672">)&lt;/span> print
Model: ATA INTEL SSDSC2BB16 &lt;span style="color:#f92672">(&lt;/span>scsi&lt;span style="color:#f92672">)&lt;/span>
Disk /dev/sda: 160GB
Sector size &lt;span style="color:#f92672">(&lt;/span>logical/physical&lt;span style="color:#f92672">)&lt;/span>: 512B/512B
Partition Table: gpt
Disk Flags:
Number Start End Size File system Name Flags
&lt;span style="color:#ae81ff">2&lt;/span> 1049kB 1180kB 131kB TBC
&lt;span style="color:#ae81ff">3&lt;/span> 2097kB 2556kB 459kB RP1
&lt;span style="color:#ae81ff">4&lt;/span> 3146kB 3736kB 590kB EBT
&lt;span style="color:#ae81ff">5&lt;/span> 4194kB 4260kB 65.5kB WB0
&lt;span style="color:#ae81ff">6&lt;/span> 5243kB 5439kB 197kB BPF
&lt;span style="color:#ae81ff">7&lt;/span> 6291kB 6685kB 393kB BPF-DTB
&lt;span style="color:#ae81ff">8&lt;/span> 7340kB 7406kB 65.5kB FX
&lt;span style="color:#ae81ff">9&lt;/span> 8389kB 8847kB 459kB TOS
&lt;span style="color:#ae81ff">10&lt;/span> 9437kB 9896kB 459kB DTB
&lt;span style="color:#ae81ff">11&lt;/span> 10.5MB 11.3MB 786kB LNX
&lt;span style="color:#ae81ff">12&lt;/span> 11.5MB 11.6MB 65.5kB EKS
&lt;span style="color:#ae81ff">13&lt;/span> 12.6MB 12.8MB 197kB BMP
&lt;span style="color:#ae81ff">14&lt;/span> 13.6MB 13.8MB 131kB RP4
&lt;span style="color:#ae81ff">1&lt;/span> 14.7MB 160GB 160GB ext4 APP
&lt;/code>&lt;/pre>&lt;/div>&lt;p>éœ€è¦æŒ‚è½½çš„åˆ†åŒºæ˜¯ APP è¿™é‡Œå°† APP åˆ†åŒºå³ &lt;code>/dev/sda1&lt;/code> æŒ‚è½½åˆ° &lt;code>/mnt&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">sudo mount /dev/sda1 /mnt
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ‰“å¼€ &lt;code>/mnt/boot/extlinux/extlinux.conf&lt;/code> æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°é•œåƒé»˜è®¤å°† root æŒ‡å‘äº† &lt;code>/dev/mmcblk0p1&lt;/code> å³ sd å¡çš„ç¬¬ä¸€ä¸ªåˆ†åŒº&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">LABEL primary
MENU LABEL primary kernel
LINUX /boot/Image
INITRD /boot/initrd
APPEND &lt;span style="color:#e6db74">${&lt;/span>cbootargs&lt;span style="color:#e6db74">}&lt;/span> quiet root&lt;span style="color:#f92672">=&lt;/span>/dev/mmcblk0p1 rw rootwait rootfstype&lt;span style="color:#f92672">=&lt;/span>ext4 console&lt;span style="color:#f92672">=&lt;/span>ttyS0,115200n8 console&lt;span style="color:#f92672">=&lt;/span>tty0 fbcon&lt;span style="color:#f92672">=&lt;/span>map:0 net.ifnames&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç›´æ¥å°† &lt;code>/dev/mmcblk0p1&lt;/code> æ”¹æˆ &lt;code>/dev/sda1&lt;/code> å³å¯&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">LABEL primary
MENU LABEL primary kernel
LINUX /boot/Image
INITRD /boot/initrd
APPEND &lt;span style="color:#e6db74">${&lt;/span>cbootargs&lt;span style="color:#e6db74">}&lt;/span> quiet root&lt;span style="color:#f92672">=&lt;/span>/dev/sda1 rw rootwait rootfstype&lt;span style="color:#f92672">=&lt;/span>ext4 console&lt;span style="color:#f92672">=&lt;/span>ttyS0,115200n8 console&lt;span style="color:#f92672">=&lt;/span>tty0 fbcon&lt;span style="color:#f92672">=&lt;/span>map:0 net.ifnames&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œæ›´åŠ ä¿é™©çš„åšæ³•åº”è¯¥æ˜¯ä½¿ç”¨åˆ†åŒºçš„ UUID æˆ–è€… LABEL æ¥æŒ‡å®šç£ç›˜ï¼Œä½†æ˜¯ç»è¿‡æµ‹è¯•ä¸ç®¡æ˜¯ UUID è¿˜æ˜¯ LABEL å‡ä¼šå¯¼è‡´å¯åŠ¨å¤±è´¥ã€‚æ‰€ä»¥è¦æ³¨æ„ä½¿ç”¨ USB å¯åŠ¨æ—¶ï¼Œåœ¨ Jetson Nano å¼€æœºçš„æ—¶å€™åªèƒ½æ’ä¸€ä¸ªç£ç›˜ï¼Œä¸ç„¶å¯èƒ½ä¼šå¯¼è‡´å¯åŠ¨å¤±è´¥&lt;/p>
&lt;p>ç°åœ¨ä» Jetson Nano ä¸­ç§»é™¤ç°æœ‰çš„ SD å¡ï¼Œæ’å…¥ USB SSD é‡æ–°å¯åŠ¨å°±èƒ½ä» USB å¯åŠ¨ã€‚&lt;/p>
&lt;p>å¦‚æœä½¿ç”¨ USB å¤–æ¥ SSD éœ€è¦æ³¨æ„ï¼Œæœ€å¥½ä½¿ç”¨ 5V4A çš„ç”µæºï¼Œè€Œä¸è¦ä½¿ç”¨ microUSB ä¾›ç”µã€‚éå¸¸å®¹æ˜“å¯¼è‡´ä¾›ç”µä¸è¶³ã€‚&lt;/p>
&lt;p>æœ€åé™„ä¸Š USB SSD ä¸ SD å¡çš„æ€§èƒ½æµ‹è¯•ï¼Œè™½ç„¶ Jetson Nano çš„ USB 3.0 æ¥å£æ¯”è¾ƒæ‹‰èƒ¯ï¼Œä½†æ˜¯ä¾ç„¶å¯ä»¥ç§’æ€ SD å¡ï¼Œå¹³æ—¶ä½¿ç”¨åœ¨ç¼–è¯‘æ—¶ä¹Ÿå¯ä»¥æ„Ÿè§‰åˆ°æ˜æ˜¾çš„æ€§èƒ½æå‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#75715e"># USB SSD (Intel DC S3500 160G)&lt;/span>
READ: bw&lt;span style="color:#f92672">=&lt;/span>263MiB/s &lt;span style="color:#f92672">(&lt;/span>276MB/s&lt;span style="color:#f92672">)&lt;/span>, 263MiB/s-263MiB/s &lt;span style="color:#f92672">(&lt;/span>276MB/s-276MB/s&lt;span style="color:#f92672">)&lt;/span>, io&lt;span style="color:#f92672">=&lt;/span>8192MiB &lt;span style="color:#f92672">(&lt;/span>8590MB&lt;span style="color:#f92672">)&lt;/span>, run&lt;span style="color:#f92672">=&lt;/span>31169-31169msec
WRITE: bw&lt;span style="color:#f92672">=&lt;/span>101MiB/s &lt;span style="color:#f92672">(&lt;/span>106MB/s&lt;span style="color:#f92672">)&lt;/span>, 101MiB/s-101MiB/s &lt;span style="color:#f92672">(&lt;/span>106MB/s-106MB/s&lt;span style="color:#f92672">)&lt;/span>, io&lt;span style="color:#f92672">=&lt;/span>4096MiB &lt;span style="color:#f92672">(&lt;/span>4295MB&lt;span style="color:#f92672">)&lt;/span>, run&lt;span style="color:#f92672">=&lt;/span>40686-40686msec
&lt;span style="color:#75715e"># SDCard (KIOXIA EXCERIA 32G U1)&lt;/span>
READ: bw&lt;span style="color:#f92672">=&lt;/span>85.6MiB/s &lt;span style="color:#f92672">(&lt;/span>89.8MB/s&lt;span style="color:#f92672">)&lt;/span>, 85.6MiB/s-85.6MiB/s &lt;span style="color:#f92672">(&lt;/span>89.8MB/s-89.8MB/s&lt;span style="color:#f92672">)&lt;/span>, io&lt;span style="color:#f92672">=&lt;/span>8192MiB &lt;span style="color:#f92672">(&lt;/span>8590MB&lt;span style="color:#f92672">)&lt;/span>, run&lt;span style="color:#f92672">=&lt;/span>95709-95709msec
WRITE: bw&lt;span style="color:#f92672">=&lt;/span>12.2MiB/s &lt;span style="color:#f92672">(&lt;/span>12.8MB/s&lt;span style="color:#f92672">)&lt;/span>, 12.2MiB/s-12.2MiB/s &lt;span style="color:#f92672">(&lt;/span>12.8MB/s-12.8MB/s&lt;span style="color:#f92672">)&lt;/span>, io&lt;span style="color:#f92672">=&lt;/span>512MiB &lt;span style="color:#f92672">(&lt;/span>537MB&lt;span style="color:#f92672">)&lt;/span>, run&lt;span style="color:#f92672">=&lt;/span>42007-42007msec
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>è®°ä¸€æ¬¡ ImageMagick jpeg ç¼©æ”¾æ€§èƒ½è°ƒä¼˜</title><link>https://tomwei7.com/2020/10/11/imagemagick-tuning.html</link><pubDate>Sun, 11 Oct 2020 00:00:00 +0000</pubDate><guid>https://tomwei7.com/2020/10/11/imagemagick-tuning.html</guid><description>&lt;img src="https://tomwei7.com/2020/10/11/imagemagick-tuning/df35a6b35caea63c4be3c19947407fe4426a2b3c-small.jpg" alt="Featured image of post è®°ä¸€æ¬¡ ImageMagick jpeg ç¼©æ”¾æ€§èƒ½è°ƒä¼˜" />&lt;p>ç”±äºåŒäº‹äº†è°ƒå²—ï¼Œæ¥æ‰‹äº†ä¸€ä¸ªç®€å•çš„ç¼©ç•¥å›¾æœåŠ¡ï¼Œå¤§ä½¬çœ‹ä¹‹å‰çš„ä»£ç è¿‡äºæ··(la)ä¹±(ji)å¤§æ‰‹ä¸€æŒ¥å¸¦ç€æˆ‘ä»¬ç”¨ C++ é‡æ„äº†è¿™ä¸ªæœåŠ¡ï¼Œæ•…äº‹å°±å‘ç”Ÿåœ¨æ–°æœåŠ¡ä¸Šçº¿å‡ å‘¨åã€‚åœ¨ä¸€ä¸ªæ„‰å¿«çš„å‘¨äº”ä¸‹ç­åï¼Œæ­£åœ¨æ¡Œä¸Šåƒç€ç«é”…çªç„¶æ”¶åˆ°å‘Šè­¦æœåŠ¡å¼€å§‹è¶…æ—¶ï¼Œèµ¶ç´§è”ç³»åŒäº‹é‡å¯äº†ä¸€æ³¢ï¼Œä½†æ˜¯æ•ˆæœç”šå¾®ã€‚æ— å¥ˆç´§æ€¥åˆ‡å›æ¥æ—§æœåŠ¡ã€‚&lt;/p>
&lt;p>äº‹åè¿›è¡Œåˆ†æå‘ç°æ˜¯å› ä¸ºæœ‰ä¸€å¼ éå¸¸é«˜åˆ†è¾¨ç‡çš„å›¾ç‰‡å¯¼è‡´çš„ï¼Œç”±äºä¸Šä¼ æ—¶åªé™åˆ¶äº†ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡ä½“ç§¯å¤§å°æ²¡æœ‰æ£€æŸ¥å›¾ç‰‡å®é™…åˆ†è¾¨ç‡å†åŠ ä¸Šä¸Šæ¸¸æœåŠ¡çš„ä¸åˆç†é‡è¯•ï¼Œå‡ ä¹è®©è¿™å¼ å›¾ç‰‡å æ»¡äº†æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œæœ€ç»ˆå¯¼è‡´é›ªå´©ã€‚&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 138;
flex-basis: 333px"
>
&lt;a href="https://tomwei7.com/2020/10/11/imagemagick-tuning/df35a6b35caea63c4be3c19947407fe4426a2b3c-small.jpg" data-size="1000x720">
&lt;img src="https://tomwei7.com/2020/10/11/imagemagick-tuning/df35a6b35caea63c4be3c19947407fe4426a2b3c-small.jpg"
width="1000"
height="720"
srcset="https://tomwei7.com/2020/10/11/imagemagick-tuning/df35a6b35caea63c4be3c19947407fe4426a2b3c-small_hu2fc75db2453bb048d467a4727f6ed77a_213366_480x0_resize_q75_box.jpg 480w, https://tomwei7.com/2020/10/11/imagemagick-tuning/df35a6b35caea63c4be3c19947407fe4426a2b3c-small_hu2fc75db2453bb048d467a4727f6ed77a_213366_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
alt="ç½ªé­ç¥¸é¦–.jpeg">
&lt;/a>
&lt;figcaption>ç½ªé­ç¥¸é¦–.jpeg&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>ç”±äºå›¾ç‰‡å¤ªå¤§ä¸Šé¢çš„æ˜¯ç¼©ç•¥å›¾ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç‚¹å‡»è¿™é‡Œä¸‹è½½åŸå›¾&lt;a class="link" href="df35a6b35caea63c4be3c19947407fe4426a2b3c.jpeg" >ç½ªé­ç¥¸é¦–.jpeg&lt;/a>, åŸå›¾çš„å¤§å°å¤§å°çº¦ 24000x17280 æ€»åƒç´ è¶…è¿‡4äº¿&lt;/p>
&lt;h3 id="é—®é¢˜é‡ç°">é—®é¢˜é‡ç°&lt;/h3>
&lt;p>ç«Ÿç„¶çŸ¥é“äº†é—®é¢˜æ˜¯è¶…é«˜åˆ†è¾¨ç‡ï¼Œå°±éœ€è¦çœ‹çœ‹æœ‰æ²¡æœ‰å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ã€‚å›¾ç‰‡å¤„ç†æˆ‘ä»¬ä¸»è¦ä½¿ç”¨çš„æ˜¯ ImageMagick è¿™ä¸ªå¼€æºåº“ï¼Œé¦–å…ˆå°†æœåŠ¡æœ€å°åŒ–ï¼Œç¼©ç•¥å›¾çš„ä¸»è¦é€»è¾‘å¤§æ¦‚å°±è¿™å‡ è¡Œ&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c++" data-lang="c++">Magick&lt;span style="color:#f92672">::&lt;/span>Image im;
im.read(&lt;span style="color:#e6db74">&amp;#34;big-img.jpeg&amp;#34;&lt;/span>);
im.filterType(Magick&lt;span style="color:#f92672">::&lt;/span>LanczosFilter);
im.resize(Magick&lt;span style="color:#f92672">::&lt;/span>Geometry(&lt;span style="color:#ae81ff">400&lt;/span>, &lt;span style="color:#ae81ff">288&lt;/span>));
im.write(&lt;span style="color:#e6db74">&amp;#34;thumbnail.jpeg&amp;#34;&lt;/span>);
&lt;/code>&lt;/pre>&lt;/div>&lt;p>é¦–å…ˆç”¨å‡ºé—®é¢˜çš„å›¾ç‰‡è·‘ä¸€ä¸‹è¯•è¯• (å› ä¸ºä¸€äº›èµ„æºç®¡ç†é—®é¢˜ï¼ŒImageMagick åœ¨è¿™é‡Œæ²¡æœ‰å¼€å¯ openmpï¼Œéƒ½æ˜¯å•çº¿ç¨‹å·¥ä½œçš„)&lt;/p>
&lt;pre>&lt;code>User time (seconds): 9.71
System time (seconds): 0.96
Percent of CPU this job got: 99%
Maximum resident set size (kbytes): 4954472
&lt;/code>&lt;/pre>&lt;p>åœ¨æˆ‘è‡ªå·±ç”µè„‘ä¸Šå¤§çº¦éœ€è¦ 10s å ç”¨çº¦ 4G å†…å­˜ï¼Œå®é™…åœ¨å…¬å¸æœåŠ¡å™¨å¤§çº¦éœ€è¦ 15s å·¦å³ (AMD Yes!)ï¼Œå¯¹äºä¸€ä¸ªåœ¨çº¿æœåŠ¡å¾ˆæ˜æ˜¾æ˜¯ä¸èƒ½æ¥å—çš„ã€‚é€šè¿‡ perf å·¥å…·å¯ä»¥çœ‹å‡ºï¼ŒCPU ä¸»è¦éƒ½æ˜¯èŠ±åœ¨ resize çš„è¿‡ç¨‹ä¸­ã€‚&lt;/p>
&lt;p>è°ƒæ•´ filterType å¯ä»¥èµ·åˆ°ä¼˜åŒ–çš„å·¦å³ï¼Œæ¯”å¦‚å°†ä½†æ˜¯è°ƒæ•´ filterType åˆ° PointFilterï¼Œå¤„ç†æ—¶é—´ä¸€ä¸‹å­å°±å¯ä»¥æ¥åˆ° 1.4s å†…å­˜å ç”¨è¿˜æ˜¯ 4Gï¼Œä½†æ˜¯å›¾ç‰‡æ•ˆæœåŸºæœ¬å°±ä¸èƒ½æ¥å—äº†&lt;/p>
&lt;pre>&lt;code>User time (seconds): 1.40
System time (seconds): 0.91
Percent of CPU this job got: 99%
Maximum resident set size (kbytes): 4953288
&lt;/code>&lt;/pre>&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 138;
flex-basis: 333px"
>
&lt;a href="https://tomwei7.com/2020/10/11/imagemagick-tuning/pointfilter-1.jpeg" data-size="400x288">
&lt;img src="https://tomwei7.com/2020/10/11/imagemagick-tuning/pointfilter-1.jpeg"
width="400"
height="288"
srcset="https://tomwei7.com/2020/10/11/imagemagick-tuning/pointfilter-1_huf2e2f9a75bb0d59f349533868ace8fb9_57903_480x0_resize_q75_box.jpeg 480w, https://tomwei7.com/2020/10/11/imagemagick-tuning/pointfilter-1_huf2e2f9a75bb0d59f349533868ace8fb9_57903_1024x0_resize_q75_box.jpeg 1024w"
loading="lazy"
alt="pointfilter-1.jpeg">
&lt;/a>
&lt;figcaption>pointfilter-1.jpeg&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>è€Œä¸”ä¿®æ”¹ filterType å¯èƒ½ä¼šå¯¼è‡´å…¶ä»–å›¾ç‰‡æœ€ç»ˆå‘ˆç°çš„æ•ˆæœä¸çº¦å®šçš„ä¸ä¸€è‡´ï¼Œæ‰€ä»¥ filterType åŸºæœ¬ä¸Šæ˜¯ä¸èƒ½ä¿®æ”¹çš„ã€‚&lt;/p>
&lt;h3 id="ä»-imagemagick-å…¥æ‰‹">ä» ImageMagick å…¥æ‰‹&lt;/h3>
&lt;p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘åˆå»ç¿»äº†ä¸€ä¸‹ ImageMagick çš„æ–‡æ¡£ä¸ä»£ç ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯å·²ç»æœ‰å¯¹è¿™ç§è¶…é«˜åˆ†è¾¨ç‡çš„å›¾ç‰‡åšç¼©ç•¥å›¾çš„ä¼˜åŒ–äº†ï¼Œæ¯•ç«Ÿè¿™ä¸ªæ˜¯å¾ˆå¸¸è§çš„éœ€æ±‚ã€‚æœç„¶ ImageMagick é™¤äº† &lt;code>resize&lt;/code> è¿˜æä¾›äº†ä¸€ä¸ª &lt;code>thumbnail&lt;/code> çš„æ–¹æ³•ï¼Œ&lt;code>thumbnail&lt;/code> é¡¾åæ€ä¹‰å°±æ˜¯ç”¨æ¥ç”Ÿæˆç¼©ç•¥å›¾çš„ï¼Œç¿»äº†ä¸€ä¸‹ä»£ç  &lt;code>thumbnail&lt;/code> ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹&lt;/p>
&lt;ol>
&lt;li>å¯¹åŸå›¾è¿›è¡Œç®€å•é‡‡æ ·åŠæ¯éš” 5 ä¸ªåƒç´ ç‚¹å–ä¸€ä¸ªï¼Œç­‰äºå°†åŸå›¾é•¿å®½éƒ½ç¼©å°åˆ°ä»¥å‰çš„äº”åˆ†ä¹‹ä¸€&lt;/li>
&lt;li>è¿›è¡Œæ™®é€š &lt;code>resize&lt;/code> æ“ä½œ&lt;/li>
&lt;/ol>
&lt;p>å› ä¸ºç¬¬ä¸€æ­¥çš„é‡‡æ ·è¿‡ç¨‹éå¸¸æš´åŠ›ï¼Œæ‰€æœ‰åªæœ‰åˆ°ç¼©ç•¥å›¾çš„å¤§å°æ˜¯åŸå›¾é¢ç§¯çš„ 10% ä»¥ä¸‹è€Œä¸”åŸå›¾çš„é•¿å®½éƒ½éœ€è¦å¤§äº25åƒç´ ï¼Œå¦åˆ™éƒ½ä¼šé™çº§ä¸ºæ™®é€šçš„ &lt;code>resize&lt;/code> æ“ä½œ&lt;/p>
&lt;p>ç®€å•ä¿®æ”¹ä¸‹ä»£ç è¿›è¡Œæµ‹è¯•&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c++" data-lang="c++">Magick&lt;span style="color:#f92672">::&lt;/span>Image im;
im.read(&lt;span style="color:#e6db74">&amp;#34;big-img.jpeg&amp;#34;&lt;/span>);
im.filterType(Magick&lt;span style="color:#f92672">::&lt;/span>LanczosFilter);
im.thumbnail(Magick&lt;span style="color:#f92672">::&lt;/span>Geometry(&lt;span style="color:#ae81ff">400&lt;/span>, &lt;span style="color:#ae81ff">288&lt;/span>));
im.write(&lt;span style="color:#e6db74">&amp;#34;thumbnail.jpeg&amp;#34;&lt;/span>);
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ”¹ç”¨ &lt;code>thumbnail&lt;/code> è€—æ—¶ä¸€ä¸‹å­é™åˆ°åˆ° 1.4s å·¦å³ï¼ŒåŸºæœ¬å’Œä½¿ç”¨ PointFilter æ€§èƒ½å·®ä¸å¤šï¼Œè€Œä¸”æœ€ç»ˆè¾“å‡ºçš„å›¾ç‰‡ä¸ç›´æ¥è¿›è¡Œ &lt;code>resize&lt;/code> çš„ç»“æœä»è‚‰çœ¼ä¸ŠåŸºæœ¬æ²¡æœ‰å·®è·ï¼Œä½†æ˜¯ä»ç„¶ä¼šå ç”¨çº¦ 4G å·¦å³çš„å†…å­˜ã€‚&lt;/p>
&lt;pre>&lt;code>User time (seconds): 1.44
System time (seconds): 0.90
Percent of CPU this job got: 99%
Maximum resident set size (kbytes): 4912756
&lt;/code>&lt;/pre>&lt;p>ä½¿ç”¨ &lt;code>thumbnail&lt;/code> ç»“æœ&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 138;
flex-basis: 333px"
>
&lt;a href="https://tomwei7.com/2020/10/11/imagemagick-tuning/thumbnail-1.jpeg" data-size="400x288">
&lt;img src="https://tomwei7.com/2020/10/11/imagemagick-tuning/thumbnail-1.jpeg"
width="400"
height="288"
srcset="https://tomwei7.com/2020/10/11/imagemagick-tuning/thumbnail-1_hue3986c2b13178fba7736002e4ff90722_49247_480x0_resize_q75_box.jpeg 480w, https://tomwei7.com/2020/10/11/imagemagick-tuning/thumbnail-1_hue3986c2b13178fba7736002e4ff90722_49247_1024x0_resize_q75_box.jpeg 1024w"
loading="lazy"
alt="thumbnail-1.jpeg">
&lt;/a>
&lt;figcaption>thumbnail-1.jpeg&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>ç›´æ¥ &lt;code>resize&lt;/code> ç»“æœ&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 138;
flex-basis: 333px"
>
&lt;a href="https://tomwei7.com/2020/10/11/imagemagick-tuning/direct-resize.jpeg" data-size="400x288">
&lt;img src="https://tomwei7.com/2020/10/11/imagemagick-tuning/direct-resize.jpeg"
width="400"
height="288"
srcset="https://tomwei7.com/2020/10/11/imagemagick-tuning/direct-resize_hu2c71c5a01e1e6cc3ad72b664c024de70_49150_480x0_resize_q75_box.jpeg 480w, https://tomwei7.com/2020/10/11/imagemagick-tuning/direct-resize_hu2c71c5a01e1e6cc3ad72b664c024de70_49150_1024x0_resize_q75_box.jpeg 1024w"
loading="lazy"
alt="direct-resize.jpeg">
&lt;/a>
&lt;figcaption>direct-resize.jpeg&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;h3 id="ä»-jpeg-æ ¼å¼å…¥æ‰‹">ä» jpeg æ ¼å¼å…¥æ‰‹&lt;/h3>
&lt;p>è™½ç„¶ä½¿ç”¨äº† &lt;code>thumbnail&lt;/code> å¯ä»¥è§£å†³è€—æ—¶é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ¬¡å¤„ç†è¦å ç”¨ 4G å¤šå†…å­˜è¿˜æ˜¯ä¸å¯æ¥å—çš„ã€‚è¦é¿å…å ç”¨è¿™ä¹ˆå¤šå†…å­˜å°±è¦é¿å…ä¸€æ¬¡æŠŠæ‰€æœ‰åƒç´ éƒ½æ”¾åˆ°å†…å­˜é‡Œé¢ï¼Œä¸€èˆ¬ä¼šæƒ³åˆ°çš„å°±æ˜¯é€šè¿‡æµå¼çš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè¿™æ ·å°±èƒ½å¤§å¤§é™ä½å†…å­˜å ç”¨äº†ï¼Œå¦ä¸€ä¸ªå¼€æºçš„å›¾ç‰‡å¤„ç†åº“&lt;a class="link" href="https://github.com/libvips/libvips" target="_blank" rel="noopener"
>libvips&lt;/a> å°±æ˜¯è¿™æ ·åšçš„ï¼Œä½†æ˜¯å°† ImageMagick æ”¹é€ æˆæµå¼å¤„ç†çš„è¯è¿™ä¸ªå·¥ä½œé‡å°±è¿‡å¤§äº†ã€‚å¯¹äº jpeg è¿™ç§å›¾ç‰‡æ ¼å¼è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹å¼å°±æ˜¯å¯ä»¥åœ¨è§£å‹åƒç´ çš„æ—¶å€™åšåˆ°ç±»ä¼¼ç¼©æ”¾çš„åŠŸèƒ½ï¼Œè¿™é‡Œå°±è¦ç‰µæ‰¯åˆ° jpeg çš„å·¥ä½œåŸç†äº†ï¼Œjpeg çš„å‹ç¼©ç®—æ³•åŸºäº&lt;a class="link" href="https://zh.wikipedia.org/wiki/%E7%A6%BB%E6%95%A3%E4%BD%99%E5%BC%A6%E5%8F%98%E6%8D%A2" target="_blank" rel="noopener"
>ç¦»æ•£ä½™å¼¦å˜æ¢&lt;/a>ï¼Œè¿™é‡Œæ‰“ä¸ªæ¯”æ–¹å¯ä»¥ç†è§£ä¸º jpeg å°†åƒç´ å­˜å‚¨åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå½“è§£å‹çš„æ—¶å€™è¾“å…¥åƒç´ çš„ä¸‹æ ‡å°±èƒ½è·å¾—è¿™ä¸ªåƒç´ åŸå§‹çš„æ•°æ®ï¼Œæ¯”å¦‚å¯¹äºä¸€ä¸ª 1000x1000 çš„å›¾ç‰‡ï¼Œæˆ‘å¸Œæœ›åœ¨è§£å‹æˆä¸€å¼  500*500 å›¾ç‰‡ï¼Œé‚£æ ·åœ¨è§£å‹æ—¶æˆ‘åªè¦è·³è¿‡é‚£äº›æˆ‘ä¸éœ€è¦çš„åƒç´ ç‚¹å°±å¥½äº†ï¼Œå½“æ—¶å®é™…æƒ…å†µæ›´åŠ å¤æ‚ï¼Œjpeg ä¹Ÿä¸æ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªå‡½æ•°ä¸­çš„ã€‚è¿™é‡Œæ¨èä¸€ä¸ªå¾ˆå¥½çš„ä»‹ç» jpeg å·¥ä½œåŸç†çš„è§†é¢‘ &lt;a class="link" href="https://www.youtube.com/watch?v=f2odrCGjOFY" target="_blank" rel="noopener"
>How JPEG works&lt;/a>&lt;/p>
&lt;p>æœ‰äº†è¿™æ ·çš„ç†è®ºåŸºç¡€æˆ‘ä»¬å°±å¯ä»¥å®è·µäº†ï¼Œå…¶å® &lt;code>libjpeg&lt;/code> å·²ç»æä¾›äº†è¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥å†è§£å‹ jpeg çš„æ—¶å€™æŒ‡å®šç¼©æ”¾çš„æ¯”ä¾‹ï¼Œæ¯”ä¾‹æœ‰å›ºå®šçš„æ¡£ä½åœ¨ 1~8 ä¹‹é—´ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å°åªèƒ½ç¼©æ”¾åˆ°åŸå›¾çš„é•¿å®½çš„å…«åˆ†ä¹‹ä¸€ã€‚ åœ¨ ImageMagick ä¸­è®¾ç½®è¿™ä¸ªå‚æ•°çš„æ–¹å¼æœ‰ç‚¹è¯¡å¼‚ï¼Œä»£ç å¦‚ä¸‹ï¼Œè¿™é‡ŒæŒ‡å®š &lt;code>jpeg:size&lt;/code> å…¶å®åªæ˜¯æŒ‡å®šäº†ä¸€ä¸ªæœŸæœ›å€¼å®é™…è·å¾—çš„å›¾ç‰‡å¤§å°ä¼šæ˜¯ä¸€ä¸ªå¤§äºç›®æ ‡å°ºå¯¸çš„æœ€å°å€¼ï¼Œæ¯”å¦‚è¿™æ¬¡æµ‹è¯•çš„å›¾ç‰‡å®é™…è·å¾—çš„å›¾ç‰‡å¤§å°æ˜¯ 3000x2160ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-c++" data-lang="c++">Magick&lt;span style="color:#f92672">::&lt;/span>Image im;
MagickCore&lt;span style="color:#f92672">::&lt;/span>ImageInfo&lt;span style="color:#f92672">*&lt;/span> im_info &lt;span style="color:#f92672">=&lt;/span> im.imageInfo();
im_info&lt;span style="color:#f92672">-&amp;gt;&lt;/span>options &lt;span style="color:#f92672">=&lt;/span> MagickCore&lt;span style="color:#f92672">::&lt;/span>NewSplayTree(MagickCore&lt;span style="color:#f92672">::&lt;/span>CompareSplayTreeString, (&lt;span style="color:#66d9ef">void&lt;/span>&lt;span style="color:#f92672">*&lt;/span>(&lt;span style="color:#f92672">*&lt;/span>)(&lt;span style="color:#66d9ef">void&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)) &lt;span style="color:#66d9ef">nullptr&lt;/span>, (&lt;span style="color:#66d9ef">void&lt;/span>&lt;span style="color:#f92672">*&lt;/span>(&lt;span style="color:#f92672">*&lt;/span>)(&lt;span style="color:#66d9ef">void&lt;/span>&lt;span style="color:#f92672">*&lt;/span>)) &lt;span style="color:#66d9ef">nullptr&lt;/span>);
MagickCore&lt;span style="color:#f92672">::&lt;/span>AddValueToSplayTree((MagickCore&lt;span style="color:#f92672">::&lt;/span>SplayTreeInfo&lt;span style="color:#f92672">*&lt;/span>)(im_info&lt;span style="color:#f92672">-&amp;gt;&lt;/span>options), &lt;span style="color:#e6db74">&amp;#34;jpeg:size&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;400x288&amp;#34;&lt;/span>);
im.read(&lt;span style="color:#e6db74">&amp;#34;big-img.jpeg&amp;#34;&lt;/span>);
im.filterType(Magick&lt;span style="color:#f92672">::&lt;/span>LanczosFilter);
im.resize(Magick&lt;span style="color:#f92672">::&lt;/span>Geometry(&lt;span style="color:#ae81ff">400&lt;/span>, &lt;span style="color:#ae81ff">288&lt;/span>));
im.write(&lt;span style="color:#e6db74">&amp;#34;shrink-on-load.jpeg&amp;#34;&lt;/span>);
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¼˜åŒ–ä¹‹åè€—æ—¶é™ä½åˆ°äº† 0.4s å·¦å³ï¼Œå†…å­˜ä¹Ÿé™åˆ°äº† 100Mï¼ è€Œä¸”æœ€ç»ˆè¾“å‡ºçš„ç»“æœä¸ç›´æ¥è¿›è¡Œ &lt;code>resize&lt;/code> çš„ç»“æœä»è‚‰çœ¼ä¸ŠåŸºæœ¬æ²¡æœ‰å·®è·&lt;/p>
&lt;pre>&lt;code>User time (seconds): 0.42
System time (seconds): 0.02
Percent of CPU this job got: 99%
Maximum resident set size (kbytes): 104656
&lt;/code>&lt;/pre>&lt;p>è§£å‹æ—¶ç¼©æ”¾ç»“æœ&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 138;
flex-basis: 333px"
>
&lt;a href="https://tomwei7.com/2020/10/11/imagemagick-tuning/shrink-on-load.jpeg" data-size="400x288">
&lt;img src="https://tomwei7.com/2020/10/11/imagemagick-tuning/shrink-on-load.jpeg"
width="400"
height="288"
srcset="https://tomwei7.com/2020/10/11/imagemagick-tuning/shrink-on-load_hu80e10e32ba5b77d6eeb4656f1c5ccdee_49050_480x0_resize_q75_box.jpeg 480w, https://tomwei7.com/2020/10/11/imagemagick-tuning/shrink-on-load_hu80e10e32ba5b77d6eeb4656f1c5ccdee_49050_1024x0_resize_q75_box.jpeg 1024w"
loading="lazy"
alt="shrink-on-load.jpeg">
&lt;/a>
&lt;figcaption>shrink-on-load.jpeg&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;p>ç›´æ¥ &lt;code>resize&lt;/code> ç»“æœ&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 138;
flex-basis: 333px"
>
&lt;a href="https://tomwei7.com/2020/10/11/imagemagick-tuning/shrink-on-load.jpeg" data-size="400x288">
&lt;img src="https://tomwei7.com/2020/10/11/imagemagick-tuning/shrink-on-load.jpeg"
width="400"
height="288"
srcset="https://tomwei7.com/2020/10/11/imagemagick-tuning/shrink-on-load_hu80e10e32ba5b77d6eeb4656f1c5ccdee_49050_480x0_resize_q75_box.jpeg 480w, https://tomwei7.com/2020/10/11/imagemagick-tuning/shrink-on-load_hu80e10e32ba5b77d6eeb4656f1c5ccdee_49050_1024x0_resize_q75_box.jpeg 1024w"
loading="lazy"
alt="shrink-on-load.jpeg">
&lt;/a>
&lt;figcaption>shrink-on-load.jpeg&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;h3 id="é¢˜å¤–è¯">é¢˜å¤–è¯&lt;/h3>
&lt;p>å› ä¸º ImageMagick ä¸æ”¯æŒ SIMD åŠ é€Ÿåœ¨æµ‹è¯•çš„è¿‡ç¨‹æˆ‘ä¹Ÿå°è¯•è¿‡ä½¿ç”¨æ”¯æŒ SIMD åŠ é€Ÿçš„å›¾ç‰‡åº“æ¯”å¦‚ &lt;a class="link" href="https://github.com/uploadcare/pillow-simd" target="_blank" rel="noopener"
>pillow-simd&lt;/a> å¤„ç†å®Œæ•´åˆ†è¾¨ç‡çš„å›¾åƒä¹ŸåŸºæœ¬èƒ½æ§åˆ¶åœ¨ 1s çº§åˆ«ï¼Œä¸èƒ½åˆ©ç”¨ç°ä»£ CPU çš„åŠŸèƒ½æ˜¯ ImageMagick çš„ç¡¬ä¼¤&lt;/p>
&lt;h3 id="æ€»ç»“">æ€»ç»“&lt;/h3>
&lt;p>è¿™æ¬¡ç¼©ç•¥å›¾çš„ä¼˜åŒ–ï¼Œå¯¹äºè¿™ç§è¶…å¤§åˆ†è¾¨ç‡çš„å›¾ç‰‡å¤„ç†é€Ÿåº¦æå‡äº†ä¸€ä¸ªæ•°é‡çº§ (10s -&amp;gt; 0.5s) åŒæ—¶å†…å­˜å ç”¨ä¹Ÿé™åˆ°äº†ä¸€ä¸ªæ•°é‡çº§ (4G -&amp;gt; 100M)ã€‚åŸºæœ¬ä¸Šè¾¾åˆ°äº†åœ¨çº¿æœåŠ¡çš„èƒ½åŠ›ã€‚è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬æ²¡äº‹åˆ«å»é‡æ„è€æœåŠ¡ğŸ˜…&lt;/p>
&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;ul>
&lt;li>&lt;a class="link" href="http://www.imagemagick.org/Usage/thumbnails/" target="_blank" rel="noopener"
>Imagemagick thumbnails/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://libjpeg-turbo.org/" target="_blank" rel="noopener"
>libjpeg-turbo.org/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://stackoverflow.com/questions/42022982/imagemagick-single-convert-command-performance" target="_blank" rel="noopener"
>Imagemagick Single Convert Command Performance&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.youtube.com/watch?v=f2odrCGjOFY" target="_blank" rel="noopener"
>How JPEG works&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>9102 å¹´åœ¨å›½å†…å¦‚ä½•å¿«é€Ÿçš„ä¸‹è½½ Docker é•œåƒ, ç°å­˜ Docker é•œåƒæºæ¨ªè¯„</title><link>https://tomwei7.com/2019/07/12/how-to-pull-docker-image-fast-in-china.html</link><pubDate>Fri, 12 Jul 2019 00:00:00 +0000</pubDate><guid>https://tomwei7.com/2019/07/12/how-to-pull-docker-image-fast-in-china.html</guid><description>&lt;img src="https://tomwei7.com/2019/07/12/how-to-pull-docker-image-fast-in-china/docker-hub.png" alt="Featured image of post 9102 å¹´åœ¨å›½å†…å¦‚ä½•å¿«é€Ÿçš„ä¸‹è½½ Docker é•œåƒ, ç°å­˜ Docker é•œåƒæºæ¨ªè¯„" />&lt;p>Docker ä» 2013 å‘å¸ƒä¸€ç›´å¹¿å—ç©ç›®ï¼Œä½†æ˜¯éšç€ k8s ç­‰é¡¹ç›®çš„å‘å±•ï¼ŒDocker Swarm çš„å¤±è´¥ï¼ŒDocker ä½œä¸ºä¸€ä¸ªåº•å±‚çš„å®¹å™¨è¿è¡Œæ—¶è¶Šæ¥è¶Šè¾¹ç¼˜åŒ–ï¼Œè€Œä¸”éšç€ä¾‹å¦‚ &lt;a class="link" href="github.com/rkt/rkt" >rkt&lt;/a>, &lt;a class="link" href="https://github.com/alibaba/pouch" target="_blank" rel="noopener"
>pouch&lt;/a> ç­‰é¡¹ç›®çš„å‡ºç°ï¼ŒDocker ä½œä¸ºåº•å±‚å®¹å™¨è¿è¡Œæ—¶çš„åœ°ä½ä¹Ÿåœ¨å—åˆ°æŒ‘æˆ˜ã€‚&lt;/p>
&lt;p>ä½†æ˜¯å°±ç›®å‰æ¥è¯´ Docker ä»ç„¶æ˜¯å¼€å‘è€…å¿«é€Ÿéƒ¨ç½²å¼€å‘ä¾èµ–çš„æœ€å¥½é€‰æ‹©ï¼Œè€Œä¸”ä½†æ˜¯å³ä½¿ Docker ä¸åœ¨äº†ï¼ŒDocker Image ä¹Ÿå°†ä½œä¸ºä¸€ä¸ªæ ‡å‡†çš„å®¹å™¨é•œåƒæ ¼å¼ä¿ç•™ä¸‹æ¥ã€‚ä½†æ˜¯ 2018 å¹´ä½ Docker å´æ‚„æ‚„å…³æ‰äº† Docker CN ä¸­å›½çš„é•œåƒæºï¼Œä¼—æ‰€å‘¨çŸ¥å›½å†…çš„ç½‘ç»œéå¸¸å¤æ‚ï¼Œè®¿é—®å›½å¤–ç½‘ç«™æå…¶ç¼“æ…¢ã€‚æ‰€ä»¥è¿™é‡Œå¯¹ç›®å‰ç°å­˜çš„å‡ ä¸ª Docker é•œåƒæºè¿›è¡Œæ¨ªè¯„ï¼Œä¸ºå¤§å®¶é€‰æ‹©é•œåƒæºæä¾›å‚è€ƒã€‚&lt;/p>
&lt;h3 id="ä¸»è¦å¯¹ä»¥ä¸‹äº”ä¸ªé•œåƒæºè¿›è¡Œæµ‹è¯•">ä¸»è¦å¯¹ä»¥ä¸‹äº”ä¸ªé•œåƒæºè¿›è¡Œæµ‹è¯•&lt;/h3>
&lt;p>&lt;a class="link" href="https://github.com/Azure/container-service-for-azure-china/blob/master/aks/README.md#22-container-registry-proxy" target="_blank" rel="noopener"
>Azure ä¸­å›½é•œåƒ &lt;code>https://dockerhub.azk8s.cn&lt;/code>&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://cr.console.aliyun.com/cn-hangzhou/mirrors" target="_blank" rel="noopener"
>é˜¿é‡Œäº‘åŠ é€Ÿå™¨ (éœ€è¦ç™»å½•é˜¿é‡Œäº‘è´¦æˆ·)&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://kirk-enterprise.github.io/hub-docs/#/user-guide/mirror" target="_blank" rel="noopener"
>ä¸ƒç‰›äº‘åŠ é€Ÿå™¨ &lt;code>https://reg-mirror.qiniu.com&lt;/code>&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://mirrors.ustc.edu.cn/help/dockerhub.html" target="_blank" rel="noopener"
>ä¸­ç§‘å¤§é•œåƒæº&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.daocloud.io/mirror" target="_blank" rel="noopener"
>DaoCloud åŠ é€Ÿå™¨&lt;/a>&lt;/p>
&lt;h3 id="æµ‹è¯•ä¸»è¦åŒ…æ‹¬ä¸¤é¡¹">æµ‹è¯•ä¸»è¦åŒ…æ‹¬ä¸¤é¡¹&lt;/h3>
&lt;p>1ã€å·²ç¼“å­˜é•œåƒé€Ÿåº¦: é€šè¿‡æ‹‰å– Docker Hub è¾ƒä¸ºçƒ­é—¨çš„ &lt;code>couchbase&lt;/code> é•œåƒæµ‹è¯•é•œåƒæºå·²ç¼“å­˜é•œåƒçš„ä¸‹è½½é€Ÿåº¦&lt;/p>
&lt;p>2ã€å›æºé•œåƒé€Ÿåº¦: é€šè¿‡æ‹‰å–æˆ‘æœ¬äººè‡ªåˆ¶çš„æ”¾åœ¨ Docker Hub ä¸Šçš„é•œåƒï¼Œç†è®ºä¸Šåº”è¯¥ä¸ä¼šè¢«ä»»ä½•é•œåƒç¼“å­˜ï¼Œæµ‹è¯•å›æºé€Ÿåº¦&lt;/p>
&lt;h3 id="æµ‹è¯•ç»“æœ">æµ‹è¯•ç»“æœ&lt;/h3>
&lt;p>å·²ç¼“å­˜çš„é•œåƒé€Ÿåº¦ æµ‹è¯•ä½¿ç”¨ &lt;code>postgres:latest&lt;/code> é•œåƒï¼Œå¤§å°çº¦ 117 MB&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>Azure ä¸­å›½&lt;/th>
&lt;th>é˜¿é‡Œäº‘åŠ é€Ÿå™¨&lt;/th>
&lt;th>ä¸ƒç‰›äº‘åŠ é€Ÿå™¨&lt;/th>
&lt;th>ä¸­ç§‘å¤§&lt;/th>
&lt;th>DaoCloud åŠ é€Ÿå™¨&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>è€—æ—¶&lt;/td>
&lt;td>12.446s&lt;/td>
&lt;td>13.324s&lt;/td>
&lt;td>7:10.92s&lt;/td>
&lt;td>3:36.48s&lt;/td>
&lt;td>18.576s&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>å›æºé•œåƒé€Ÿåº¦ æµ‹è¯•ä½¿ç”¨ä¸ªäººæ‰“åŒ…çš„ä¸€ä¸ªé•œåƒå¤§å°çº¦ 268 MB&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>Azure ä¸­å›½&lt;/th>
&lt;th>é˜¿é‡Œäº‘åŠ é€Ÿå™¨&lt;/th>
&lt;th>ä¸ƒç‰›äº‘åŠ é€Ÿå™¨&lt;/th>
&lt;th>ä¸­ç§‘å¤§&lt;/th>
&lt;th>DaoCloud åŠ é€Ÿå™¨&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>è€—æ—¶&lt;/td>
&lt;td>44.696s&lt;/td>
&lt;td>25.356s&lt;/td>
&lt;td>1:09.56s&lt;/td>
&lt;td>9:20.40s&lt;/td>
&lt;td>38.069s&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="ç»“è®º">ç»“è®º&lt;/h3>
&lt;p>é•œåƒæºé€Ÿåº¦ é˜¿é‡Œäº‘ &amp;gt; Azure ä¸­å›½ &amp;gt; DaoCloud &amp;gt; ä¸­ç§‘å¤§ &amp;gt; ä¸ƒç‰›äº‘åŠ é€Ÿå™¨&lt;/p>
&lt;p>ç”±äºé˜¿é‡Œäº‘åŠ é€Ÿå™¨éœ€è¦æ³¨å†Œé˜¿é‡Œäº‘è´¦æˆ·å¼€å¯å®¹å™¨æœåŠ¡ä¹‹åæ‰æœ‰ï¼Œæ‰€ä»¥è¿™é‡Œå¼ºçƒˆæ¨èä½¿ç”¨ &lt;a class="link" href="https://github.com/Azure/container-service-for-azure-china/blob/master/aks/README.md#22-container-registry-proxy" target="_blank" rel="noopener"
>Azure ä¸­å›½é•œåƒ &lt;code>https://dockerhub.azk8s.cn&lt;/code>&lt;/a> çš„é•œåƒåŠ é€ŸæœåŠ¡ã€‚&lt;/p>
&lt;p>è¿™æ¬¡æµ‹è¯•æ¯”è¾ƒæ„å¤–çš„æ˜¯ä¸ƒç‰›äº‘çš„åŠ é€Ÿå™¨ç«Ÿç„¶é€Ÿåº¦è¿™ä¹ˆæ…¢ï¼Œæ„Ÿè§‰å·²ç»å¤„äºæ— äººç»´æŠ¤çš„çŠ¶æ€äº†ï¼Œåœ¨æ‹‰å– postgres é•œåƒè¿‡ç¨‹ä¸­å¤šæ¬¡å¤±è´¥ã€‚å¼ºçƒˆä¸æ¨èä½¿ç”¨&lt;/p></description></item><item><title>Golangåˆ‡ç‰‡ä½¿ç”¨ä¸å†…éƒ¨å®ç°(ç¿»è¯‘)</title><link>https://tomwei7.com/2016/12/27/go-slices-usage-and-internals.html</link><pubDate>Tue, 27 Dec 2016 00:00:00 +0000</pubDate><guid>https://tomwei7.com/2016/12/27/go-slices-usage-and-internals.html</guid><description>&lt;img src="https://tomwei7.com/2016/12/27/go-slices-usage-and-internals/golang-arrays-and-slices.png" alt="Featured image of post Golangåˆ‡ç‰‡ä½¿ç”¨ä¸å†…éƒ¨å®ç°(ç¿»è¯‘)" />&lt;p>Golangçš„åˆ‡ç‰‡ç±»å‹æä¾›äº†ä¸€ç§ç®€å•é«˜æ•ˆçš„æ“ä½œåºåˆ—åŒ–ç±»å‹æ•°æ®çš„æ–¹å¼ã€‚åˆ‡ç‰‡å’Œå…¶ä»–è¯­è¨€ä¸­çš„æ•°ç»„ç±»ä¼¼ï¼Œä¸è¿‡å«æœ‰ä¸€äº›ç‰¹æ®Šçš„å±æ€§ã€‚è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯åˆ‡ç‰‡å’Œå¦‚ä½•ä½¿ç”¨åˆ‡ç‰‡&lt;/p>
&lt;h3 id="æ•°ç»„">æ•°ç»„&lt;/h3>
&lt;p>åˆ‡ç‰‡ç±»å‹æ˜¯å»ºç«‹åœ¨æ•°ç»„ç±»å‹ä¸Šçš„æŠ½è±¡ï¼Œæ‰€ä»¥åœ¨æˆ‘ä»¬äº†è§£åˆ‡ç‰‡ä¹‹å‰æˆ‘ä»¬å¿…é¡»å…ˆäº†è§£æ•°ç»„ã€‚&lt;/p>
&lt;p>æ•°ç»„ç±»å‹å®šä¹‰äº†ä¸€ç§ç‰¹å®šé•¿åº¦å’Œå…ƒç´ çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œ&lt;code>[4]int &lt;/code>ä»£è¡¨äº†æœ‰å››ä¸ª&lt;code>int&lt;/code>å…ƒç´ çš„æ•°ç»„ã€‚æ•°ç»„çš„å¤§å°æ˜¯å›ºå®šçš„ï¼›å®ƒçš„å¤§å°æ˜¯å®ƒç±»å‹çš„ä¸€éƒ¨åˆ†ï¼ˆ&lt;code>[4]int&lt;/code>å’Œ&lt;code>[5]int&lt;/code>æ˜¯ä¸åŒçš„ï¼Œä¸å…¼å®¹çš„ç±»å‹ï¼‰ã€‚æ•°ç»„å¯ä»¥ç›´æ¥å®šä½ï¼Œè¡¨è¾¾å¼&lt;code>s[n]&lt;/code>å¯ä»¥ç›´æ¥è®¿é—®ç¬¬nä¸ªå…ƒç´ ï¼Œä»é›¶å¼€å§‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">a&lt;/span> [&lt;span style="color:#ae81ff">4&lt;/span>]&lt;span style="color:#66d9ef">int&lt;/span>
&lt;span style="color:#a6e22e">a&lt;/span>[&lt;span style="color:#ae81ff">0&lt;/span>] = &lt;span style="color:#ae81ff">1&lt;/span>
&lt;span style="color:#a6e22e">i&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">a&lt;/span>[&lt;span style="color:#ae81ff">0&lt;/span>]
&lt;span style="color:#75715e">// i == 1
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ•°ç»„ä¸éœ€è¦æ˜¾å¼çš„åˆå§‹åŒ–ï¼›ä¸€ä¸ªé›¶å€¼çš„æ•°ç»„å¯ä»¥è¢«ä½¿ç”¨ï¼Œæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ æ˜¯ä»–ä»¬è‡ªå·±æœ¬èº«çš„é›¶å€¼(&lt;a class="link" href="https://golang.org/ref/spec#The_zero_value" target="_blank" rel="noopener"
>golangé›¶å€¼å‚è€ƒè¿™é‡Œ&lt;/a>)&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#75715e">// a[2] == 0, the zero value of the int type
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨å†…å­˜ä¸­ä»£è¡¨&lt;code>[4]int&lt;/code>å°±æ˜¯4ä¸ªæ•´å½¢çš„å€¼é¡ºåºæ’åˆ—&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 760;
flex-basis: 1824px"
>
&lt;a href="https://tomwei7.com/2016/12/27/go-slices-usage-and-internals/go-slices-usage-and-internals_slice-array.png" data-size="517x68">
&lt;img src="https://tomwei7.com/2016/12/27/go-slices-usage-and-internals/go-slices-usage-and-internals_slice-array.png"
width="517"
height="68"
srcset="https://tomwei7.com/2016/12/27/go-slices-usage-and-internals/go-slices-usage-and-internals_slice-array_hu5a3110f7f8a91ffcff07d25db842332b_1237_480x0_resize_box_2.png 480w, https://tomwei7.com/2016/12/27/go-slices-usage-and-internals/go-slices-usage-and-internals_slice-array_hu5a3110f7f8a91ffcff07d25db842332b_1237_1024x0_resize_box_2.png 1024w"
loading="lazy"
>
&lt;/a>
&lt;/figure>&lt;/p>
&lt;p>Golang ä¸­æ•°ç»„æ˜¯ä¸ªå€¼ã€‚æ•°ç»„çš„å˜é‡ä»£è¡¨ç€æ•´ä¸ªæ•°ç»„ï¼›è€Œä¸æ˜¯æŒ‡å‘æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆï¼ˆè¿™ä¸ªå’ŒCè¯­è¨€ä¸­çš„æƒ…å†µä¸åŒï¼‰ã€‚è¿™ä»£è¡¨è¿™å½“ä½ åˆ†é…æˆ–è€…ä¼ é€’æ•°ç»„å˜é‡æ—¶å°†ä¼šæ‹·è´æ•´ä¸ªæ•°ç»„çš„å†…å®¹ã€‚ï¼ˆä¸ºäº†é¿å…å¤åˆ¶ä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œä¸è¿‡è¿™æ—¶è¿™å°±æ˜¯æ•°ç»„çš„æŒ‡é’ˆè€Œä¸æ˜¯æ•°ç»„äº†ã€‚ï¼‰ä½ å¯ä»¥æŠŠæ•°ç»„æƒ³æˆä¸€ç§ç»“æ„ä½“ä½†å…·æœ‰ç´¢å¼•è€Œä¸æ˜¯å‘½åå­—æ®µçš„å›ºå®šå¤§å°çš„å¤åˆå€¼ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªæ•°ç»„å¯ä»¥è¿™æ ·æŒ‡å®šï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#a6e22e">b&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> [&lt;span style="color:#ae81ff">2&lt;/span>]&lt;span style="color:#66d9ef">string&lt;/span>{&lt;span style="color:#e6db74">&amp;#34;Penn&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Teller&amp;#34;&lt;/span>}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ–è€…ï¼Œä½ å¯ä»¥è®©ç¼–è¯‘å™¨ä¸ºä½ è®¡ç®—æ•°ç»„å…ƒç´ ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#a6e22e">b&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> [&lt;span style="color:#f92672">...&lt;/span>]&lt;span style="color:#66d9ef">string&lt;/span>{&lt;span style="color:#e6db74">&amp;#34;Penn&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Teller&amp;#34;&lt;/span>}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œ&lt;code>b&lt;/code>çš„ç±»å‹éƒ½æ˜¯&lt;code>[2]string&lt;/code>&lt;/p>
&lt;h3 id="åˆ‡ç‰‡">åˆ‡ç‰‡&lt;/h3>
&lt;p>æ•°ç»„æœ‰å®ƒçš„ä½œç”¨ï¼Œä½†æ˜¯å®ƒä¸å¤Ÿçµæ´»ï¼Œæ‰€ä»¥ä½ ç»å¸¸åœ¨golang çš„ä»£ç ä¸­è§åˆ°å®ƒã€‚åˆ‡ç‰‡ï¼Œåˆ°å¤„éƒ½æœ‰ã€‚åˆ‡ç‰‡å»ºç«‹åœ¨æ•°ç»„çš„åŸºç¡€ä¸Šä¸”æ›´åŠ çš„å¼ºå¤§çµæ´»ã€‚&lt;/p>
&lt;p>&lt;code>[]T&lt;/code>æ˜¯åˆ‡ç‰‡ç±»å‹çš„å®šä¹‰ï¼Œå…¶ä¸­&lt;code>T&lt;/code>æ˜¯åˆ‡ç‰‡ä¸­å…ƒç´ çš„ç±»å‹ï¼Œè·Ÿæ•°ç»„ä¸åŒï¼Œåˆ‡ç‰‡ç±»å‹æ²¡æœ‰é•¿åº¦ã€‚&lt;/p>
&lt;p>å£°æ˜ä¸€ä¸ªåˆ‡ç‰‡å’Œå£°æ˜ä¸€ä¸ªæ•°ç»„æœ‰ç‚¹åƒï¼Œé™¤äº†ä¸éœ€è¦æŒ‡å®šå…ƒç´ ä¸ªæ•°&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#a6e22e">letters&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> []&lt;span style="color:#66d9ef">string&lt;/span>{&lt;span style="color:#e6db74">&amp;#34;a&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;b&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;c&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;d&amp;#34;&lt;/span>}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸€ä¸ªåˆ‡ç‰‡å¯ä»¥ç”±å†…ç½®çš„&lt;code>make&lt;/code>å‡½æ•°åˆ›å»º&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#66d9ef">func&lt;/span> make([]&lt;span style="color:#a6e22e">T&lt;/span>, &lt;span style="color:#a6e22e">len&lt;/span>, &lt;span style="color:#a6e22e">cap&lt;/span>) []&lt;span style="color:#a6e22e">T&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶ä¸­&lt;code>T&lt;/code>ä»£è¡¨è¦åˆ›å»ºçš„åˆ‡ç‰‡å…¶ä¸­å…ƒç´ çš„ç±»å‹ï¼Œ&lt;code>make&lt;/code>å‡½æ•°æ¥å—ç±»å‹ã€é•¿åº¦å’Œå®¹é‡é€‰é¡¹ã€‚è°ƒç”¨æ—¶ï¼Œ&lt;code>make&lt;/code>åˆ†é…ä¸€ä¸ªæ•°ç»„å’Œè¿”å›ä¸€ä¸ªæŒ‡å‘è¯¥æ•°ç»„çš„åˆ‡ç‰‡&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">s&lt;/span> []&lt;span style="color:#66d9ef">byte&lt;/span>
&lt;span style="color:#a6e22e">s&lt;/span> = make([]&lt;span style="color:#66d9ef">byte&lt;/span>, &lt;span style="color:#ae81ff">5&lt;/span>, &lt;span style="color:#ae81ff">5&lt;/span>)
&lt;span style="color:#75715e">// s == []byte{0, 0, 0, 0, 0}
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å½“å®¹é‡å‚æ•°çœç•¥æ—¶ï¼Œé»˜è®¤å€¼ç­‰äºæŒ‡å®šçš„é•¿åº¦ã€‚è¿™ä¸ªæœ‰ä¸ªæ›´åŠ ç®€æ´ç‰ˆæœ¬çš„ä»£ç ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#a6e22e">s&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> make([]&lt;span style="color:#66d9ef">byte&lt;/span>, &lt;span style="color:#ae81ff">5&lt;/span>)
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥ä½¿ç”¨å†…ç½®çš„&lt;code>len&lt;/code>å’Œ&lt;code>cap&lt;/code>è·å–åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">len(&lt;span style="color:#a6e22e">s&lt;/span>) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>
cap(&lt;span style="color:#a6e22e">s&lt;/span>) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åˆ‡ç‰‡é•¿åº¦ä¸å®¹é‡ç›´æ¥çš„å…³ç³»&lt;/p>
&lt;p>é›¶å€¼çš„åˆ‡ç‰‡æ˜¯&lt;code>nil&lt;/code>ã€‚&lt;code>nil&lt;/code>çš„åˆ‡ç‰‡&lt;code>len&lt;/code>å’Œ&lt;code>cap&lt;/code>å‡½æ•°éƒ½ä¼šè¿”å›0ã€‚&lt;/p>
&lt;p>è¿˜å¯ä»¥é€šè¿‡åˆ‡ç‰‡ç°æœ‰çš„åˆ‡ç‰‡æˆ–è€…æ•°ç»„æ¥ç”Ÿæˆåˆ‡ç‰‡ã€‚åˆ‡ç‰‡é€šè¿‡æŒ‡å®šå…·æœ‰ä¸¤ä¸ªç”¨å†’å·åˆ†éš”çš„ç´¢å¼•çš„åŠå¼€èŒƒå›´æ¥å®Œæˆã€‚æ¯”å¦‚ï¼Œè¡¨è¾¾å¼&lt;code>b[1:4]&lt;/code>åˆ›å»ºäº†ä¸€ä¸ªåˆ‡ç‰‡åŒ…å«äº†&lt;code>b&lt;/code>ä¸­1åˆ°3çš„å…ƒç´ ï¼ˆå¾—å¸¦çš„åˆ‡ç‰‡çš„ç´¢å¼•æ˜¯0åˆ°2ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#a6e22e">b&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> []&lt;span style="color:#66d9ef">byte&lt;/span>{&lt;span style="color:#e6db74">&amp;#39;g&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;o&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;l&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;n&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;g&amp;#39;&lt;/span>}
&lt;span style="color:#75715e">// b[1:4] == []byte{&amp;#39;o&amp;#39;, &amp;#39;l&amp;#39;, &amp;#39;a&amp;#39;}, sharing the same storage as b
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ‡ç‰‡è¡¨è¾¾å¼çš„å¼€å§‹å’Œç»“æŸç´¢å¼•æ˜¯å¯é€‰çš„;å®ƒä»¬åˆ†åˆ«é»˜è®¤ä¸ºé›¶å’Œåˆ‡ç‰‡çš„é•¿åº¦ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#75715e">// b[:2] == []byte{&amp;#39;g&amp;#39;, &amp;#39;o&amp;#39;}
&lt;/span>&lt;span style="color:#75715e">// b[2:] == []byte{&amp;#39;l&amp;#39;, &amp;#39;a&amp;#39;, &amp;#39;n&amp;#39;, &amp;#39;g&amp;#39;}
&lt;/span>&lt;span style="color:#75715e">// b[:] == b
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡æ•°ç»„åˆ›å»ºåˆ‡ç‰‡çš„è¯­æ³•ä¹Ÿä¸€æ ·ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#a6e22e">x&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> [&lt;span style="color:#ae81ff">3&lt;/span>]&lt;span style="color:#66d9ef">string&lt;/span>{&lt;span style="color:#e6db74">&amp;#34;Ğ›Ğ°Ğ¹ĞºĞ°&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Ğ‘ĞµĞ»ĞºĞ°&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Ğ¡Ñ‚Ñ€ĞµĞ»ĞºĞ°&amp;#34;&lt;/span>}
&lt;span style="color:#a6e22e">s&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">x&lt;/span>[:] &lt;span style="color:#75715e">// a slice referencing the storage of x
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="åˆ‡ç‰‡å†…éƒ¨">åˆ‡ç‰‡å†…éƒ¨&lt;/h3>
&lt;p>åˆ‡ç‰‡æ˜¯æ•°ç»„æ®µçš„æè¿°ç¬¦ã€‚å®ƒç”±æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œæ®µçš„é•¿åº¦åŠå…¶å®¹é‡ï¼ˆæ®µçš„æœ€å¤§é•¿åº¦ï¼‰ç»„æˆã€‚&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 261;
flex-basis: 626px"
>
&lt;a href="https://tomwei7.com/2016/12/27/go-slices-usage-and-internals/go-slices-usage-and-internals_slice-struct.png" data-size="517x198">
&lt;img src="https://tomwei7.com/2016/12/27/go-slices-usage-and-internals/go-slices-usage-and-internals_slice-struct.png"
width="517"
height="198"
srcset="https://tomwei7.com/2016/12/27/go-slices-usage-and-internals/go-slices-usage-and-internals_slice-struct_huc8289134f44b8d2e744099b8c1f2005a_3650_480x0_resize_box_2.png 480w, https://tomwei7.com/2016/12/27/go-slices-usage-and-internals/go-slices-usage-and-internals_slice-struct_huc8289134f44b8d2e744099b8c1f2005a_3650_1024x0_resize_box_2.png 1024w"
loading="lazy"
>
&lt;/a>
&lt;/figure>&lt;/p>
&lt;p>æˆ‘ä»¬å…ˆå‰ç”±&lt;code>make([]byte,5)&lt;/code>åˆ›å»ºçš„å˜é‡&lt;code>s&lt;/code>çš„ç»“æ„å¦‚ä¸‹ï¼š&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 267;
flex-basis: 642px"
>
&lt;a href="https://tomwei7.com/2016/12/27/go-slices-usage-and-internals/go-slices-usage-and-internals_slice-1.png" data-size="517x193">
&lt;img src="https://tomwei7.com/2016/12/27/go-slices-usage-and-internals/go-slices-usage-and-internals_slice-1.png"
width="517"
height="193"
srcset="https://tomwei7.com/2016/12/27/go-slices-usage-and-internals/go-slices-usage-and-internals_slice-1_hu6eaee86cb225b00d5958a365785f0443_6334_480x0_resize_box_2.png 480w, https://tomwei7.com/2016/12/27/go-slices-usage-and-internals/go-slices-usage-and-internals_slice-1_hu6eaee86cb225b00d5958a365785f0443_6334_1024x0_resize_box_2.png 1024w"
loading="lazy"
>
&lt;/a>
&lt;/figure>&lt;/p>
&lt;p>é•¿åº¦æ˜¯åˆ‡ç‰‡å¼•ç”¨çš„å…ƒç´ çš„æ•°é‡ã€‚å®¹é‡æ˜¯åº•å±‚æ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡ï¼ˆä»sliceæŒ‡é’ˆå¼•ç”¨çš„å…ƒç´ å¼€å§‹ï¼‰ã€‚å°†é€šè¿‡ä¸‹é¢å‡ ä¸ªå°ä¾‹å­ï¼Œå°†å¸®åŠ©ä½ ç†è§£é•¿åº¦å’Œå®¹é‡ä¹‹é—´çš„åŒºåˆ«ã€‚&lt;/p>
&lt;p>åœ¨æˆ‘ä»¬åˆ‡ç‰‡æ—¶ï¼Œè§‚å¯Ÿåˆ‡ç‰‡æ•°æ®ç»“æ„ä¸­çš„å˜åŒ–åŠå…¶ä¸åŸºç¡€æ•°ç»„çš„å…³ç³»ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#a6e22e">s&lt;/span> = &lt;span style="color:#a6e22e">s&lt;/span>[&lt;span style="color:#ae81ff">2&lt;/span>:&lt;span style="color:#ae81ff">4&lt;/span>]
&lt;/code>&lt;/pre>&lt;/div>&lt;p>!()[https://blog.golang.org/go-slices-usage-and-internals_slice-2.png]&lt;/p>
&lt;p>åˆ‡ç‰‡æ“ä½œä¸ä¼šæ‹·è´å·²æœ‰çš„åˆ‡ç‰‡æ•°æ®ï¼Œå°†åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ‡ç‰‡æŒ‡å‘åŸæ¥çš„æ•°ç»„ã€‚è¿™ä½¿å¾—åˆ‡ç‰‡æ“ä½œä¸æ“ä½œæ•°ç»„ç´¢å¼•ä¸€æ ·é«˜æ•ˆã€‚å› æ­¤ï¼Œä¿®æ”¹é‡æ–°åˆ‡ç‰‡çš„å…ƒç´ ï¼ˆè€Œä¸æ˜¯åˆ‡ç‰‡æœ¬èº«ï¼‰å°†ä¿®æ”¹åŸå§‹åˆ‡ç‰‡çš„å…ƒç´ ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#a6e22e">d&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> []&lt;span style="color:#66d9ef">byte&lt;/span>{&lt;span style="color:#e6db74">&amp;#39;r&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;o&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span>, &lt;span style="color:#e6db74">&amp;#39;d&amp;#39;&lt;/span>}
&lt;span style="color:#a6e22e">e&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">d&lt;/span>[&lt;span style="color:#ae81ff">2&lt;/span>:]
&lt;span style="color:#75715e">// e == []byte{&amp;#39;a&amp;#39;, &amp;#39;d&amp;#39;}
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">e&lt;/span>[&lt;span style="color:#ae81ff">1&lt;/span>] = &lt;span style="color:#e6db74">&amp;#39;m&amp;#39;&lt;/span>
&lt;span style="color:#75715e">// e == []byte{&amp;#39;a&amp;#39;, &amp;#39;m&amp;#39;}
&lt;/span>&lt;span style="color:#75715e">// d == []byte{&amp;#39;r&amp;#39;, &amp;#39;o&amp;#39;, &amp;#39;a&amp;#39;, &amp;#39;m&amp;#39;}
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¹‹å‰æˆ‘ä»¬æŠŠ&lt;code>s&lt;/code>åˆ‡ç‰‡æˆé•¿åº¦æ¯”å®¹é‡å°‘çš„åˆ‡ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡æ–°åˆ‡ç‰‡å°†å®ƒé•¿åº¦å¢é•¿å’Œå®¹é‡ä¸€æ ·å¤§(æˆ‘ä¹‹å‰è¿˜çœŸä¸çŸ¥é“èƒ½è¿™ä¹ˆç©ğŸ˜‚)ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#a6e22e">s&lt;/span> = &lt;span style="color:#a6e22e">s&lt;/span>[:cap(&lt;span style="color:#a6e22e">s&lt;/span>)]
&lt;/code>&lt;/pre>&lt;/div>&lt;p>åˆ‡ç‰‡ä¸èƒ½è¶…è¶Šå…¶å®¹é‡ã€‚å°è¯•è¿™æ ·åšä¼šå¯¼è‡´è¿è¡Œæ—¶panicï¼Œå°±åƒåœ¨åˆ‡ç‰‡æˆ–æ•°ç»„çš„è¾¹ç•Œå¤–å»ºç«‹ç´¢å¼•ä¸€æ ·ã€‚ç±»ä¼¼åœ°ï¼Œåˆ‡ç‰‡ä¸èƒ½åœ¨é›¶ä»¥ä¸‹é‡æ–°åˆ‡ç‰‡ä»¥è®¿é—®æ•°ç»„ä¸­çš„æ—©æœŸå…ƒç´ ã€‚&lt;/p>
&lt;h3 id="åˆ‡ç‰‡å¢é•¿æ‹·è´å’Œappendå‡½æ•°">åˆ‡ç‰‡å¢é•¿ï¼ˆæ‹·è´å’Œappendå‡½æ•°ï¼‰&lt;/h3>
&lt;p>ä¸ºäº†å¢åŠ åˆ‡ç‰‡çš„å®¹é‡ï¼Œå¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„è¾ƒå¤§åˆ‡ç‰‡ï¼Œå¹¶å°†åŸå§‹åˆ‡ç‰‡çš„å†…å®¹å¤åˆ¶åˆ°å…¶ä¸­ã€‚è¿™ç§æŠ€æœ¯å°±æ˜¯å…¶ä»–è¯­è¨€çš„åŠ¨æ€æ•°ç»„çš„èƒŒåå®ç°ã€‚ä¸‹ä¸€ä¸ªä¾‹å­é€šè¿‡åˆ¶ä½œä¸€ä¸ªæ–°çš„åˆ‡ç‰‡&lt;code>t&lt;/code>ï¼Œå°†&lt;code>s&lt;/code>çš„å†…å®¹å¤åˆ¶åˆ°&lt;code>t&lt;/code>ï¼Œç„¶åå°†åˆ‡ç‰‡å€¼&lt;code>t&lt;/code>åˆ†é…ç»™&lt;code>s&lt;/code>æ¥ä½¿&lt;code>s&lt;/code>çš„å®¹é‡åŠ å€ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> make([]&lt;span style="color:#66d9ef">byte&lt;/span>, len(&lt;span style="color:#a6e22e">s&lt;/span>), (cap(&lt;span style="color:#a6e22e">s&lt;/span>)&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>)&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>) &lt;span style="color:#75715e">// +1 in case cap(s) == 0
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">for&lt;/span> &lt;span style="color:#a6e22e">i&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#66d9ef">range&lt;/span> &lt;span style="color:#a6e22e">s&lt;/span> {
&lt;span style="color:#a6e22e">t&lt;/span>[&lt;span style="color:#a6e22e">i&lt;/span>] = &lt;span style="color:#a6e22e">s&lt;/span>[&lt;span style="color:#a6e22e">i&lt;/span>]
}
&lt;span style="color:#a6e22e">s&lt;/span> = &lt;span style="color:#a6e22e">t&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>é€šè¿‡å†…ç½®çš„&lt;code>copy&lt;/code>å‡½æ•°å¯ä»¥æ›´åŠ å®¹æ˜“çš„å®ç°è¿™ç§å¾ªç¯æ“ä½œã€‚é¡¾åæ€ä¹‰ï¼Œå¤åˆ¶å°†æ•°æ®ä»æºåˆ‡ç‰‡å¤åˆ¶åˆ°ç›®æ ‡åˆ‡ç‰‡ã€‚å®ƒè¿”å›å¤åˆ¶çš„å…ƒç´ æ•°ã€‚&lt;/p>
&lt;p>å¤åˆ¶åŠŸèƒ½æ”¯æŒåœ¨ä¸åŒé•¿åº¦çš„åˆ‡ç‰‡ä¹‹é—´è¿›è¡Œå¤åˆ¶ï¼ˆå®ƒåªä¼šå¤åˆ¶åˆ°è¾ƒå°‘æ•°é‡çš„å…ƒç´ ï¼‰ã€‚æ­¤å¤–ï¼Œå‰¯æœ¬å¯ä»¥å¤„ç†å…±äº«ç›¸åŒåº•å±‚æ•°ç»„çš„æºå’Œç›®æ ‡sliceï¼Œæ­£ç¡®å¤„ç†é‡å sliceã€‚&lt;/p>
&lt;p>ä½¿ç”¨copyï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–ä¸Šé¢çš„ä»£ç ç‰‡æ®µï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#a6e22e">t&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> make([]&lt;span style="color:#66d9ef">byte&lt;/span>, len(&lt;span style="color:#a6e22e">s&lt;/span>), (cap(&lt;span style="color:#a6e22e">s&lt;/span>)&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>)&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>)
copy(&lt;span style="color:#a6e22e">t&lt;/span>, &lt;span style="color:#a6e22e">s&lt;/span>)
&lt;span style="color:#a6e22e">s&lt;/span> = &lt;span style="color:#a6e22e">t&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¸¸è§çš„æ“ä½œæ˜¯å°†æ•°æ®é™„åŠ åˆ°åˆ‡ç‰‡çš„æœ«å°¾ã€‚æ­¤å‡½æ•°å°†å­—èŠ‚å…ƒç´ é™„åŠ åˆ°å­—èŠ‚ç‰‡ï¼Œå¦‚æœå¿…è¦ï¼Œå¢é•¿åˆ‡ç‰‡ï¼Œå¹¶è¿”å›æ–°çš„åˆ‡ç‰‡ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">AppendByte&lt;/span>(&lt;span style="color:#a6e22e">slice&lt;/span> []&lt;span style="color:#66d9ef">byte&lt;/span>, &lt;span style="color:#a6e22e">data&lt;/span> &lt;span style="color:#f92672">...&lt;/span>&lt;span style="color:#66d9ef">byte&lt;/span>) []&lt;span style="color:#66d9ef">byte&lt;/span> {
&lt;span style="color:#a6e22e">m&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> len(&lt;span style="color:#a6e22e">slice&lt;/span>)
&lt;span style="color:#a6e22e">n&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">m&lt;/span> &lt;span style="color:#f92672">+&lt;/span> len(&lt;span style="color:#a6e22e">data&lt;/span>)
&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">n&lt;/span> &amp;gt; cap(&lt;span style="color:#a6e22e">slice&lt;/span>) { &lt;span style="color:#75715e">// if necessary, reallocate
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#75715e">// allocate double what&amp;#39;s needed, for future growth.
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">newSlice&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> make([]&lt;span style="color:#66d9ef">byte&lt;/span>, (&lt;span style="color:#a6e22e">n&lt;/span>&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>)&lt;span style="color:#f92672">*&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>)
copy(&lt;span style="color:#a6e22e">newSlice&lt;/span>, &lt;span style="color:#a6e22e">slice&lt;/span>)
&lt;span style="color:#a6e22e">slice&lt;/span> = &lt;span style="color:#a6e22e">newSlice&lt;/span>
}
&lt;span style="color:#a6e22e">slice&lt;/span> = &lt;span style="color:#a6e22e">slice&lt;/span>[&lt;span style="color:#ae81ff">0&lt;/span>:&lt;span style="color:#a6e22e">n&lt;/span>]
copy(&lt;span style="color:#a6e22e">slice&lt;/span>[&lt;span style="color:#a6e22e">m&lt;/span>:&lt;span style="color:#a6e22e">n&lt;/span>], &lt;span style="color:#a6e22e">data&lt;/span>)
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">slice&lt;/span>
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥ä½¿ç”¨AppendByteè¿™æ ·ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#a6e22e">p&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> []&lt;span style="color:#66d9ef">byte&lt;/span>{&lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#ae81ff">5&lt;/span>}
&lt;span style="color:#a6e22e">p&lt;/span> = &lt;span style="color:#a6e22e">AppendByte&lt;/span>(&lt;span style="color:#a6e22e">p&lt;/span>, &lt;span style="color:#ae81ff">7&lt;/span>, &lt;span style="color:#ae81ff">11&lt;/span>, &lt;span style="color:#ae81ff">13&lt;/span>)
&lt;span style="color:#75715e">// p == []byte{2, 3, 5, 7, 11, 13}
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åƒAppendByteè¿™æ ·çš„å‡½æ•°å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒä»¬æä¾›å¯¹åˆ‡ç‰‡ç”Ÿé•¿æ–¹å¼çš„å®Œå…¨æ§åˆ¶ã€‚æ ¹æ®ç¨‹åºçš„ç‰¹æ€§ï¼Œå¯èƒ½éœ€è¦åˆ†é…æ›´å°æˆ–æ›´å¤§çš„å—ï¼Œæˆ–è€…å¯¹é‡æ–°åˆ†é…çš„å¤§å°è®¾ç½®ä¸Šé™ã€‚&lt;/p>
&lt;p>ä½†æ˜¯å¤§å¤šæ•°ç¨‹åºä¸éœ€è¦å®Œå…¨æ§åˆ¶ï¼Œæ‰€ä»¥Goæä¾›äº†ä¸€ä¸ªå†…ç½®çš„&lt;code>append&lt;/code>å‡½æ•°ï¼Œé€‚åˆå¤§å¤šæ•°ç”¨é€”; å‡½æ•°å£°æ˜ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#66d9ef">func&lt;/span> append(&lt;span style="color:#a6e22e">s&lt;/span> []&lt;span style="color:#a6e22e">T&lt;/span>, &lt;span style="color:#a6e22e">x&lt;/span> &lt;span style="color:#f92672">...&lt;/span>&lt;span style="color:#a6e22e">T&lt;/span>) []&lt;span style="color:#a6e22e">T&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>append&lt;/code>å‡½æ•°å°†å…ƒç´ xé™„åŠ åˆ°åˆ‡ç‰‡çš„æœ«å°¾ï¼Œå¦‚æœéœ€è¦æ›´å¤§çš„å®¹é‡ï¼Œåˆ™å¢é•¿åˆ‡ç‰‡ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> make([]&lt;span style="color:#66d9ef">int&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>)
&lt;span style="color:#75715e">// a == []int{0}
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#a6e22e">a&lt;/span> = append(&lt;span style="color:#a6e22e">a&lt;/span>, &lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>)
&lt;span style="color:#75715e">// a == []int{0, 1, 2, 3}
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¦å°†ä¸€ä¸ªåˆ‡ç‰‡é™„åŠ åˆ°å¦ä¸€ä¸ªåˆ‡ç‰‡ï¼Œè¯·ä½¿ç”¨&amp;hellip;å°†ç¬¬äºŒä¸ªå‚æ•°å±•å¼€ä¸ºå‚æ•°åˆ—è¡¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> []&lt;span style="color:#66d9ef">string&lt;/span>{&lt;span style="color:#e6db74">&amp;#34;John&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Paul&amp;#34;&lt;/span>}
&lt;span style="color:#a6e22e">b&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> []&lt;span style="color:#66d9ef">string&lt;/span>{&lt;span style="color:#e6db74">&amp;#34;George&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Ringo&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;Pete&amp;#34;&lt;/span>}
&lt;span style="color:#a6e22e">a&lt;/span> = append(&lt;span style="color:#a6e22e">a&lt;/span>, &lt;span style="color:#a6e22e">b&lt;/span>&lt;span style="color:#f92672">...&lt;/span>) &lt;span style="color:#75715e">// equivalent to &amp;#34;append(a, b[0], b[1], b[2])&amp;#34;
&lt;/span>&lt;span style="color:#75715e">// a == []string{&amp;#34;John&amp;#34;, &amp;#34;Paul&amp;#34;, &amp;#34;George&amp;#34;, &amp;#34;Ringo&amp;#34;, &amp;#34;Pete&amp;#34;}
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç”±äºåˆ‡ç‰‡çš„é›¶å€¼ï¼ˆnilï¼‰çš„è¡Œä¸ºç±»ä¼¼äºé›¶é•¿åº¦åˆ‡ç‰‡ï¼Œå› æ­¤ä½ å¯ä»¥å£°æ˜åˆ‡ç‰‡å˜é‡ï¼Œç„¶ååœ¨å¾ªç¯ä¸­é™„åŠ åˆ‡ç‰‡å˜é‡ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#75715e">// Filter returns a new slice holding only
&lt;/span>&lt;span style="color:#75715e">// the elements of s that satisfy f()
&lt;/span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">Filter&lt;/span>(&lt;span style="color:#a6e22e">s&lt;/span> []&lt;span style="color:#66d9ef">int&lt;/span>, &lt;span style="color:#a6e22e">fn&lt;/span> &lt;span style="color:#66d9ef">func&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span>) &lt;span style="color:#66d9ef">bool&lt;/span>) []&lt;span style="color:#66d9ef">int&lt;/span> {
&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">p&lt;/span> []&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#75715e">// == nil
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">for&lt;/span> &lt;span style="color:#a6e22e">_&lt;/span>, &lt;span style="color:#a6e22e">v&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#66d9ef">range&lt;/span> &lt;span style="color:#a6e22e">s&lt;/span> {
&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#a6e22e">fn&lt;/span>(&lt;span style="color:#a6e22e">v&lt;/span>) {
&lt;span style="color:#a6e22e">p&lt;/span> = append(&lt;span style="color:#a6e22e">p&lt;/span>, &lt;span style="color:#a6e22e">v&lt;/span>)
}
}
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">p&lt;/span>
}
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ä¸€ä¸ªå°é—®é¢˜">ä¸€ä¸ªå°é—®é¢˜&lt;/h3>
&lt;p>å¦‚å‰æ‰€è¿°ï¼Œé‡æ–°åˆ‡ç‰‡åˆ‡ç‰‡ä¸ä¼šç”Ÿæˆåº•å±‚æ•°ç»„çš„å‰¯æœ¬ã€‚å®Œæ•´æ•°ç»„å°†ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°å®ƒä¸å†è¢«å¼•ç”¨ã€‚æœ‰æ—¶å¯èƒ½å¯¼è‡´åªéœ€è¦æ•°ç»„ä¸­ä¸€ç‚¹ç‚¹å†…å®¹ï¼Œä½†æ˜¯æ•´ä¸ªæ•°ç»„éƒ½è¢«ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚
ä¾‹å¦‚ï¼Œæ­¤FindDigitså‡½æ•°å°†æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶æœç´¢ç¬¬ä¸€ç»„è¿ç»­æ•°å­—ï¼Œå°†å…¶ä½œä¸ºæ–°åˆ‡ç‰‡è¿”å›ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">digitRegexp&lt;/span> = &lt;span style="color:#a6e22e">regexp&lt;/span>.&lt;span style="color:#a6e22e">MustCompile&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;[0-9]+&amp;#34;&lt;/span>)
&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">FindDigits&lt;/span>(&lt;span style="color:#a6e22e">filename&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span>) []&lt;span style="color:#66d9ef">byte&lt;/span> {
&lt;span style="color:#a6e22e">b&lt;/span>, &lt;span style="color:#a6e22e">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">ioutil&lt;/span>.&lt;span style="color:#a6e22e">ReadFile&lt;/span>(&lt;span style="color:#a6e22e">filename&lt;/span>)
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">digitRegexp&lt;/span>.&lt;span style="color:#a6e22e">Find&lt;/span>(&lt;span style="color:#a6e22e">b&lt;/span>)
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ­¤ä»£ç çš„è¡Œä¸ºä¸æœŸæœ›ä¸€æ ·ï¼Œä½†è¿”å›çš„&lt;code>[]byte&lt;/code>æŒ‡å‘åŒ…å«æ•´ä¸ªæ–‡ä»¶çš„æ•°ç»„ã€‚å› ä¸ºåˆ‡ç‰‡å¼•ç”¨åŸå§‹æ•°ç»„ï¼Œåªè¦åˆ‡ç‰‡è¢«ä¿ç•™,åƒåœ¾æ”¶é›†å™¨å°±ä¸èƒ½é‡Šæ”¾æ•°ç»„ï¼›æ–‡ä»¶çš„æ•´ä¸ªå†…å®¹ä¿å­˜åœ¨å†…å­˜ä¸­ä½†æœ‰ç”¨çš„åªæœ‰ä¸€ç‚¹ã€‚&lt;/p>
&lt;p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å°†éœ€è¦çš„æ•°æ®å¤åˆ¶åˆ°ä¸€ä¸ªæ–°çš„åˆ‡ç‰‡ï¼Œç„¶åè¿”å›å®ƒï¼š&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-go" data-lang="go">&lt;span style="color:#66d9ef">func&lt;/span> &lt;span style="color:#a6e22e">CopyDigits&lt;/span>(&lt;span style="color:#a6e22e">filename&lt;/span> &lt;span style="color:#66d9ef">string&lt;/span>) []&lt;span style="color:#66d9ef">byte&lt;/span> {
&lt;span style="color:#a6e22e">b&lt;/span>, &lt;span style="color:#a6e22e">_&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> &lt;span style="color:#a6e22e">ioutil&lt;/span>.&lt;span style="color:#a6e22e">ReadFile&lt;/span>(&lt;span style="color:#a6e22e">filename&lt;/span>)
&lt;span style="color:#a6e22e">b&lt;/span> = &lt;span style="color:#a6e22e">digitRegexp&lt;/span>.&lt;span style="color:#a6e22e">Find&lt;/span>(&lt;span style="color:#a6e22e">b&lt;/span>)
&lt;span style="color:#a6e22e">c&lt;/span> &lt;span style="color:#f92672">:=&lt;/span> make([]&lt;span style="color:#66d9ef">byte&lt;/span>, len(&lt;span style="color:#a6e22e">b&lt;/span>))
copy(&lt;span style="color:#a6e22e">c&lt;/span>, &lt;span style="color:#a6e22e">b&lt;/span>)
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">c&lt;/span>
}
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;p>åŸæ–‡&lt;a class="link" href="https://blog.golang.org/go-slices-usage-and-internals" target="_blank" rel="noopener"
>Go Slices: usage and internals&lt;/a>&lt;/p></description></item><item><title>ä¸€ç§å›æº¯çš„è§£æ•°ç‹¬ç®—æ³•</title><link>https://tomwei7.com/2016/08/21/sudoku.html</link><pubDate>Sun, 21 Aug 2016 00:00:00 +0000</pubDate><guid>https://tomwei7.com/2016/08/21/sudoku.html</guid><description>&lt;img src="https://tomwei7.com/2016/08/21/sudoku/Sudoku-by-L2G-20050714.svg" alt="Featured image of post ä¸€ç§å›æº¯çš„è§£æ•°ç‹¬ç®—æ³•" />&lt;p>æ•°ç‹¬æ˜¯ä¸€ç§é€»è¾‘æ€§çš„æ•°å­—å¡«å……æ¸¸æˆï¼Œç©å®¶é¡»ä»¥æ•°å­—å¡«è¿›æ¯ä¸€æ ¼ï¼Œè€Œæ¯è¡Œã€æ¯åˆ—å’Œæ¯ä¸ªå®«ï¼ˆå³3x3çš„å¤§æ ¼ï¼‰æœ‰é½1è‡³9æ‰€æœ‰æ•°å­—ã€‚æ¸¸æˆè®¾è®¡è€…ä¼šæä¾›ä¸€éƒ¨åˆ†çš„æ•°å­—ï¼Œä½¿è°œé¢˜åªæœ‰ä¸€ä¸ªç­”æ¡ˆã€‚&lt;/p>
&lt;p>&lt;figure
>
&lt;a href="https://tomwei7.com/2016/08/21/sudoku/Sudoku-by-L2G-20050714.svg" >
&lt;img src="https://tomwei7.com/2016/08/21/sudoku/Sudoku-by-L2G-20050714.svg"
loading="lazy"
alt="ä¸€ä¸ªç»å…¸çš„æ•°ç‹¬é¢˜">
&lt;/a>
&lt;figcaption>ä¸€ä¸ªç»å…¸çš„æ•°ç‹¬é¢˜&lt;/figcaption>
&lt;/figure>&lt;/p>
&lt;h3 id="ç®—æ³•æ­¥éª¤">ç®—æ³•æ­¥éª¤&lt;/h3>
&lt;ul>
&lt;li>1ã€æ‰«ææ•´ä¸ª9x9å®«æ ¼ï¼Œæ ¹æ®å·²æœ‰çš„æ•°å­—æ‰¾å‡ºæ¯ä¸€ä¸ªç©ºæ ¼èƒ½å¤Ÿå¡«å……çš„æ‰€æœ‰æ•°å­—ï¼Œè‹¥å‡ºç°æŸä¸€ä¸ªç©ºæ ¼æ²¡æœ‰èƒ½å¤Ÿå¡«å……çš„æ•°å­—ï¼Œåˆ™è¿›è¡Œå›æº¯ã€‚&lt;/li>
&lt;li>2ã€é€‰æ‹©æ‹¥æœ‰æœ€å°‘èƒ½å¤Ÿå¡«å……æ•°å­—çš„ç©ºæ ¼ï¼Œä»èƒ½å¤Ÿå¡«å……çš„æ•°å­—ä¸­é€‰å–ä¸€ä¸ªæ•°å¡«å…¥è¯¥ç©ºæ ¼ï¼Œå°†å¡«å…¥çš„ç©ºæ ¼ä½ç½®å’Œå‰©ä½™çš„èƒ½å¤Ÿå¡«å……çš„æ•°å­—å‹å…¥å†å²å †æ ˆ&lt;/li>
&lt;li>3ã€é‡å¤1ç›´è‡³æ‰€æœ‰ç©ºæ ¼å‡è¢«å¡«å……ï¼Œåˆ™å®Œæˆ&lt;/li>
&lt;/ul>
&lt;p>å›æº¯æ“ä½œ&lt;/p>
&lt;ul>
&lt;li>1ã€ä»å†å²å †æ ˆå¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œè‹¥å †æ ˆä¸ºç©ºï¼Œåˆ™è¯¥æ•°ç‹¬æ— è§£ã€‚&lt;/li>
&lt;li>2ã€è‹¥å¼¹å‡ºçš„å…ƒç´ çš„å‰©ä½™å¯å¡«å……æ•°å­—ä¸ªæ•°ä¸º0ï¼Œåˆ™å°†è¯¥å…ƒç´ æ‰€çºªå½•çš„ç©ºæ ¼ä»å®«æ ¼ä¸­åˆ é™¤ï¼Œé‡å¤1ï¼Œå¦åˆ™ï¼Œä»å‰©ä½™çš„å¯å¡«å……æ•°å­—ä¸­é€‰å–ä¸€ä¸ªé‡æ–°å¡«å…¥è¯¥ç©ºæ ¼ã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="ä»£ç å®ç°">ä»£ç å®ç°&lt;/h3>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Sudoku&lt;/span>(object):
&lt;span style="color:#e6db74">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;span style="color:#e6db74"> Sudoku solver
&lt;/span>&lt;span style="color:#e6db74"> &amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">def&lt;/span> __init__(self, matrix):
self&lt;span style="color:#f92672">.&lt;/span>matrix &lt;span style="color:#f92672">=&lt;/span> matrix
self&lt;span style="color:#f92672">.&lt;/span>history_stack &lt;span style="color:#f92672">=&lt;/span> []
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">_push_history&lt;/span>(self, pos, val_list):
self&lt;span style="color:#f92672">.&lt;/span>history_stack&lt;span style="color:#f92672">.&lt;/span>append([pos] &lt;span style="color:#f92672">+&lt;/span> val_list)
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">_pop_history&lt;/span>(self):
&lt;span style="color:#66d9ef">if&lt;/span> len(self&lt;span style="color:#f92672">.&lt;/span>history_stack) &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>:
&lt;span style="color:#66d9ef">if&lt;/span> len(self&lt;span style="color:#f92672">.&lt;/span>history_stack[&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>]) &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>:
self&lt;span style="color:#f92672">.&lt;/span>_set_pos(self&lt;span style="color:#f92672">.&lt;/span>history_stack[&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>][&lt;span style="color:#ae81ff">0&lt;/span>],
self&lt;span style="color:#f92672">.&lt;/span>history_stack[&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>]&lt;span style="color:#f92672">.&lt;/span>pop())
&lt;span style="color:#66d9ef">else&lt;/span>:
tem &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>history_stack&lt;span style="color:#f92672">.&lt;/span>pop()
self&lt;span style="color:#f92672">.&lt;/span>_set_pos(tem[&lt;span style="color:#ae81ff">0&lt;/span>], &lt;span style="color:#ae81ff">0&lt;/span>)
self&lt;span style="color:#f92672">.&lt;/span>_pop_history()
&lt;span style="color:#66d9ef">else&lt;/span>:
&lt;span style="color:#66d9ef">raise&lt;/span> &lt;span style="color:#a6e22e">Exception&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;out of history_stack&amp;#34;&lt;/span>)
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">_set_pos&lt;/span>(self, pos, val):
self&lt;span style="color:#f92672">.&lt;/span>matrix[pos &lt;span style="color:#f92672">//&lt;/span> &lt;span style="color:#ae81ff">9&lt;/span>][pos &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">9&lt;/span>] &lt;span style="color:#f92672">=&lt;/span> val
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">_get_pos&lt;/span>(self, pos):
&lt;span style="color:#66d9ef">return&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>matrix[pos &lt;span style="color:#f92672">//&lt;/span> &lt;span style="color:#ae81ff">9&lt;/span>][pos &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">9&lt;/span>]
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">_get_available&lt;/span>(self, pos):
ret &lt;span style="color:#f92672">=&lt;/span> [&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">2&lt;/span>, &lt;span style="color:#ae81ff">3&lt;/span>, &lt;span style="color:#ae81ff">4&lt;/span>, &lt;span style="color:#ae81ff">5&lt;/span>, &lt;span style="color:#ae81ff">6&lt;/span>, &lt;span style="color:#ae81ff">7&lt;/span>, &lt;span style="color:#ae81ff">8&lt;/span>, &lt;span style="color:#ae81ff">9&lt;/span>]
s_x &lt;span style="color:#f92672">=&lt;/span> (pos &lt;span style="color:#f92672">//&lt;/span> &lt;span style="color:#ae81ff">9&lt;/span>) &lt;span style="color:#f92672">*&lt;/span> &lt;span style="color:#ae81ff">9&lt;/span>
&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> range(s_x, s_x&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">9&lt;/span>):
&lt;span style="color:#66d9ef">if&lt;/span> i &lt;span style="color:#f92672">==&lt;/span> pos:
&lt;span style="color:#66d9ef">continue&lt;/span>
val &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>_get_pos(i)
&lt;span style="color:#66d9ef">if&lt;/span> val &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">and&lt;/span> val &lt;span style="color:#f92672">in&lt;/span> ret:
ret&lt;span style="color:#f92672">.&lt;/span>remove(val)
s_y &lt;span style="color:#f92672">=&lt;/span> pos &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">9&lt;/span>
&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> range(s_y, &lt;span style="color:#ae81ff">81&lt;/span>, &lt;span style="color:#ae81ff">9&lt;/span>):
&lt;span style="color:#66d9ef">if&lt;/span> i &lt;span style="color:#f92672">==&lt;/span> pos:
&lt;span style="color:#66d9ef">continue&lt;/span>
val &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>_get_pos(i)
&lt;span style="color:#66d9ef">if&lt;/span> val &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">and&lt;/span> val &lt;span style="color:#f92672">in&lt;/span> ret:
ret&lt;span style="color:#f92672">.&lt;/span>remove(val)
box_y &lt;span style="color:#f92672">=&lt;/span> pos &lt;span style="color:#f92672">//&lt;/span> &lt;span style="color:#ae81ff">27&lt;/span>
box_x &lt;span style="color:#f92672">=&lt;/span> (pos &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">9&lt;/span>) &lt;span style="color:#f92672">//&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span>
box_start &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">27&lt;/span> &lt;span style="color:#f92672">*&lt;/span> box_y &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">3&lt;/span> &lt;span style="color:#f92672">*&lt;/span> box_x
&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> range(box_start, box_start&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">21&lt;/span>, &lt;span style="color:#ae81ff">9&lt;/span>):
&lt;span style="color:#66d9ef">for&lt;/span> j &lt;span style="color:#f92672">in&lt;/span> range(i, i&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">3&lt;/span>):
&lt;span style="color:#66d9ef">if&lt;/span> j &lt;span style="color:#f92672">==&lt;/span> pos:
&lt;span style="color:#66d9ef">continue&lt;/span>
val &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>_get_pos(j)
&lt;span style="color:#66d9ef">if&lt;/span> val &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">and&lt;/span> val &lt;span style="color:#f92672">in&lt;/span> ret:
ret&lt;span style="color:#f92672">.&lt;/span>remove(val)
&lt;span style="color:#66d9ef">return&lt;/span> ret
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">_pos_to_xy&lt;/span>(self, pos):
&lt;span style="color:#66d9ef">return&lt;/span> pos &lt;span style="color:#f92672">//&lt;/span> &lt;span style="color:#ae81ff">9&lt;/span>, pos &lt;span style="color:#f92672">%&lt;/span> &lt;span style="color:#ae81ff">9&lt;/span>
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">_find_enter&lt;/span>(self):
enter &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
available_list &lt;span style="color:#f92672">=&lt;/span> []
&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> range(&lt;span style="color:#ae81ff">81&lt;/span>):
val &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>_get_pos(i)
&lt;span style="color:#66d9ef">if&lt;/span> val &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>:
&lt;span style="color:#66d9ef">continue&lt;/span>
tem_list &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>_get_available(i)
&lt;span style="color:#66d9ef">if&lt;/span> len(tem_list) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>:
&lt;span style="color:#66d9ef">raise&lt;/span> &lt;span style="color:#a6e22e">Exception&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;matrix error trace back&amp;#34;&lt;/span>)
&lt;span style="color:#66d9ef">if&lt;/span> enter &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">or&lt;/span> len(tem_list) &lt;span style="color:#f92672">&amp;lt;&lt;/span> len(available_list):
enter &lt;span style="color:#f92672">=&lt;/span> i
available_list &lt;span style="color:#f92672">=&lt;/span> tem_list
&lt;span style="color:#66d9ef">return&lt;/span> enter, available_list
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">display&lt;/span>(self):
&lt;span style="color:#66d9ef">for&lt;/span> line &lt;span style="color:#f92672">in&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>matrix:
print(line)
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">solver&lt;/span>(self):
&lt;span style="color:#66d9ef">while&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>:
&lt;span style="color:#66d9ef">try&lt;/span>:
enter, available_list &lt;span style="color:#f92672">=&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>_find_enter()
&lt;span style="color:#66d9ef">except&lt;/span> &lt;span style="color:#a6e22e">Exception&lt;/span>:
self&lt;span style="color:#f92672">.&lt;/span>_pop_history()
&lt;span style="color:#66d9ef">continue&lt;/span>
&lt;span style="color:#66d9ef">if&lt;/span> enter &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>:
&lt;span style="color:#66d9ef">return&lt;/span> self&lt;span style="color:#f92672">.&lt;/span>matrix
self&lt;span style="color:#f92672">.&lt;/span>_set_pos(enter, available_list&lt;span style="color:#f92672">.&lt;/span>pop())
self&lt;span style="color:#f92672">.&lt;/span>_push_history(enter, available_list)
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="æµ‹è¯•">æµ‹è¯•&lt;/h3>
&lt;p>æµ‹è¯•æˆ‘ç”¨äº†æ‰€è°“çš„&lt;a class="link" href="http://www.guokr.com/post/258813/focus/0735702793/" target="_blank" rel="noopener"
>èŠ¬å…°æ•°å­¦å®¶å› å¡æ‹‰èŠ±è´¹3ä¸ªæœˆè®¾è®¡å‡ºäº†ä¸–ç•Œä¸Šè¿„ä»Šéš¾åº¦æœ€å¤§çš„ä¹å®«æ ¼æ¸¸æˆ&lt;/a>&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 89;
flex-basis: 214px"
>
&lt;a href="https://tomwei7.com/2016/08/21/sudoku/testsudoku.jpg" data-size="400x447">
&lt;img src="https://tomwei7.com/2016/08/21/sudoku/testsudoku.jpg"
width="400"
height="447"
srcset="https://tomwei7.com/2016/08/21/sudoku/testsudoku_hub54616d9074391170f98af14f2d30a2d_26398_480x0_resize_q75_box.jpg 480w, https://tomwei7.com/2016/08/21/sudoku/testsudoku_hub54616d9074391170f98af14f2d30a2d_26398_1024x0_resize_q75_box.jpg 1024w"
loading="lazy"
>
&lt;/a>
&lt;/figure>&lt;/p>
&lt;p>&lt;figure
class="gallery-image"
style="
flex-grow: 261;
flex-basis: 628px"
>
&lt;a href="https://tomwei7.com/2016/08/21/sudoku/E179DC8D-B8FD-4C76-A00C-F72A4645071A.jpeg" data-size="754x288">
&lt;img src="https://tomwei7.com/2016/08/21/sudoku/E179DC8D-B8FD-4C76-A00C-F72A4645071A.jpeg"
width="754"
height="288"
srcset="https://tomwei7.com/2016/08/21/sudoku/E179DC8D-B8FD-4C76-A00C-F72A4645071A_hu2a1927aa31c8cd3f96cce7e92e6162a3_52594_480x0_resize_q75_box.jpeg 480w, https://tomwei7.com/2016/08/21/sudoku/E179DC8D-B8FD-4C76-A00C-F72A4645071A_hu2a1927aa31c8cd3f96cce7e92e6162a3_52594_1024x0_resize_q75_box.jpeg 1024w"
loading="lazy"
>
&lt;/a>
&lt;/figure>&lt;/p>
&lt;p>å®é™…ç”¨æ—¶å››ç§’å·¦å³ï¼Œåº”è¯¥å¾ˆæœ‰å¾ˆå¤§çš„ä¼˜åŒ–ç©ºé—´&lt;/p></description></item><item><title>æ´—ç‰Œç®—æ³•</title><link>https://tomwei7.com/2016/03/18/fisher-yates-shuffle.html</link><pubDate>Fri, 18 Mar 2016 00:00:00 +0000</pubDate><guid>https://tomwei7.com/2016/03/18/fisher-yates-shuffle.html</guid><description>&lt;p>æ´—ç‰Œç®—æ³•æ˜¯ä¸€ä¸ªæ¯”è¾ƒå½¢è±¡çš„æœ¯è¯­ï¼Œæœ¬è´¨ä¸Šæ˜¯è®©ä¸€ä¸ªæ•°ç»„å†…çš„å…ƒç´ éšæœºæ’åˆ—ã€‚åˆšåœ¨&lt;a class="link" href="https://segmentfault.com/" target="_blank" rel="noopener"
>segmentfault&lt;/a>çœ‹åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜&lt;a class="link" href="https://segmentfault.com/q/1010000004628428" target="_blank" rel="noopener"
>10ä¸‡ä¸ªæ•°å­—æ— åºæ’åˆ—&lt;/a>ï¼Œä¹Ÿå°±æ˜¯æ´—ç‰Œäº†ã€‚&lt;/p>
&lt;h3 id="å®ç°">å®ç°&lt;/h3>
&lt;p>ç»´åŸºç™¾ç§‘ä¸Šçš„&lt;a class="link" href="https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle" target="_blank" rel="noopener"
>Fisherâ€“Yates shuffle&lt;/a>å¯¹æ´—ç‰Œåšäº†æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ï¼Œä¸Šé¢ä¼ªä»£ç å®ç°å¦‚ä¸‹&lt;/p>
&lt;pre>&lt;code>-- To shuffle an array a of n elements (indices 0..n-1):
for i from nâˆ’1 downto 1 do
j â† random integer such that 0 â‰¤ j â‰¤ i
exchange a[j] and a[i]
&lt;/code>&lt;/pre>&lt;!-- raw HTML omitted -->
&lt;h3 id="åŸç†">åŸç†&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>è¯¥æ–¹æ³•é€‰ä¸­æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼š&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¥ä¸‹æ¥ç¡®å®šæŒ‘é€‰éšæœºå…ƒç´ çš„èŒƒå›´ï¼Œä»æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ åˆ°ä¸Šä¸€æ­¥é€‰ä¸­çš„å…ƒç´ éƒ½å±äºè¿™ä¸€èŒƒå›´&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç¡®å®šèŒƒå›´åï¼Œä»ä¸­éšæœºæŒ‘é€‰ä¸€ä¸ªæ•°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç„¶åäº¤æ¢æœ€åä¸€ä¸ªå…ƒç´ å’Œéšæœºé€‰ä¸­çš„å…ƒç´ çš„å€¼&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸Šé¢çš„äº¤æ¢å®Œæˆåï¼Œç›¸å½“äºæˆ‘ä»¬å®Œæˆäº†å¯¹æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ çš„éšæœºå¤„ç†ã€‚æ¥ä¸‹æ¥é€‰ä¸­æ•°ç»„å†…å€’æ•°ç¬¬äºŒçš„å…ƒç´ &lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¹‹æ‰€ä»¥ä»åå¾€å‰å¤„ç†ï¼Œæ˜¯å› ä¸ºè¿™æ ·ä¾¿äºç¡®å®šéšæœºé€‰æ‹©çš„èŒƒå›´ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å‰©ä¸‹çš„å°±æ˜¯ä¸€äº›é‡å¤æ€§çš„å·¥ä½œ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="ä»£ç ">ä»£ç &lt;/h3>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-python" data-lang="python">&lt;span style="color:#75715e">#!/usr/bin/env python&lt;/span>
&lt;span style="color:#75715e"># -*- coding: utf-8 -*-&lt;/span>
&lt;span style="color:#f92672">import&lt;/span> random
N &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">100000&lt;/span>
data &lt;span style="color:#f92672">=&lt;/span> range(N)
&lt;span style="color:#66d9ef">for&lt;/span> i &lt;span style="color:#f92672">in&lt;/span> range(len(data)&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">0&lt;/span>, &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>):
t &lt;span style="color:#f92672">=&lt;/span> int(random&lt;span style="color:#f92672">.&lt;/span>random()&lt;span style="color:#f92672">*&lt;/span>i)
data[t], data[i] &lt;span style="color:#f92672">=&lt;/span> data[i], data[t]
print(data)
&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>