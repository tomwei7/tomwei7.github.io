<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Jetson Nano 是 NVIDIA 推出的 Aot 嵌入式平台，拥有 4 核心主频 1.43GHZ 的 Cortex-A57 CPU 和128组472GFLOPS （FP16）的Maxwell架构 GPU 以及 4GB LPDDR4 内存。 配置十分强大，"><title>Jetson Nano USB Boot 配置</title><link rel=canonical href=http://example.org/2021/01/25/jetson-nano-usb-boot.html><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Jetson Nano USB Boot 配置"><meta property="og:description" content="Jetson Nano 是 NVIDIA 推出的 Aot 嵌入式平台，拥有 4 核心主频 1.43GHZ 的 Cortex-A57 CPU 和128组472GFLOPS （FP16）的Maxwell架构 GPU 以及 4GB LPDDR4 内存。 配置十分强大，"><meta property="og:url" content="http://example.org/2021/01/25/jetson-nano-usb-boot.html"><meta property="og:site_name" content="围城"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:published_time" content="2021-01-25T00:00:00+00:00"><meta property="article:modified_time" content="2021-01-25T00:00:00+00:00"><meta property="og:image" content="http://example.org/2021/01/25/jetson-nano-usb-boot/jetson-nano.jpg"><meta name=twitter:title content="Jetson Nano USB Boot 配置"><meta name=twitter:description content="Jetson Nano 是 NVIDIA 推出的 Aot 嵌入式平台，拥有 4 核心主频 1.43GHZ 的 Cortex-A57 CPU 和128组472GFLOPS （FP16）的Maxwell架构 GPU 以及 4GB LPDDR4 内存。 配置十分强大，"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://example.org/2021/01/25/jetson-nano-usb-boot/jetson-nano.jpg"><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.documentElement.dataset.scheme='dark':document.documentElement.dataset.scheme='light'})()</script><div class="container main-container flex
on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hu05d8908e25e17e448f0fb5b7fc66f397_443963_300x0_resize_box_2.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></figure><h1 class=site-name><a href=/>围城</a></h1><h2 class=site-description>程序员-代码-吐槽</h2></header><ol class=menu id=main-menu><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>暗色模式</span></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/2021/01/25/jetson-nano-usb-boot.html><img src=/2021/01/25/jetson-nano-usb-boot/jetson-nano_hubc7b2abfe58069cc0b074907693a79ad_257140_800x0_resize_q75_box.jpg srcset="/2021/01/25/jetson-nano-usb-boot/jetson-nano_hubc7b2abfe58069cc0b074907693a79ad_257140_800x0_resize_q75_box.jpg 800w, /2021/01/25/jetson-nano-usb-boot/jetson-nano_hubc7b2abfe58069cc0b074907693a79ad_257140_1600x0_resize_q75_box.jpg 1600w" width=800 height=450 loading=lazy alt="Featured image of post Jetson Nano USB Boot 配置"></a></div><div class=article-details><header class=article-category><a href=/categories/sbc.html>SBC</a></header><h2 class=article-title><a href=/2021/01/25/jetson-nano-usb-boot.html>Jetson Nano USB Boot 配置</a></h2><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Jan 25, 2021</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>阅读时长: 3 分钟</time></div></footer></div></header><section class=article-content><p>Jetson Nano 是 NVIDIA 推出的 Aot 嵌入式平台，拥有 4 核心主频 1.43GHZ 的 Cortex-A57 CPU 和128组472GFLOPS （FP16）的Maxwell架构 GPU 以及 4GB LPDDR4 内存。 配置十分强大，可是和树莓派一样默认使用 SD 卡作为存储，SD 卡到性能直接影响了日常到使用体验。而大容量高速的 SD 卡价格实在感人。考虑到 Jetson Nano 拥有四个 USB3.0 5G 速率的接口，使用 USB 外接 SSD 也许是更好的解决方法。</p><p>这里首先介绍下 Jetson Nano 的启动过程，Jetson Nano 使用两阶段启动的方式，首先 Bootloader 会从 sdcard 加载一个比较小的 initrd (initial ramdisk)，可以理解为一个很小的系统，通过这个小系统再去加载 Linux Kernal。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>+------------------+        +--------+       +--------------+
|                  |        |        |       |              |
|bootloader<span style=color:#f92672>(</span>u-boot<span style=color:#f92672>)</span>+-------&gt;+ initrd +------&gt;+ Linux kernel |
|                  |        |        |       |              |
+------------------+        +--------+       +--------------+
</code></pre></div><p>Jetson Nano 官方文档并没有提到可以通过 USB 启动，默认的 initrd 系统也不包含 USB 驱动，所以initrd 没办法加载 USB 进行启动，Github 上有个项目叫做 <a class=link href=https://github.com/JetsonHacksNano/rootOnUSB target=_blank rel=noopener>https://github.com/JetsonHacksNano/rootOnUSB</a> ，通过重新编译 initrd 添加 USB 驱动的方式，让 initrd 可以从 USB 设备启动 Linux。</p><p>但是经过尝试发现这种方式已经没有办法从 USB 启动 Jetson Nano 会让系统陷入无限重启的循环。考虑到这个项目最后更新还是17月以前，而现在 Jetson Nano 系统版本已经更新多次，可能已经无法兼容了。</p><p>无奈只能接上了串口可以调试启动过程，无意中发现现在版本的 U-Boot（Jetson Nano 的 Bootloader）在尝试检测 USB 设备，尝试翻阅 NVIDIA 相关文档也说明了这一点 <a class=link href=https://docs.nvidia.com/jetson/l4t/index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/uboot_guide.html#wwpID0E06E0HA target=_blank rel=noopener>https://docs.nvidia.com/jetson/l4t/index.html#page/Tegra Linux Driver Package Development Guide/uboot_guide.html#wwpID0E06E0HA</a></p><blockquote><p>Boot Sequence and Sysboot Configuration Files
U-Boot functionality includes a default booting scan sequence. It scans bootable devices in the following order:</p><ul><li>External SD card</li><li>Internal eMMC</li><li>USB device or NVMe device (Jetson TX2 series only)</li><li>NFS network via DHCP/PXE</li></ul></blockquote><p>所以其实官方的 Bootloader 已经早就支持了 USB 启动了，但是由于默认的镜像是为 SD 卡准备的，并不能直接用于 USB 设备。这里需要进行一点点修改。</p><p>首先直接将下载的 Jetson Nano 的 SD 镜像写入 SSD 中这里的过程和写入 SD 卡一样，由于 SD 镜像的文件系统是 ext4 格式，这里需要一台 Linux 系统的机器来挂载 ext4 的文件系统并修改启动参数。</p><p>将写好的 SSD 盘使用 <code>parted</code> 打开，可以看到有这些分区</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>&gt;&gt; sudo parted /dev/sda
GNU Parted 3.2
Using /dev/sda
Welcome to GNU Parted! Type <span style=color:#e6db74>&#39;help&#39;</span> to view a list of commands.
<span style=color:#f92672>(</span>parted<span style=color:#f92672>)</span> print
Model: ATA INTEL SSDSC2BB16 <span style=color:#f92672>(</span>scsi<span style=color:#f92672>)</span>
Disk /dev/sda: 160GB
Sector size <span style=color:#f92672>(</span>logical/physical<span style=color:#f92672>)</span>: 512B/512B
Partition Table: gpt
Disk Flags:

Number  Start   End     Size    File system  Name     Flags
 <span style=color:#ae81ff>2</span>      1049kB  1180kB  131kB                TBC
 <span style=color:#ae81ff>3</span>      2097kB  2556kB  459kB                RP1
 <span style=color:#ae81ff>4</span>      3146kB  3736kB  590kB                EBT
 <span style=color:#ae81ff>5</span>      4194kB  4260kB  65.5kB               WB0
 <span style=color:#ae81ff>6</span>      5243kB  5439kB  197kB                BPF
 <span style=color:#ae81ff>7</span>      6291kB  6685kB  393kB                BPF-DTB
 <span style=color:#ae81ff>8</span>      7340kB  7406kB  65.5kB               FX
 <span style=color:#ae81ff>9</span>      8389kB  8847kB  459kB                TOS
<span style=color:#ae81ff>10</span>      9437kB  9896kB  459kB                DTB
<span style=color:#ae81ff>11</span>      10.5MB  11.3MB  786kB                LNX
<span style=color:#ae81ff>12</span>      11.5MB  11.6MB  65.5kB               EKS
<span style=color:#ae81ff>13</span>      12.6MB  12.8MB  197kB                BMP
<span style=color:#ae81ff>14</span>      13.6MB  13.8MB  131kB                RP4
 <span style=color:#ae81ff>1</span>      14.7MB  160GB   160GB   ext4         APP
</code></pre></div><p>需要挂载的分区是 APP 这里将 APP 分区即 <code>/dev/sda1</code> 挂载到 <code>/mnt</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo mount /dev/sda1 /mnt
</code></pre></div><p>打开 <code>/mnt/boot/extlinux/extlinux.conf</code> 文件，可以看到镜像默认将 root 指向了 <code>/dev/mmcblk0p1</code> 即 sd 卡的第一个分区</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>LABEL primary
      MENU LABEL primary kernel
      LINUX /boot/Image
      INITRD /boot/initrd
      APPEND <span style=color:#e6db74>${</span>cbootargs<span style=color:#e6db74>}</span> quiet root<span style=color:#f92672>=</span>/dev/mmcblk0p1 rw rootwait rootfstype<span style=color:#f92672>=</span>ext4 console<span style=color:#f92672>=</span>ttyS0,115200n8 console<span style=color:#f92672>=</span>tty0 fbcon<span style=color:#f92672>=</span>map:0 net.ifnames<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</code></pre></div><p>直接将 <code>/dev/mmcblk0p1</code> 改成 <code>/dev/sda1</code> 即可</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>LABEL primary
      MENU LABEL primary kernel
      LINUX /boot/Image
      INITRD /boot/initrd
      APPEND <span style=color:#e6db74>${</span>cbootargs<span style=color:#e6db74>}</span> quiet root<span style=color:#f92672>=</span>/dev/sda1 rw rootwait rootfstype<span style=color:#f92672>=</span>ext4 console<span style=color:#f92672>=</span>ttyS0,115200n8 console<span style=color:#f92672>=</span>tty0 fbcon<span style=color:#f92672>=</span>map:0 net.ifnames<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</code></pre></div><p>这里更加保险的做法应该是使用分区的 UUID 或者 LABEL 来指定磁盘，但是经过测试不管是 UUID 还是 LABEL 均会导致启动失败。所以要注意使用 USB 启动时，在 Jetson Nano 开机的时候只能插一个磁盘，不然可能会导致启动失败</p><p>现在从 Jetson Nano 中移除现有的 SD 卡，插入 USB SSD 重新启动就能从 USB 启动。</p><p>如果使用 USB 外接 SSD 需要注意，最好使用 5V4A 的电源，而不要使用 microUSB 供电。非常容易导致供电不足。</p><p>最后附上 USB SSD 与 SD 卡的性能测试，虽然 Jetson Nano 的 USB 3.0 接口比较拉胯，但是依然可以秒杀 SD 卡，平时使用在编译时也可以感觉到明显的性能提升。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># USB SSD (Intel DC S3500 160G)</span>
READ: bw<span style=color:#f92672>=</span>263MiB/s <span style=color:#f92672>(</span>276MB/s<span style=color:#f92672>)</span>, 263MiB/s-263MiB/s <span style=color:#f92672>(</span>276MB/s-276MB/s<span style=color:#f92672>)</span>, io<span style=color:#f92672>=</span>8192MiB <span style=color:#f92672>(</span>8590MB<span style=color:#f92672>)</span>, run<span style=color:#f92672>=</span>31169-31169msec
WRITE: bw<span style=color:#f92672>=</span>101MiB/s <span style=color:#f92672>(</span>106MB/s<span style=color:#f92672>)</span>, 101MiB/s-101MiB/s <span style=color:#f92672>(</span>106MB/s-106MB/s<span style=color:#f92672>)</span>, io<span style=color:#f92672>=</span>4096MiB <span style=color:#f92672>(</span>4295MB<span style=color:#f92672>)</span>, run<span style=color:#f92672>=</span>40686-40686msec

<span style=color:#75715e># SDCard (KIOXIA EXCERIA 32G U1)</span>
READ: bw<span style=color:#f92672>=</span>85.6MiB/s <span style=color:#f92672>(</span>89.8MB/s<span style=color:#f92672>)</span>, 85.6MiB/s-85.6MiB/s <span style=color:#f92672>(</span>89.8MB/s-89.8MB/s<span style=color:#f92672>)</span>, io<span style=color:#f92672>=</span>8192MiB <span style=color:#f92672>(</span>8590MB<span style=color:#f92672>)</span>, run<span style=color:#f92672>=</span>95709-95709msec
WRITE: bw<span style=color:#f92672>=</span>12.2MiB/s <span style=color:#f92672>(</span>12.8MB/s<span style=color:#f92672>)</span>, 12.2MiB/s-12.2MiB/s <span style=color:#f92672>(</span>12.8MB/s-12.8MB/s<span style=color:#f92672>)</span>, io<span style=color:#f92672>=</span>512MiB <span style=color:#f92672>(</span>537MB<span style=color:#f92672>)</span>, run<span style=color:#f92672>=</span>42007-42007msec
</code></pre></div></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper></aside><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//tomwei7.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener('onColorSchemeChange',a=>{DISQUS&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2016 -
2021 围城</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.2.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script></body></html>